{
    "id": "bitcointranscripts+advancing-bitcoin+2022+static-invoices-in-lightning",
    "title": "Static Invoices in Lightning: A Deep Dive and Comparison of Bolt11 Invoices, LNURL, Offers and AMP",
    "body_formatted": "{\"type\":\"heading\",\"text\":\"Intro\"}, {\"type\":\"paragraph\",\"text\":\"Hi guys, I'm Elle, and I'm going to be talking about static invoices in the Lightning Network.\\nAs most of you probably know, in Lightning, currently if you want to be paid, you have to create a new invoice every time.\\nAnd this is a bit of a difficult thing for people to understand who don't know anything about the space.\\nToday I'm going to just be diving into exactly why it's a mission for us to have these static invoices, and then just outlining the three various proposals LNURL, Offers and AMP that people have been discussing.\"}, {\"type\":\"paragraph\",\"text\":\"Before I carry on, I just want to mention a few things.\\nFirst of all, if you're a Lightning developer, this talk is really not for you.\\nI just want more people to be able to join the discussion.\\nSo it's just making sure everybody understands the various components.\\nTo the Lightning developers, if I say anything incorrect, please shout at me.\\nThe one thing that all these three proposals have in common is they give us these static invoices, but each of them have other features that are really cool, and I will mention those as well.\\nWe can't really compare them.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, just a quick talk overview.\\nI feel it's very important to make sure everybody understands what the issue is, so I'm going to spend a little bit of time on a payment deep dive.\\nNot a deep dive, just an overview so everyone understands what we need to have payments work in the Lightning network.\\nFrom that, we'll understand why Bolt11 invoices are a thing.\\nThen I'll talk about the issues with those things, and then from there we can go into the various proposals.\\nAnd then I'll just give a quick high level overview and mention some of the arguments that people have been talking about on Twitter.\\nAnd leave you with some questions to think about.\"}, {\"type\":\"heading\",\"text\":\"Lightning Payments 101\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so as all of you probably know, Lightning is made up of a bunch of channels, which is just a contract between Alice and Bob, they've got a two of two multi-sig, allows them to do value transfer between each other many times, very fast, off-chain.\\nSo really cool, if the whole Lightning network is made up of channel between every person, static invoices are solved, not a problem.\\nI can finish my talk right now.\"}, {\"type\":\"paragraph\",\"text\":\"But the thing is, this doesn't scale.\\nYou can't have a UTXO open with every single person in the world that you're gonna wanna have to pay, so this doesn't work.\\nAnd the beauty of Lightning network is that Alice's view can look a little bit more something like this, and all she needs to do to pay someone like Dave is find a route to Dave.\"}, {\"type\":\"paragraph\",\"text\":\"Let's look at that a bit.\\nShe finds a route to Dave, and she just needs to focus on that.\\nSo now, how does Alice pay Dave.\\nWhy can't this be static?\\nWhy can't she just tell her node, \\\"please pay Dave's node ID this amount of Bitcoin\\\".\\nThat's a static thing.\"}, {\"type\":\"paragraph\",\"text\":\"The naive way would be Alice just tells Bob, \\\"hey Bob, please help me out.\\nI'm gonna tip you, I'm gonna leave one Bitcoin with you, and please just push two over to Charlie, and tell him to do the same with Dave\\\".\\nCool, that's great, Dave got paid.\\nThat doesn't work, because in Bitcoin we can't trust Bob.\\nIn reality, if Alice pushes money over to Bob, there's nothing stopping Bob from just running away at this point.\\nOkay, so Lightning payments don't work like that.\"}, {\"type\":\"paragraph\",\"text\":\"How do they work?\\nWhat we actually do is, before the payment can happen, before we even touch the Lightning network, Alice says, \\\"hey Dave, I'm gonna pay you, please be aware.\\\"\\nDave goes ahead and generates a secret, takes the hash of that secret, and sends it back to Alice.\\nThis happens all outside of the Lightning network.\\nNow Alice goes again to Bob, but this time she tells him, \\\"hey Bob, you can have these 3 Bitcoin, but only if you can unlock this hash.\\nIf you can't unlock it, I'm gonna get the money back after some time lock\\\".\\nSo Bob sees this, realizes he's only gonna get a tip if he continues the pattern onto Charlie so that he can eventually get the secret.\"}, {\"type\":\"paragraph\",\"text\":\"Now he does the same thing with Charlie, Charlie does the same thing with Dave.\\nDave has the secret, so Dave can unlock this hash, get his funds, and Charlie can then do the same with Bob, and Bob can do the same with Alice.\\nAnd at this point, Alice has the secret, and Dave has been successfully paid, and her having the secret is what we call a proof of payment.\"}, {\"type\":\"paragraph\",\"text\":\"That's kind of the payments 101 complete, and there's two things you should take away from this.\\nIt's actually just one thing, but the first thing is, there had to be this dance between Alice and Dave happening outside the network before the payment could actually happen.\\nAnd then just leading on from that is: okay, why?\"}, {\"type\":\"paragraph\",\"text\":\"Dave had to send her this thing called a hash, but there's actually quite a few other things that Dave needs to tell Alice.\\nAnd that's where Bolt11 invoices comes in.\"}, {\"type\":\"heading\",\"text\":\"Bolt11 Invoices\"}, {\"type\":\"paragraph\",\"text\":\"Bolt11 just specs out how Dave should structure the information that he sends to Alice.\\nSo that any wallet can just know how to structure its information, how to read the information.\\nI'm sure you've all seen a Bolt11 invoice.\\nIt's usually displayed as a QR code or some LN something something.\\nNotice this is a regtest invoice because it's not safe to pay to this, and I'll get to that in a second.\"}, {\"type\":\"paragraph\",\"text\":\"Just diving into a little bit more about what Bolt11 invoices look like, you'll have your prefix, that LN part, the amount that Dave expects, timestamp, some array of data that I'll get back to in a second, and a signature over the entire thing.\\nNow, I've already mentioned that one of the pieces of data is this payment hash, and it's very important because it's the only way payment can be secure, so that's the first thing.\\nThe other thing is, it needs to contain a node ID.\"}, {\"type\":\"paragraph\",\"text\":\"Alice, if she walks into Dave's coffee shop, needs to know how to find him in the network, so it needs to be a node ID.\\nThe other thing is it optionally needs to include something called Hop-Hints, because perhaps Alice's network view looks something more like this, where Dave only has private channels, and so Alice doesn't know where he is.\"}, {\"type\":\"paragraph\",\"text\":\"So he has to actually tell her which UTXOs those private channels are if she's ever gonna find him in the network.\\nSo the invoice needs to include that.\\nMaybe it contains a description, \\\"this is for one cup of coffee\\\", and then some feature bits.\\nSo it's just a way for Dave to say to Alice, \\\"hey, I'm aware of this payment or this feature\\\", etc.\"}, {\"type\":\"paragraph\",\"text\":\"And then some other stuff, but I'm just gonna focus on those.\\nSo, what's wrong with this?\\nThe main thing I wanna focus on: it's single use, so I think people will often say, \\\"okay, invoice is single use, yes, that's unsecure\\\".\\nI just wanna demonstrate exactly why.\"}, {\"type\":\"paragraph\",\"text\":\"Let's say Alice and Bob both walk into Dave's coffee shop.\\nDave generates an invoice because he wants to be paid.\\nCreates a Bolt11 invoice, displays it.\\nAnd Alice goes ahead, pays this as we saw before.\\nAnd Dave reveals the secret, and Alice has a proof of payment for this invoice.\\nBut it just so happens that Bob saw the invoice at the same time, thought it was his maybe, and tried to start paying it.\\nSo he goes ahead, pays it.\"}, {\"type\":\"paragraph\",\"text\":\"Now, what happens if Eve and Charlie are the same person or in cahoots with each other?\\nCharlie can just send the secret, he knows it now, to Eve.\\nAnd get the money from Bob.\\nBob thinks, \\\"yay, I've got proof of payment.\\\"\\nAnd Dave has not been paid.\\nHe's only been paid once.\\nSo you can see that if you are paying an invoice, it's very important to you that no one else has paid this invoice before.\\nIt's very important.\"}, {\"type\":\"paragraph\",\"text\":\"This leads me on to my next point, which is that this is a very weak proof of payment.\\nI've just said that both Alice and Bob have this proof of payment.\\nSo really, having the secret just reveals that the payment has been complete at some point, does not prove that you have paid it.\"}, {\"type\":\"paragraph\",\"text\":\"Then just a few other issues is, I've mentioned that Dave needs to maybe include hop-hints in his invoice.\\nIf all his channels are private, this kind of defeats the point, they're no longer really private channels.\\nAlice can sell that information.\\nSo that's not ideal.\"}, {\"type\":\"paragraph\",\"text\":\"The other thing is sender and receiver privacy.\\nIn this example that I showed where Alice pays Dave, Dave has zero privacy.\\nAlice knows exactly where this payment is going.\\nBut Alice has a lot of privacy.\\nDave doesn't know where this payment is coming from, unless Alice now wants a refund, in which case she has to give up where she is in the network, which is not a nice decision to make.\"}, {\"type\":\"paragraph\",\"text\":\"And then a small thing is that the Bolt11 signature that Dave makes to just prove that he created it, is over the entire thing as a flat structure.\\nWhich is just not great if you wanna go and show that invoice and now you have to reveal all these pieces of information if you wanna show that the signature is valid.\"}, {\"type\":\"paragraph\",\"text\":\"Some bad UX.\\nThis is a valid Bolt11 invoice, just stuffed with 20 hop-hints.\\nAnd you can see this is not ideal.\\nPeople at the back are not gonna be able to scan this with their phones.\\nAnd it just demonstrates that you're kind of very much limited.\\nThere's a limit to how much information Dave can send to Alice using this method.\\nAnd then it's just a little bit of an awkward flow.\"}, {\"type\":\"paragraph\",\"text\":\"We're used to paying directly to a static bank account that doesn't change.\\nNow we have to tell users, \\\"okay, if you wanna be paid, someone needs to tell you first they wanna pay you\\\".\\nYou tell your node, please give me a new invoice.\\nAnd then you send it back to the person, and then they can tell their node to pay it.\\nAnd it's just a little bit awkward.\"}, {\"type\":\"paragraph\",\"text\":\"And then another awkward flow is the withdrawal flow.\\nLet's say Dave is an exchange, and you wanna withdraw some money from the exchange.\\nLet's say you are interfacing with your exchange on your desktop, but your node is on your phone.\\nNow what you have to do is go on your phone, generate an invoice\\nNow you have to somehow get it to your desktop, email it to yourself, I don't know, and then send it to Dave, the exchange, who can then go pay the invoice.\\nThis is just an awkward flow.\\nAll right, now I'm gonna dive into the various proposals.\"}, {\"type\":\"heading\",\"text\":\"LNURL\"}, {\"type\":\"paragraph\",\"text\":\"By the way, I'm gonna be focusing mostly on the pay scenario, not the withdrawal scenario.\\nOkay, so LNURL is short and sweet.\\nIt basically is a set of specs that spec out all the different communications that Alice and Dave can have with each other.\\nSo all this communication that happens outside of the network, it specs that out.\\nAnd what it allows us to do in the payments scenario, it allows Dave, so he can have this HTTP server with a static endpoint, dave.com/payme.\"}, {\"type\":\"paragraph\",\"text\":\"And this HTTP server will communicate with Dave's node.\\nAnd now all Alice does is she sees this endpoint, can see nothing needs to change in this.\\nIt can be static, it can be printed out, it can be tattooed on yourself.\\nAlice hits this endpoint, it'll get a fresh invoice for her and send it back.\\nAnd anyone can make the same request and be pretty sure that the invoice they're getting is gonna be unique.\\nSo this is really cool, as you can see, short and sweet.\"}, {\"type\":\"paragraph\",\"text\":\"And then you can have a similar idea with the withdrawal flow.\\nAnd if you wanna know more about that, ask the guys upstairs, Coincorner, because their cards are using LNURL-withdrawal.\\nOkay, so it allows me, for example, to throw up a code like this, show it safely to an audience.\\nI could not do this with a Bolt11 invoice, it wouldn't be safe.\\nAnd yeah, so it would be safe to hit the same point.\\nHa, so much beer for me.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, and what's also cool is that I can change the parameters of the invoice underneath this, and this doesn't need to change.\\nSo today I decide I wanna charge 10 sats for a beer.\\nTomorrow I decide 20 sats, and this can stay the same, okay?\\nAnd then this at the bottom is just an example of a small extension to LNURL-pay, called a Lightning address.\\nBut it pretty much works the same, but it's easy for me to dictate over the phone, please pay to this thing that sounds like an email address, which is nice.\"}, {\"type\":\"heading\",\"text\":\"Pros and Cons\"}, {\"type\":\"paragraph\",\"text\":\"Okay, short and sweet, as you've seen.\\nIt works already, many wallets already integrate LNURL.\\nNo changes to the Lightning network or Bolt11 are needed, because it's completely on top of the protocol.\\nGives us the static invoices with smaller QR codes, and it's an easy payment flow that people, it's easy for people to understand.\"}, {\"type\":\"paragraph\",\"text\":\"And then the big cons that people will talk about is that you need this HTTP server to receive like this.\\nAnd with that, if you're not using Tor, you don't know domain name, TLS cert, and things like that.\\nSo yeah, that's not ideal if you're running your node on your phone, for example.\"}, {\"type\":\"paragraph\",\"text\":\"And then the other thing is, again, if you're not using Tor, it's a bit of a privacy leak for both sender and receiver.\\nBecause you now have this server, and before I've said that Alice has a lot of anonymity because Dave doesn't know where the payment's coming from.\\nBut now she's making this get request to this HTTP server first, so she's revealing her IP address there.\"}, {\"type\":\"heading\",\"text\":\"Offers\"}, {\"type\":\"paragraph\",\"text\":\"Well, Bolt12, also known as Offers, is a very big proposal with many bells and whistles, brought forward by Rusty Russell from Blockstream.\\nAnd yeah, at a very high level, it's kind of very similar to LNURL, the flow and everything and the things it provides, except for the fact that this invoice retrieval that I've been speaking about happens within the network itself, meaning you don't need this extra HTTP server.\\nSo people with their mobile phones can have this.\\nAnd that's what makes it cool is that, yeah, you don't need anything extra.\\nSo when you spin up your node, this is already baked in for you.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so just a quick high level example.\\nWhat Dave will do is he'll create this thing called an offer now.\\nAnd it can be a static offer, and it'll just contain enough information for Alice to be able to find Dave within the network.\\nBut won't have anything necessarily that needs to change a lot.\\nSo this can be static.\"}, {\"type\":\"paragraph\",\"text\":\"And now, what Alice can use this information to find Dave within the network and send him within the network an invoice request.\\nDave gets this message, his node gets the message rather, and he sends the invoice back, again, through the network.\\nAnd now Alice can go ahead and pay it.\"}, {\"type\":\"paragraph\",\"text\":\"Awesome.\\nSeems really cool and simple, but there's actually a lot that goes into getting this invoice retrieval within the network to happen.\\nSo let's dive into that a bit.\\nSo first of all, we need to be able to send a message like this.\\nSo messaging in Lightning Network, can we use some of our existing messages.\\nSo the messages we currently have in the Lightning Network is we have gossip messages.\\nSo these are the messages you wanna broadcast, you wanna kinda flood them to the whole network.\"}, {\"type\":\"paragraph\",\"text\":\"You wanna tell the whole network, \\\"hey, new channel, new node, node channel updates\\\", etc.\\nSo this is not ideal, we don't want the whole network to know that we're requesting an invoice, and we definitely don't want the whole network to get that invoice.\"}, {\"type\":\"paragraph\",\"text\":\"And we quite heavily rate limit this.\\nSo a lot of nodes will batch the gossip that they send out, so it can be quite slow.\\nYou have to wait a bit, so this is not ideal for this scenario.\\nThe other types of messages that we have are the payment specific messages.\"}, {\"type\":\"paragraph\",\"text\":\"So in that example I showed before, Alice has to tell Bob and Charlie how they should go about forwarding their payments on, which channels they should use.\\nSo this is a bit closer to what we want.\\nbecause it's along a specific route that Alice chooses.\\nBut the thing is, they're payment specific messages.\\nAdd HTLC, fail HTLC.\"}, {\"type\":\"paragraph\",\"text\":\"And so you have to kind of create a payment to do this.\\nBut actually people do use this to send data across the network.\\nWhat you just do is you make a fake payment, so you come up with a hash.\\nDave doesn't know it's coming.\\nAnd, okay, Dave doesn't know it's coming.\"}, {\"type\":\"paragraph\",\"text\":\"You attach the data you wanna send, encrypt that so that only Dave can decrypt it.\\nSend the message to Dave, Dave gets it.\\nHe realizes he doesn't have the secret, but he can decrypt that message and just fail the payment back.\\nSo you can send a message like this.\"}, {\"type\":\"paragraph\",\"text\":\"It's just you need to tie up liquidity, which is fine if Dave's online.\\nBut if he's offline, then you have to wait for all those CLTV expires to occur, which is not great for the network.\\nOkay, so that means that for these offers to work, we need a whole new kind of messaging system to send these new messages.\"}, {\"type\":\"paragraph\",\"text\":\"And that's where Onion Messaging comes in.\\nSo, Bolt12 builds off of Onion Messages.\\nAnd these are basically do exactly kind of what it says.\\nIt allows Alice to just send a message to a specific person on the network, and she chooses the route for that message to go.\"}, {\"type\":\"paragraph\",\"text\":\"So, this is kind of one thing that people will kind of maybe say is a con, is that the whole network kind of, to work properly, the whole network kind of needs to update to understand what Onion Messages are.\\nBut I would say it's not that big of an issue, because if we're gonna get a lot of benefit from this, the Lightning Network is still small, and we can still update fast, and people do update fast.\\nSo yeah.\"}, {\"type\":\"paragraph\",\"text\":\"And there's many more other things you can do with Onion Messages.\\nIt's not just, so I've just mentioned the invoice request message and the invoice message, but you just think of, you can send any message.\"}, {\"type\":\"paragraph\",\"text\":\"So there's a lot more things to come, so I'm not gonna go into that now, but watch this space.\\nOkay, and then a few things you'll hear, especially on Twitter, is people will say, no, DoS.\\nPeople can spam the network, people are gonna stream movies over the network, etc.\\nSo that's kind of a big argument that people will have, and just because the current proposal doesn't have a solution for that built in.\"}, {\"type\":\"paragraph\",\"text\":\"And then the other thing is that Alice won't be able to, there's currently no way for Alice to know if her message got to Dave.\\nSo that's a little bit of an issue.\\nAnd then the other thing is Bob and Charlie are kind of helping Alice here for free.\"}, {\"type\":\"paragraph\",\"text\":\"Because there's no payment attached, there's no real incentive for them to pass on the message, except for the fact that, \\\"hey, I'm helping you now, so you'll help me later kind of thing\\\".\\nWhich we know we do in Bitcoin anyways with transactions.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, and then I just wanna say watch the space as well, because in the last two weeks, there have been some proposals coming out for how we can prevent this DoS vector.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, and then a few other really cool bells and whistles that Offers has is, first of all, I've spoken about hop-hints and why that's an issue and how we're revealing the UTXOs we actually intended to keep private, so Offers builds on using blinded paths instead of these hop-hints.\"}, {\"type\":\"paragraph\",\"text\":\"And this is basically a way for Dave to tell Alice how she can find him in the network, or rather how she can construct a route to him in the network without revealing to her where he is in the network.\\nYeah, so I'm not gonna go into detail of that, but definitely look into it.\\nAnd this is really cool because now Alice doesn't need to know exactly where Dave is, but she can still be paid.\\nAnd then if Alice wants a refund, she can provide a blinded path, so she doesn't have to give up her anonymity either.\\nOkay, and then the other really cool thing is payer proofs.\\nSo what's included is that Alice will, in this in which request she sends through the network to Dave, she will include a key that belongs to herself, so a payer key.\"}, {\"type\":\"paragraph\",\"text\":\"And now when Dave sends the invoice back, he needs to commit to the message she sent, meaning he's committing to her key.\\nMeaning now when Alice gets that S value back, that does prove that she was the one who made the payment, because the invoice itself shows that she's the one who requested that invoice.\\nOkay, so it's a great proof of payment.\"}, {\"type\":\"paragraph\",\"text\":\"And then another really cool thing is just that the signature for an offer message, invoice and invoice request messages are over a Merkle root of all the fields instead of over the whole thing.\\nSo if you need to go reveal it to someone, you can reveal only the information you would need to reveal.\\nOkay, it doesn't solve stuck payments, but let me just describe this first.\"}, {\"type\":\"heading\",\"text\":\"Stuck-less Payments\"}, {\"type\":\"paragraph\",\"text\":\"So basically what a stuck payment is, is if I go to the coffee shop and I get an invoice, make a payment, it gets stuck.\\nSo I get a new invoice, make a payment through a different route, and then that succeeds.\\nAnd then the first one also happens to succeed.\"}, {\"type\":\"paragraph\",\"text\":\"There's really no way for the coffee owner to tell that I only meant to pay once.\\nSo Offers kind of takes that into account.\\nAnd what you can do is when you go and make that second invoice request, you can say, \\\"hey, I'm intending to replace this first one\\\".\\nThat is still maybe will succeed.\\nSo just give some plausible deniability there.\\nAnd then what's cool is you can specify amounts in currencies other than Bitcoin, which is nice for the static case, especially when the price is fluctuating so much.\"}, {\"type\":\"paragraph\",\"text\":\"So you can have a thing that's static and you're saying, okay, I'm gonna specify the currency in USD for now\\nJust that you can keep that static and then, yeah, your wallet will need to get an exchange rate to pay it.\\nAnd then used to contain recurrence too.\\nSo you could say this is an offer and it means you're gonna have a monthly subscription to me, etc.\\nBut that's been removed for the time being.\"}, {\"type\":\"heading\",\"text\":\"Pros and cons.\"}, {\"type\":\"paragraph\",\"text\":\"So it's really cool that it's lightning native.\\nSo you can spin up this node and already get the benefits without needing to worry about this extra server.\\nImproved privacy for both sender and receiver because of blinded paths.\\nAnd again, because of the static invoicing, we have a better UX, fantastic proof of payments.\\nAnd then, okay, some cons is this network-wide upgrade, which I've mentioned isn't, I don't think, that big of an issue.\\nAnd then currently the issue is this dust protection isn't, there's no set solution for it yet.\\nAnd then another thing what people will just say is, it depends on a lot of things.\\nI've already mentioned onion messaging, route blinding.\\nYeah, it's just a lot to implement if you wanna use offers.\\nAnd then it does bring some application level stuff into the network, which some people aren't happy with.\\nLike I've said, with specifying the amounts in other currencies.\"}, {\"type\":\"heading\",\"text\":\"Atomic Multipath Payments\"}, {\"type\":\"paragraph\",\"text\":\"So first, before I go into this, just wanna mention that the kind of true beauty of AMP is it allows you to atomically use all your channels or many of your channels to make a single payment.\\nAnd kind of as a side effect, you can use a static invoice.\"}, {\"type\":\"heading\",\"text\":\"Single Path Case\"}, {\"type\":\"paragraph\",\"text\":\"So I'm gonna describe the static invoice thing first, and I'm just gonna use a single path to describe it.\\nSo basically, Dave creates a Bolt11 invoice.\\nAnd I've described before what kind of things the Bolt11 invoice includes.\\nAnd the reason it needs to change every time is because you need this payment hash to be different every time.\"}, {\"type\":\"paragraph\",\"text\":\"But with AMP, this payment hash is meaningless, and Dave will use his feature bits to tell Alice, okay, this is an AMP invoice, you can safely pay it many times.\\nAnd now, AMP needs to obviously understand this feature.\"}, {\"type\":\"paragraph\",\"text\":\"And before I go into the next point, so we have up until now assumed that Dave always needs to be the one who creates the secret and gets the hash and sends it to Alice.\"}, {\"type\":\"paragraph\",\"text\":\"But AMP flips that on its head like he sent, and Alice will be the one who comes up with the secret, gets the hash.\\nShe will encrypt the secret such that only Dave can decrypt it.\\nDo the whole onion encryption thing.\\nAnd now she'll go ahead with a payment to this hash.\\nShe will attach this as metadata to that message.\"}, {\"type\":\"paragraph\",\"text\":\"And when it gets to Dave, he can decrypt it and get the secret that he needs to claim the payment back, okay?\\nSo awesome, two things to take away from this.\\nThe first is Alice could do this without informing Dave of this beforehand.\"}, {\"type\":\"paragraph\",\"text\":\"So it allows for these spontaneous payments.\\nAnd the second thing is Alice has no proof of payment here.\\nSo her knowing the secret means nothing because she's the one who produced the secret.\\nOkay, so now I wanna just demonstrate the true kind of beauty of AMP and just show how it works visually.\\nSo basically Alice maybe wants to use all her channels to pay Dave.\"}, {\"type\":\"paragraph\",\"text\":\"So what she's gonna do is she's gonna come up with this thing called a root seed, which is just a big blob of data.\\nAnd she's gonna deterministically produce four different secrets, okay?\\nAnd get the hash of those secrets.\\nNow, four because she wants to use all four of her channels.\\nAnd now what she's gonna do is she's gonna split that root seed into four parts.\\nShe's gonna take the first hash, make the whole payment to that hash, attach the first part of the root seed.\\nGets to Dave, note that he cannot claim this payment back yet, because there's no way for him to know what the secret necessary is, is for.\"}, {\"type\":\"paragraph\",\"text\":\"So only when all the parts get to Dave can he reconstruct this root seed, get the secrets again, and claim the payments.\\nYeah, so that's the beauty.\"}, {\"type\":\"heading\",\"text\":\"Pros and cons.\"}, {\"type\":\"paragraph\",\"text\":\"Again, static invoice.\\nOnly Alice and Dave needed to be aware of AMP.\\nAnd it allows Alice to just pay, again, Dave without letting him know first.\\nAnd yeah, we can reuse bolt11 invoices.\\nAnd again, you can take advantage of all your channels, which is nice, especially if it's a new user who doesn't understand channels.\\nYou can just show them one balance and they can use that entire balance.\\nAgain, and then the big con is that there's no proof of payment.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so just to end off, just wanna show high level comparison and just leave you with a few questions.\\nSo just to show the lightning layers, Bolt 1 to 11 currently kind of covers these layers, networking, messaging, payments, and invoicing.\\nAnd then on top of that, we anyways need to do this invoice negotiation.\\nAnd on top of that, we can build up applications.\\nOkay, so where do these three things lie?\"}, {\"type\":\"paragraph\",\"text\":\"So LNURL just kind of just specs out invoice negotiation, or at least LNURL-pay that I've been speaking about.\\nAnd then AMP is just a new payment type.\\nAnd Offers quite a big vertical stretch.\"}, {\"type\":\"paragraph\",\"text\":\"It touches quite a few things.\\nThis is not included in Offers, but it depends on onion messaging.\\nIt has a different invoice.\\nOkay, it has a new type of invoicing.\\nIt specs out invoice negotiation, and it does include some application level things like specifying the amount in different currency.\\nSo a few points of discussion.\"}, {\"type\":\"paragraph\",\"text\":\"Just if you're looking at arguments on Twitter, these are kind of the things that people argue about.\\nOkay, so the first is how important is this proof of payment?\\nSo I've been speaking about how current Bolt11 invoicing has a kind of semi-weak proof of payment.\\nAMP doesn't really have one yet.\\nTaproot and PTLCs changes things.\\nAnd then offers us a really strong proof of payment.\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so people, and then sorry, one side will kind of argue.\\nOne side will kind of say, okay, it's obviously really important because when the network is super huge, you're really, really, really gonna wanna have that proof of payment.\"}, {\"type\":\"paragraph\",\"text\":\"And then the other side will kind of say, okay, but how often are people currently actually using this proof of payment?\\nYou know, a lot of wallets don't even show users their pre-image.\\nSo that's kind of the two sides.\\nOkay, the other argument is what should we and should we not include in the protocol?\\nYeah, where do we draw that line?\\nAnd then the other thing is, do we need to have just one invoicing system?\\nLike, can we not mix them somehow?\"}, {\"type\":\"paragraph\",\"text\":\"Maybe, do we want one that works for every type of user?\\nLike, people will say, LNURL is really good for merchants because they will anyways have a server running, but it's not really good for someone who just wants a wallet on their phone.\\nAnd then, yeah, so like, but it works really well for people who are merchants, and then offers works really well for people who have their wallet on their phone.\\nSo, can we have them both?\\nDo we need just one?\\nYeah, so I'm not answering these questions.\\nI'm just leaving you with them.\\nYeah, that's it.\\nCool.\"}",
    "body": "## Intro\n\nHi guys, I'm Elle, and I'm going to be talking about static invoices in the Lightning Network.\nAs most of you probably know, in Lightning, currently if you want to be paid, you have to create a new invoice every time.\nAnd this is a bit of a difficult thing for people to understand who don't know anything about the space.\nToday I'm going to just be diving into exactly why it's a mission for us to have these static invoices, and then just outlining the three various proposals LNURL, Offers and AMP that people have been discussing.\n\nBefore I carry on, I just want to mention a few things.\nFirst of all, if you're a Lightning developer, this talk is really not for you.\nI just want more people to be able to join the discussion.\nSo it's just making sure everybody understands the various components.\nTo the Lightning developers, if I say anything incorrect, please shout at me.\nThe one thing that all these three proposals have in common is they give us these static invoices, but each of them have other features that are really cool, and I will mention those as well.\nWe can't really compare them.\n\nOkay, just a quick talk overview.\nI feel it's very important to make sure everybody understands what the issue is, so I'm going to spend a little bit of time on a payment deep dive.\nNot a deep dive, just an overview so everyone understands what we need to have payments work in the Lightning network.\nFrom that, we'll understand why Bolt11 invoices are a thing.\nThen I'll talk about the issues with those things, and then from there we can go into the various proposals.\nAnd then I'll just give a quick high level overview and mention some of the arguments that people have been talking about on Twitter.\nAnd leave you with some questions to think about.\n\n## Lightning Payments 101\n\nOkay, so as all of you probably know, Lightning is made up of a bunch of channels, which is just a contract between Alice and Bob, they've got a two of two multi-sig, allows them to do value transfer between each other many times, very fast, off-chain.\nSo really cool, if the whole Lightning network is made up of channel between every person, static invoices are solved, not a problem.\nI can finish my talk right now.\n\nBut the thing is, this doesn't scale.\nYou can't have a UTXO open with every single person in the world that you're gonna wanna have to pay, so this doesn't work.\nAnd the beauty of Lightning network is that Alice's view can look a little bit more something like this, and all she needs to do to pay someone like Dave is find a route to Dave.\n\nLet's look at that a bit.\nShe finds a route to Dave, and she just needs to focus on that.\nSo now, how does Alice pay Dave.\nWhy can't this be static?\nWhy can't she just tell her node, \"please pay Dave's node ID this amount of Bitcoin\".\nThat's a static thing.\n\nThe naive way would be Alice just tells Bob, \"hey Bob, please help me out.\nI'm gonna tip you, I'm gonna leave one Bitcoin with you, and please just push two over to Charlie, and tell him to do the same with Dave\".\nCool, that's great, Dave got paid.\nThat doesn't work, because in Bitcoin we can't trust Bob.\nIn reality, if Alice pushes money over to Bob, there's nothing stopping Bob from just running away at this point.\nOkay, so Lightning payments don't work like that.\n\nHow do they work?\nWhat we actually do is, before the payment can happen, before we even touch the Lightning network, Alice says, \"hey Dave, I'm gonna pay you, please be aware.\"\nDave goes ahead and generates a secret, takes the hash of that secret, and sends it back to Alice.\nThis happens all outside of the Lightning network.\nNow Alice goes again to Bob, but this time she tells him, \"hey Bob, you can have these 3 Bitcoin, but only if you can unlock this hash.\nIf you can't unlock it, I'm gonna get the money back after some time lock\".\nSo Bob sees this, realizes he's only gonna get a tip if he continues the pattern onto Charlie so that he can eventually get the secret.\n\nNow he does the same thing with Charlie, Charlie does the same thing with Dave.\nDave has the secret, so Dave can unlock this hash, get his funds, and Charlie can then do the same with Bob, and Bob can do the same with Alice.\nAnd at this point, Alice has the secret, and Dave has been successfully paid, and her having the secret is what we call a proof of payment.\n\nThat's kind of the payments 101 complete, and there's two things you should take away from this.\nIt's actually just one thing, but the first thing is, there had to be this dance between Alice and Dave happening outside the network before the payment could actually happen.\nAnd then just leading on from that is: okay, why?\n\nDave had to send her this thing called a hash, but there's actually quite a few other things that Dave needs to tell Alice.\nAnd that's where Bolt11 invoices comes in.\n\n## Bolt11 Invoices\n\nBolt11 just specs out how Dave should structure the information that he sends to Alice.\nSo that any wallet can just know how to structure its information, how to read the information.\nI'm sure you've all seen a Bolt11 invoice.\nIt's usually displayed as a QR code or some LN something something.\nNotice this is a regtest invoice because it's not safe to pay to this, and I'll get to that in a second.\n\nJust diving into a little bit more about what Bolt11 invoices look like, you'll have your prefix, that LN part, the amount that Dave expects, timestamp, some array of data that I'll get back to in a second, and a signature over the entire thing.\nNow, I've already mentioned that one of the pieces of data is this payment hash, and it's very important because it's the only way payment can be secure, so that's the first thing.\nThe other thing is, it needs to contain a node ID.\n\nAlice, if she walks into Dave's coffee shop, needs to know how to find him in the network, so it needs to be a node ID.\nThe other thing is it optionally needs to include something called Hop-Hints, because perhaps Alice's network view looks something more like this, where Dave only has private channels, and so Alice doesn't know where he is.\n\nSo he has to actually tell her which UTXOs those private channels are if she's ever gonna find him in the network.\nSo the invoice needs to include that.\nMaybe it contains a description, \"this is for one cup of coffee\", and then some feature bits.\nSo it's just a way for Dave to say to Alice, \"hey, I'm aware of this payment or this feature\", etc.\n\nAnd then some other stuff, but I'm just gonna focus on those.\nSo, what's wrong with this?\nThe main thing I wanna focus on: it's single use, so I think people will often say, \"okay, invoice is single use, yes, that's unsecure\".\nI just wanna demonstrate exactly why.\n\nLet's say Alice and Bob both walk into Dave's coffee shop.\nDave generates an invoice because he wants to be paid.\nCreates a Bolt11 invoice, displays it.\nAnd Alice goes ahead, pays this as we saw before.\nAnd Dave reveals the secret, and Alice has a proof of payment for this invoice.\nBut it just so happens that Bob saw the invoice at the same time, thought it was his maybe, and tried to start paying it.\nSo he goes ahead, pays it.\n\nNow, what happens if Eve and Charlie are the same person or in cahoots with each other?\nCharlie can just send the secret, he knows it now, to Eve.\nAnd get the money from Bob.\nBob thinks, \"yay, I've got proof of payment.\"\nAnd Dave has not been paid.\nHe's only been paid once.\nSo you can see that if you are paying an invoice, it's very important to you that no one else has paid this invoice before.\nIt's very important.\n\nThis leads me on to my next point, which is that this is a very weak proof of payment.\nI've just said that both Alice and Bob have this proof of payment.\nSo really, having the secret just reveals that the payment has been complete at some point, does not prove that you have paid it.\n\nThen just a few other issues is, I've mentioned that Dave needs to maybe include hop-hints in his invoice.\nIf all his channels are private, this kind of defeats the point, they're no longer really private channels.\nAlice can sell that information.\nSo that's not ideal.\n\nThe other thing is sender and receiver privacy.\nIn this example that I showed where Alice pays Dave, Dave has zero privacy.\nAlice knows exactly where this payment is going.\nBut Alice has a lot of privacy.\nDave doesn't know where this payment is coming from, unless Alice now wants a refund, in which case she has to give up where she is in the network, which is not a nice decision to make.\n\nAnd then a small thing is that the Bolt11 signature that Dave makes to just prove that he created it, is over the entire thing as a flat structure.\nWhich is just not great if you wanna go and show that invoice and now you have to reveal all these pieces of information if you wanna show that the signature is valid.\n\nSome bad UX.\nThis is a valid Bolt11 invoice, just stuffed with 20 hop-hints.\nAnd you can see this is not ideal.\nPeople at the back are not gonna be able to scan this with their phones.\nAnd it just demonstrates that you're kind of very much limited.\nThere's a limit to how much information Dave can send to Alice using this method.\nAnd then it's just a little bit of an awkward flow.\n\nWe're used to paying directly to a static bank account that doesn't change.\nNow we have to tell users, \"okay, if you wanna be paid, someone needs to tell you first they wanna pay you\".\nYou tell your node, please give me a new invoice.\nAnd then you send it back to the person, and then they can tell their node to pay it.\nAnd it's just a little bit awkward.\n\nAnd then another awkward flow is the withdrawal flow.\nLet's say Dave is an exchange, and you wanna withdraw some money from the exchange.\nLet's say you are interfacing with your exchange on your desktop, but your node is on your phone.\nNow what you have to do is go on your phone, generate an invoice\nNow you have to somehow get it to your desktop, email it to yourself, I don't know, and then send it to Dave, the exchange, who can then go pay the invoice.\nThis is just an awkward flow.\nAll right, now I'm gonna dive into the various proposals.\n\n## LNURL\n\nBy the way, I'm gonna be focusing mostly on the pay scenario, not the withdrawal scenario.\nOkay, so LNURL is short and sweet.\nIt basically is a set of specs that spec out all the different communications that Alice and Dave can have with each other.\nSo all this communication that happens outside of the network, it specs that out.\nAnd what it allows us to do in the payments scenario, it allows Dave, so he can have this HTTP server with a static endpoint, dave.com/payme.\n\nAnd this HTTP server will communicate with Dave's node.\nAnd now all Alice does is she sees this endpoint, can see nothing needs to change in this.\nIt can be static, it can be printed out, it can be tattooed on yourself.\nAlice hits this endpoint, it'll get a fresh invoice for her and send it back.\nAnd anyone can make the same request and be pretty sure that the invoice they're getting is gonna be unique.\nSo this is really cool, as you can see, short and sweet.\n\nAnd then you can have a similar idea with the withdrawal flow.\nAnd if you wanna know more about that, ask the guys upstairs, Coincorner, because their cards are using LNURL-withdrawal.\nOkay, so it allows me, for example, to throw up a code like this, show it safely to an audience.\nI could not do this with a Bolt11 invoice, it wouldn't be safe.\nAnd yeah, so it would be safe to hit the same point.\nHa, so much beer for me.\n\nOkay, and what's also cool is that I can change the parameters of the invoice underneath this, and this doesn't need to change.\nSo today I decide I wanna charge 10 sats for a beer.\nTomorrow I decide 20 sats, and this can stay the same, okay?\nAnd then this at the bottom is just an example of a small extension to LNURL-pay, called a Lightning address.\nBut it pretty much works the same, but it's easy for me to dictate over the phone, please pay to this thing that sounds like an email address, which is nice.\n\n### Pros and Cons\n\nOkay, short and sweet, as you've seen.\nIt works already, many wallets already integrate LNURL.\nNo changes to the Lightning network or Bolt11 are needed, because it's completely on top of the protocol.\nGives us the static invoices with smaller QR codes, and it's an easy payment flow that people, it's easy for people to understand.\n\nAnd then the big cons that people will talk about is that you need this HTTP server to receive like this.\nAnd with that, if you're not using Tor, you don't know domain name, TLS cert, and things like that.\nSo yeah, that's not ideal if you're running your node on your phone, for example.\n\nAnd then the other thing is, again, if you're not using Tor, it's a bit of a privacy leak for both sender and receiver.\nBecause you now have this server, and before I've said that Alice has a lot of anonymity because Dave doesn't know where the payment's coming from.\nBut now she's making this get request to this HTTP server first, so she's revealing her IP address there.\n\n## Offers\n\nWell, Bolt12, also known as Offers, is a very big proposal with many bells and whistles, brought forward by Rusty Russell from Blockstream.\nAnd yeah, at a very high level, it's kind of very similar to LNURL, the flow and everything and the things it provides, except for the fact that this invoice retrieval that I've been speaking about happens within the network itself, meaning you don't need this extra HTTP server.\nSo people with their mobile phones can have this.\nAnd that's what makes it cool is that, yeah, you don't need anything extra.\nSo when you spin up your node, this is already baked in for you.\n\nOkay, so just a quick high level example.\nWhat Dave will do is he'll create this thing called an offer now.\nAnd it can be a static offer, and it'll just contain enough information for Alice to be able to find Dave within the network.\nBut won't have anything necessarily that needs to change a lot.\nSo this can be static.\n\nAnd now, what Alice can use this information to find Dave within the network and send him within the network an invoice request.\nDave gets this message, his node gets the message rather, and he sends the invoice back, again, through the network.\nAnd now Alice can go ahead and pay it.\n\nAwesome.\nSeems really cool and simple, but there's actually a lot that goes into getting this invoice retrieval within the network to happen.\nSo let's dive into that a bit.\nSo first of all, we need to be able to send a message like this.\nSo messaging in Lightning Network, can we use some of our existing messages.\nSo the messages we currently have in the Lightning Network is we have gossip messages.\nSo these are the messages you wanna broadcast, you wanna kinda flood them to the whole network.\n\nYou wanna tell the whole network, \"hey, new channel, new node, node channel updates\", etc.\nSo this is not ideal, we don't want the whole network to know that we're requesting an invoice, and we definitely don't want the whole network to get that invoice.\n\nAnd we quite heavily rate limit this.\nSo a lot of nodes will batch the gossip that they send out, so it can be quite slow.\nYou have to wait a bit, so this is not ideal for this scenario.\nThe other types of messages that we have are the payment specific messages.\n\nSo in that example I showed before, Alice has to tell Bob and Charlie how they should go about forwarding their payments on, which channels they should use.\nSo this is a bit closer to what we want.\nbecause it's along a specific route that Alice chooses.\nBut the thing is, they're payment specific messages.\nAdd HTLC, fail HTLC.\n\nAnd so you have to kind of create a payment to do this.\nBut actually people do use this to send data across the network.\nWhat you just do is you make a fake payment, so you come up with a hash.\nDave doesn't know it's coming.\nAnd, okay, Dave doesn't know it's coming.\n\nYou attach the data you wanna send, encrypt that so that only Dave can decrypt it.\nSend the message to Dave, Dave gets it.\nHe realizes he doesn't have the secret, but he can decrypt that message and just fail the payment back.\nSo you can send a message like this.\n\nIt's just you need to tie up liquidity, which is fine if Dave's online.\nBut if he's offline, then you have to wait for all those CLTV expires to occur, which is not great for the network.\nOkay, so that means that for these offers to work, we need a whole new kind of messaging system to send these new messages.\n\nAnd that's where Onion Messaging comes in.\nSo, Bolt12 builds off of Onion Messages.\nAnd these are basically do exactly kind of what it says.\nIt allows Alice to just send a message to a specific person on the network, and she chooses the route for that message to go.\n\nSo, this is kind of one thing that people will kind of maybe say is a con, is that the whole network kind of, to work properly, the whole network kind of needs to update to understand what Onion Messages are.\nBut I would say it's not that big of an issue, because if we're gonna get a lot of benefit from this, the Lightning Network is still small, and we can still update fast, and people do update fast.\nSo yeah.\n\nAnd there's many more other things you can do with Onion Messages.\nIt's not just, so I've just mentioned the invoice request message and the invoice message, but you just think of, you can send any message.\n\nSo there's a lot more things to come, so I'm not gonna go into that now, but watch this space.\nOkay, and then a few things you'll hear, especially on Twitter, is people will say, no, DoS.\nPeople can spam the network, people are gonna stream movies over the network, etc.\nSo that's kind of a big argument that people will have, and just because the current proposal doesn't have a solution for that built in.\n\nAnd then the other thing is that Alice won't be able to, there's currently no way for Alice to know if her message got to Dave.\nSo that's a little bit of an issue.\nAnd then the other thing is Bob and Charlie are kind of helping Alice here for free.\n\nBecause there's no payment attached, there's no real incentive for them to pass on the message, except for the fact that, \"hey, I'm helping you now, so you'll help me later kind of thing\".\nWhich we know we do in Bitcoin anyways with transactions.\n\nOkay, and then I just wanna say watch the space as well, because in the last two weeks, there have been some proposals coming out for how we can prevent this DoS vector.\n\nOkay, and then a few other really cool bells and whistles that Offers has is, first of all, I've spoken about hop-hints and why that's an issue and how we're revealing the UTXOs we actually intended to keep private, so Offers builds on using blinded paths instead of these hop-hints.\n\nAnd this is basically a way for Dave to tell Alice how she can find him in the network, or rather how she can construct a route to him in the network without revealing to her where he is in the network.\nYeah, so I'm not gonna go into detail of that, but definitely look into it.\nAnd this is really cool because now Alice doesn't need to know exactly where Dave is, but she can still be paid.\nAnd then if Alice wants a refund, she can provide a blinded path, so she doesn't have to give up her anonymity either.\nOkay, and then the other really cool thing is payer proofs.\nSo what's included is that Alice will, in this in which request she sends through the network to Dave, she will include a key that belongs to herself, so a payer key.\n\nAnd now when Dave sends the invoice back, he needs to commit to the message she sent, meaning he's committing to her key.\nMeaning now when Alice gets that S value back, that does prove that she was the one who made the payment, because the invoice itself shows that she's the one who requested that invoice.\nOkay, so it's a great proof of payment.\n\nAnd then another really cool thing is just that the signature for an offer message, invoice and invoice request messages are over a Merkle root of all the fields instead of over the whole thing.\nSo if you need to go reveal it to someone, you can reveal only the information you would need to reveal.\nOkay, it doesn't solve stuck payments, but let me just describe this first.\n\n### Stuck-less Payments\n\nSo basically what a stuck payment is, is if I go to the coffee shop and I get an invoice, make a payment, it gets stuck.\nSo I get a new invoice, make a payment through a different route, and then that succeeds.\nAnd then the first one also happens to succeed.\n\nThere's really no way for the coffee owner to tell that I only meant to pay once.\nSo Offers kind of takes that into account.\nAnd what you can do is when you go and make that second invoice request, you can say, \"hey, I'm intending to replace this first one\".\nThat is still maybe will succeed.\nSo just give some plausible deniability there.\nAnd then what's cool is you can specify amounts in currencies other than Bitcoin, which is nice for the static case, especially when the price is fluctuating so much.\n\nSo you can have a thing that's static and you're saying, okay, I'm gonna specify the currency in USD for now\nJust that you can keep that static and then, yeah, your wallet will need to get an exchange rate to pay it.\nAnd then used to contain recurrence too.\nSo you could say this is an offer and it means you're gonna have a monthly subscription to me, etc.\nBut that's been removed for the time being.\n\n### Pros and cons.\n\nSo it's really cool that it's lightning native.\nSo you can spin up this node and already get the benefits without needing to worry about this extra server.\nImproved privacy for both sender and receiver because of blinded paths.\nAnd again, because of the static invoicing, we have a better UX, fantastic proof of payments.\nAnd then, okay, some cons is this network-wide upgrade, which I've mentioned isn't, I don't think, that big of an issue.\nAnd then currently the issue is this dust protection isn't, there's no set solution for it yet.\nAnd then another thing what people will just say is, it depends on a lot of things.\nI've already mentioned onion messaging, route blinding.\nYeah, it's just a lot to implement if you wanna use offers.\nAnd then it does bring some application level stuff into the network, which some people aren't happy with.\nLike I've said, with specifying the amounts in other currencies.\n\n## Atomic Multipath Payments\n\nSo first, before I go into this, just wanna mention that the kind of true beauty of AMP is it allows you to atomically use all your channels or many of your channels to make a single payment.\nAnd kind of as a side effect, you can use a static invoice.\n\n\n### Single Path Case\n\nSo I'm gonna describe the static invoice thing first, and I'm just gonna use a single path to describe it.\nSo basically, Dave creates a Bolt11 invoice.\nAnd I've described before what kind of things the Bolt11 invoice includes.\nAnd the reason it needs to change every time is because you need this payment hash to be different every time.\n\nBut with AMP, this payment hash is meaningless, and Dave will use his feature bits to tell Alice, okay, this is an AMP invoice, you can safely pay it many times.\nAnd now, AMP needs to obviously understand this feature.\n\nAnd before I go into the next point, so we have up until now assumed that Dave always needs to be the one who creates the secret and gets the hash and sends it to Alice.\n\nBut AMP flips that on its head like he sent, and Alice will be the one who comes up with the secret, gets the hash.\nShe will encrypt the secret such that only Dave can decrypt it.\nDo the whole onion encryption thing.\nAnd now she'll go ahead with a payment to this hash.\nShe will attach this as metadata to that message.\n\nAnd when it gets to Dave, he can decrypt it and get the secret that he needs to claim the payment back, okay?\nSo awesome, two things to take away from this.\nThe first is Alice could do this without informing Dave of this beforehand.\n\nSo it allows for these spontaneous payments.\nAnd the second thing is Alice has no proof of payment here.\nSo her knowing the secret means nothing because she's the one who produced the secret.\nOkay, so now I wanna just demonstrate the true kind of beauty of AMP and just show how it works visually.\nSo basically Alice maybe wants to use all her channels to pay Dave.\n\nSo what she's gonna do is she's gonna come up with this thing called a root seed, which is just a big blob of data.\nAnd she's gonna deterministically produce four different secrets, okay?\nAnd get the hash of those secrets.\nNow, four because she wants to use all four of her channels.\nAnd now what she's gonna do is she's gonna split that root seed into four parts.\nShe's gonna take the first hash, make the whole payment to that hash, attach the first part of the root seed.\nGets to Dave, note that he cannot claim this payment back yet, because there's no way for him to know what the secret necessary is, is for.\n\nSo only when all the parts get to Dave can he reconstruct this root seed, get the secrets again, and claim the payments.\nYeah, so that's the beauty.\n\n\n### Pros and cons.\n\nAgain, static invoice.\nOnly Alice and Dave needed to be aware of AMP.\nAnd it allows Alice to just pay, again, Dave without letting him know first.\nAnd yeah, we can reuse bolt11 invoices.\nAnd again, you can take advantage of all your channels, which is nice, especially if it's a new user who doesn't understand channels.\nYou can just show them one balance and they can use that entire balance.\nAgain, and then the big con is that there's no proof of payment.\n\nOkay, so just to end off, just wanna show high level comparison and just leave you with a few questions.\nSo just to show the lightning layers, Bolt 1 to 11 currently kind of covers these layers, networking, messaging, payments, and invoicing.\nAnd then on top of that, we anyways need to do this invoice negotiation.\nAnd on top of that, we can build up applications.\nOkay, so where do these three things lie?\n\nSo LNURL just kind of just specs out invoice negotiation, or at least LNURL-pay that I've been speaking about.\nAnd then AMP is just a new payment type.\nAnd Offers quite a big vertical stretch.\n\nIt touches quite a few things.\nThis is not included in Offers, but it depends on onion messaging.\nIt has a different invoice.\nOkay, it has a new type of invoicing.\nIt specs out invoice negotiation, and it does include some application level things like specifying the amount in different currency.\nSo a few points of discussion.\n\nJust if you're looking at arguments on Twitter, these are kind of the things that people argue about.\nOkay, so the first is how important is this proof of payment?\nSo I've been speaking about how current Bolt11 invoicing has a kind of semi-weak proof of payment.\nAMP doesn't really have one yet.\nTaproot and PTLCs changes things.\nAnd then offers us a really strong proof of payment.\n\nOkay, so people, and then sorry, one side will kind of argue.\nOne side will kind of say, okay, it's obviously really important because when the network is super huge, you're really, really, really gonna wanna have that proof of payment.\n\nAnd then the other side will kind of say, okay, but how often are people currently actually using this proof of payment?\nYou know, a lot of wallets don't even show users their pre-image.\nSo that's kind of the two sides.\nOkay, the other argument is what should we and should we not include in the protocol?\nYeah, where do we draw that line?\nAnd then the other thing is, do we need to have just one invoicing system?\nLike, can we not mix them somehow?\n\nMaybe, do we want one that works for every type of user?\nLike, people will say, LNURL is really good for merchants because they will anyways have a server running, but it's not really good for someone who just wants a wallet on their phone.\nAnd then, yeah, so like, but it works really well for people who are merchants, and then offers works really well for people who have their wallet on their phone.\nSo, can we have them both?\nDo we need just one?\nYeah, so I'm not answering these questions.\nI'm just leaving you with them.\nYeah, that's it.\nCool.\n\n",
    "body_type": "markdown",
    "created_at": "2022-03-03T00:00:00.000Z",
    "domain": "https://btctranscripts.com/",
    "url": "https://btctranscripts.com/advancing-bitcoin/2022/static-invoices-in-lightning",
    "categories": [
        "conference"
    ],
    "tags": [
        "lnurl",
        "offers",
        "amp"
    ],
    "media": "https://www.youtube.com/watch?v=WsSa00gUvZw",
    "authors": [
        "Elle Mouton"
    ],
    "indexed_at": "2024-03-21T16:33:35.879Z",
    "transcript_by": "b3h3rkz via review.btctranscripts.com",
    "summary": "In an era marked by rapid technological advancements, the domain of cryptocurrency, particularly within the Lightning Network, is experiencing significant growth and transformation. Elle Mouton's insightful exploration into this evolving landscape offers a deep dive into the challenges and innovations shaping the future of cryptocurrency transactions. At the heart of Mouton's discussion is the critical issue of user experience, specifically the cumbersome necessity for generating new invoices for every transaction\u2014a process that starkly contrasts with the static nature of traditional financial transactions. Through her examination, Mouton not only identifies the core problem but also introduces three promising solutions: LNURL, Offers (Bolt12), and Atomic Multi-Path Payments (AMP), each designed to enhance the Lightning Network's usability and security.\n\nMouton begins by laying the foundational understanding of how payments operate within the Lightning Network, elucidating the network's structure and the pivotal role of Bolt11 invoices in facilitating secure, off-chain value transfers. Despite their utility, these invoices pose significant drawbacks, including security risks and complications in privacy and user experience. It is against this backdrop that Mouton discusses the proposed solutions, starting with LNURL. This protocol, by enabling the creation of static endpoints for invoice generation, proposes to simplify transactions significantly, akin to traditional banking methods. However, Mouton does not shy away from addressing its limitations, such as the privacy concerns associated with the necessity of an HTTP server.\n\nTransitioning to Rusty Russell's proposal, Offers (Bolt12), Mouton highlights its potential to streamline invoice retrieval directly within the network, thereby enhancing simplicity and accessibility, especially for mobile users. Despite the appeal, she acknowledges the hurdles in its adoption, including the need for a new messaging system and network-wide upgrade. Yet, the innovation it brings, alongside emerging proposals to mitigate vulnerabilities like network spamming, showcases a forward-thinking approach to refining the Lightning Network.\n\nFurthermore, Mouton delves into AMP, presenting it as a revolutionary method that facilitates the use of multiple channels for a single transaction, optimizing channel utilization and enhancing security. While praising its integration with existing systems and its ability to streamline transactions, Mouton also points out the absence of a proof of payment mechanism as a notable limitation, sparking discussions on its necessity and potential implementation.\n\nThroughout her presentation, Mouton navigates the intricate dynamics of modern cryptocurrency transactions, presenting LNURL, Bolt12 (Offers), and AMP as critical developments in the pursuit of a more streamlined, secure, and private digital payment ecosystem. Her discourse not only sheds light on the technical aspects of these innovations but also stimulates broader contemplation on their impact, underscoring the continuous evolution of the Lightning Network and the collaborative effort required to overcome existing challenges.\n\nIn conclusion, Elle Mouton's examination of the complexities and innovations within cryptocurrency payment systems serves as a crucial conversation starter. By comparing and contrasting various protocols and unpacking their functionalities and challenges, Mouton invites her audience to engage with the ongoing development of the Lightning Network. Her presentation encourages thoughtful consideration of the balance between innovation and practicality, emphasizing the importance of a more inclusive, secure, and efficient payment landscape in the broader context of cryptocurrency evolution."
}