{
    "id": "bitcointranscripts+bitcoin-explained+bitcoin-core-v21-supports-tor-v3",
    "title": "Bitcoin Core 0.21 Supports Tor V3",
    "body_formatted": "{\"type\":\"heading\",\"text\":\"Introduction\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:07\"}, {\"type\":\"paragraph\",\"text\":\"Live from Utrecht, this is the Van Wirdum Sjorsnado.\\nSjors, you pointed out to me that Bitcoin Core has an amazing new feature merged into its repository.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:00:19\"}, {\"type\":\"paragraph\",\"text\":\"Absolutely, we have bigger onions now.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:24\"}, {\"type\":\"paragraph\",\"text\":\"Right, so I had basically no idea what it meant.\\nYou figured it out.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:00:29\"}, {\"type\":\"paragraph\",\"text\":\"I did.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:34\"}, {\"type\":\"paragraph\",\"text\":\"Yeah so let's start at the beginning.\\nIt's about Tor.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:00:40\"}, {\"type\":\"paragraph\",\"text\":\"Tor was the big motivator to get everything in there.\\nHave you ever used Tor or do you know what Tor is?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:51\"}, {\"type\":\"paragraph\",\"text\":\"I have a basic understanding of what Tor is, yes.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:00:53\"}, {\"type\":\"paragraph\",\"text\":\"When you see a Tor address it looks quite weird.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:58\"}, {\"type\":\"paragraph\",\"text\":\"Right.\"}, {\"type\":\"heading\",\"text\":\"How does Tor work?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:00:58\"}, {\"type\":\"paragraph\",\"text\":\"And so the idea is that it's a public key, essentially, a TOR address.\\nAnd that refers to a hidden server somewhere on the internet.\\nAnd the way you communicate to that hidden server is not directly because you don't know its IP address but indirectly through the Tor network and you use onion packages for that.\\nSo the idea is that you start from the inside the last hop before the hidden server and you give that hop instructions how to reach the hidden servers and then you write instructions for the second last hop and you give it instructions how to reach the first hop.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:01:42\"}, {\"type\":\"paragraph\",\"text\":\"Everyone is still using IP addresses it's just you don't know the IP address of the the Tor node you're communicating with instead you're communicating with other Tor nodes and every Tor node communicates with a direct peer so they all everyone only knows the IP address of their direct peer, but they don't know where the message originated or where it ends up.\\nPlus, they can't read the message because it's encrypted.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:10\\nThat's right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:11\"}, {\"type\":\"paragraph\",\"text\":\"And in order to support this, all of these Tor nodes have their own IP address, which is their onion address, and that's what they use to, that's what you're communicating with directly.\"}, {\"type\":\"heading\",\"text\":\"Benefits of running a Bitcoin node behind Tor\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:23\"}, {\"type\":\"paragraph\",\"text\":\"And Bitcoin Core nodes can run behind such a hidden surface.\\nSo everybody can have their Bitcoin node run at a secret location so your IP address remains secret.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:35\"}, {\"type\":\"paragraph\",\"text\":\"What's the practical benefit of that?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:38\"}, {\"type\":\"paragraph\",\"text\":\"Your IP address remains secret so if you don't want the rest of the world to know that your IP address is running a Bitcoin node, maybe that's useful.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:48\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and I think it's also because if you're sending transactions from an IP address, then network analyzers can reveal where transactions originated.\\nAlthough I guess that's also being solved.\\nThere's other solutions for that as well.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:03:03\"}, {\"type\":\"paragraph\",\"text\":\"That's defense in depth.\\nIdeally your node behaves in a way that it looks indistinguishable from all other nodes.\\nYour node downloads all the blocks and it downloads all the mempool transactions and you can't tell which wallet is running inside which node, but there's all these sneaky companies that try anyway.\\nAnd then they might know that you sent a specific transaction, or then they might know which Bitcoins belong to you, and since your IP address is quite easy to figure out who you are.\\nIt could be nice to have Tor in theory.\\nBut regardless, that's just how it works.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:03:40\"}, {\"type\":\"paragraph\",\"text\":\"So you can use Bitcoin from behind Tor and I think the thing was that there's a new type of Onion addresses.\\nThere was an update in the Tor protocol.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:03:52\"}, {\"type\":\"paragraph\",\"text\":\"That's right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:03:52\"}, {\"type\":\"paragraph\",\"text\":\"And that uses new addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:03:55\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nSo the Tor addresses are now longer, which just makes them more secure.\\nWe don't need to go into why that is, because I don't know why that is.\\nAll we know is that Onion addresses now, in version 3, are a bit longer.\\nAnd that means that if you want to keep running a Bitcoin node on Tor, you'll have to use those longer addresses because Tor is centralized and they have decided to eventually get rid of the version 2 addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:23\"}, {\"type\":\"paragraph\",\"text\":\"Okay, but they didn't yet.\\nSo right now version 2 addresses are still usable?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:27\"}, {\"type\":\"paragraph\",\"text\":\"Yes, I think they've been officially deprecated now and I think in about a year or so, they won't work anymore.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:33\"}, {\"type\":\"paragraph\",\"text\":\"I see.\\nSo anyone who wants to continue using Tor needs to upgrade before next year.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:42\"}, {\"type\":\"paragraph\",\"text\":\"Something like that.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:42\"}, {\"type\":\"paragraph\",\"text\":\"So that's why Bitcoin would need to be upgraded in order to support this new address.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:47\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nSo then we get to the question of why would this make a difference?\\nWhat's wrong with a longer address?\\nAnd that has to do with how Bitcoin nodes spread the word about who they are.\\nBecause how do you know which node to connect to?\\nAnd the idea there is that nodes can communicate with each other, they send each other lists of known nodes.\\nSo they ask each other, hey, which Bitcoin nodes do you know?\\nAnd then they get a list of IP addresses.\\nAnd generally those are either IPv4 addresses or IPv6 addresses.\\nIPv6 is the new kid in town since, 1998 or something.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:05:26\"}, {\"type\":\"paragraph\",\"text\":\"Right, these are the regular IP addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:05:29\"}, {\"type\":\"paragraph\",\"text\":\"Correct.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:05:30\"}, {\"type\":\"paragraph\",\"text\":\"The IPv6 ones are longer as well, and that's because IPv4 was running out, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:05:36\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nThere's only, I think, 4 billion potential IPv4 addresses, whereas there's just enough for every molecule in the universe of IPv6 addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:05:46\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nSo Bitcoin nodes keep lists of other Bitcoin nodes and their IP addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:05:55\"}, {\"type\":\"paragraph\",\"text\":\"Yes, and the way you would communicate a Tor address is you would piggyback on IPv6 because there is a convention, I think it's used outside of Bitcoin too, where if the IPv6 address starts with a certain prefix, certain characters, certain numbers, then everything that follows is the Tor address because the Tor version 2 address, let me see if I got it right.\\nAn IPv6 address is 16 bytes and a Tor address is only 10 bytes.\\nSo you can hide inside of it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:06:27\"}, {\"type\":\"paragraph\",\"text\":\"So Bitcoin nodes keep the IP addresses of other Bitcoin nodes they know, and these are these IPv4 and IPv6, and some of the IPv6 are also the Tor addresses.\\nAnd when nodes connect with each other, they share their lists, so everyone has an even more complete list of all of the Bitcoin nodes.\\nIs this correct?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:06:49\"}, {\"type\":\"paragraph\",\"text\":\"That's right, yes.\\nThe problem with Tor version 3 addresses is that they are 32 bytes, which is twice as long as an IPv6 address.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:06:56\"}, {\"type\":\"paragraph\",\"text\":\"Right, so now you can't hide it inside an IPv6 address.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:06:59\"}, {\"type\":\"paragraph\",\"text\":\"No, so nodes have no way to communicate those addresses at the moment.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:04\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nSo that has been upgraded.\"}, {\"type\":\"heading\",\"text\":\"How does a Bitcoin node gossip addresses?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:08\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\\nSo this is not rocket science to solve, but somebody actually needs to do it.\\nAnd Wladimir van der Laan wrote a standard a while ago, I think in 2019, that has a new way of communicating, of gossiping addresses.\\nAnd the major change is that you can, each message says, this is the type of address I'm going to communicate, and there can be various types, including the new Tor one, but also future ones.\\nAnd then it can have different lengths.\\nSo in the future, if a new address format comes along that's too long, that's not going to be a problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:44\"}, {\"type\":\"paragraph\",\"text\":\"So that sounds like a pretty straightforward upgrade from my layman's perspective as a non-programmer.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:52\"}, {\"type\":\"paragraph\",\"text\":\"It is.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:52\"}, {\"type\":\"paragraph\",\"text\":\"But a very important one because we do want to keep using Tor potentially.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:58\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and the nice thing is it's a completely new peer-to-peer message.\\nSo old nodes just ignore that message, or if you know it's an old node that you're talking to, you don't use that message.\\nSo newer nodes will know this new message and can communicate all these new address types and older nodes just carry on like nothing happened.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:08:18\"}, {\"type\":\"paragraph\",\"text\":\"Okay, I have one follow-up question about this sharing of lists and sharing of IP addresses, which is not Tor specific, but how do you actually connect to the first node?\\nHow do you bootstrap to the network?\\nIf you have no list yet of other nodes, then how do you find the first node?\\nHow does this actually work in Bitcoin?\"}, {\"type\":\"heading\",\"text\":\"How does DNS work?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:08:44\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so the bootstrap problem, basically, you've just downloaded Bitcoin Core or some other client and you start it up and now what?\\nIs it just going to guess random IP addresses?\\nNo.\\nSo it needs to know another node to connect to, at least one, preferably a couple.\\nThe way it tries to do that is using something called DNS seeds.\\nThe internet DNS system is used for websites when you type an address www.google.com.\\nWhat your browser does is it asks a DNS server what IP addresses are from that Google domain.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:09:18\"}, {\"type\":\"paragraph\",\"text\":\"Do you know how many DNS servers there are?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:09:22\"}, {\"type\":\"paragraph\",\"text\":\"Lots of them, because if you run a website, your hosting provider will have a DNS server that points to your website, but then your country will have a DNS server that will point to your hosting provider, and your internet provider has a DNS server that points to all these different countries, etc.\\nSo it's very redundant.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:09:43\"}, {\"type\":\"paragraph\",\"text\":\"We're going very off the trail here, but I do find it interesting.\\nHow do these DNS servers remain in sync?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:09:52\"}, {\"type\":\"paragraph\",\"text\":\"So basically, when you have a DNS record, so if you are maintaining a website, you usually have to go into some control panel and type in the IP address of your server and then your domain name and that's stored on the DNS server.\\nOne of the fields you have to fill out is the timeout.\\nSo what you're saying is after 24 hours for example or after one hour you should ask me again.\\nSo when you're visiting a website you're gonna ask your maybe your ISP hey do you know the IP address for this website?\\nAnd if it doesn't, it's going to ask the next DNS server up the street, basically, say, do you know it?\\nAnd then as soon as it finds a record, it's going to say, is this record still valid or is this expired?\\nAnd if it's still valid, it'll use it.\\nAnd if it's expired, it'll go up closer and closer to the actual hosting provider.\\nSo it's, it's basically cached.\\nDoes that make sense?\\nSo the easiest would be if you go to a domain like say google.com.\\nOkay, how do you find the IP address?\\nWell, you ask Google what the IP address is.\\nBut how do you know what the IP address is for google.com.\\nYou don't know that because that's what you were trying to find out.\\nSo you have to ask somebody else.\\nAnd so you ask your internet provider, do you know the way to google.com?\\nWell, your internet provider might not know that, but it says, I know the way to .com basically, and .com will know the way to google.com.\\nSo that's kind of how it works.\\n.nl, same, you go to you ask .nl, where is google.nl?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:11:27\"}, {\"type\":\"paragraph\",\"text\":\"Okay, that makes total sense.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:11:30\"}, {\"type\":\"paragraph\",\"text\":\"Ideally they already have this cached, because so many people go to google.com, that if you ask your ISP where is google.com, they'll know, because somebody else asked.\\nBut if they don't know, they'll send you to .com.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:11:41\"}, {\"type\":\"paragraph\",\"text\":\"Right, so this is where I'm really getting at.\\nThe DNS system is ultimately centralized.\\nThere's a centralization risk there.\\nWhere you're trusting the DNS server.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:11:53\"}, {\"type\":\"paragraph\",\"text\":\"And for Bitcoin, we're kind of abusing it.\\nBecause Bitcoin nodes are not websites.\\nBut the idea is that there are a couple of core developers who run DNS seeds, which are essentially DNS servers.\\nAnd we're just pretending that, for example, seed.bitcoin.provoost.nl, which is what I'm running, is a website, quote unquote.\\nAnd when you ask that website, quote unquote, what its IP address is, you get a whole list of IP addresses.\\nBut those IP addresses are Bitcoin nodes, and every time you ask it, it's going to give you different IP addresses.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:12:28\"}, {\"type\":\"paragraph\",\"text\":\"Right, so what if someone corrupts you?\"}, {\"type\":\"heading\",\"text\":\"How does Bitcoin maintain a list of nodes?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:12:31\"}, {\"type\":\"paragraph\",\"text\":\"Well, one step back.\\nSo this means that the standard infrastructure of the internet, all the internet service providers in the world and all these others are caching exactly where all the Bitcoin nodes are, because they think it's just a website.\\nSo it's kind of nice that you keep all these lists of nodes redundantly stored on the internet.\\nAnd there's quite a few protections on the internet, against censorship of DNS.\\nSo you're leveraging all that.\\nBut at the same time, if I and the other people were to lie and run a fake server, we could send you to any node we want.\\nBut that would be very visible.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:06\"}, {\"type\":\"paragraph\",\"text\":\"All right.\\nAnd the reason it's visible is because anyone can request these IP addresses from you and then check if they're actually Bitcoin nodes or not, or if you're trying to cheat there.\\nThat's the reason they're visible.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:13:16\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:17\"}, {\"type\":\"paragraph\",\"text\":\"It would be hard to cheat.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:13:20\"}, {\"type\":\"paragraph\",\"text\":\"If you were to cheat like that, very non-randomly, to add to the whole world, it'd be very obvious.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:26\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nBut what if it happens?\\nIs there another way to connect to the Bitcoin network at that point?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:13:31\"}, {\"type\":\"paragraph\",\"text\":\"If they're lying, it's tricky, but if they're just offline, if all the Bitcoin DNS seeds are not reachable, then inside the Bitcoin Core source code, and also in the thing you download, is a list of IP addresses, as well as a few hidden servers.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:47\"}, {\"type\":\"paragraph\",\"text\":\"That's also Bitcoin nodes.\\nThey're embedded into the source code.\\nWhich nodes are these, or why are these embedded in the source code?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:13:57\"}, {\"type\":\"paragraph\",\"text\":\"What happens every six months or so is we ask all the DNS seed maintainers to provide a list of the most reliable nodes.\\nJust all the nodes sorted by how frequently they're online.\\nBecause your DNS seed tends to track, I've polled this node once and it was online.\\nSo basically what a DNS seed does on its side is it's just a crawler.\\nThe DNS seed goes to a couple of Bitcoin nodes, asks it for all the nodes it knows, keeps a list and just goes to the list, and pings them all.\\nThen once it's done pinging them all, it's just going to ping them all again, and it keeps track of how often they're online.\\nSo you make a list sorted by reliability, you take that from all the contributors, and that goes into the source code.\\nThat's the fallback.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:14:48\"}, {\"type\":\"paragraph\",\"text\":\"Interesting.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:14:49\"}, {\"type\":\"paragraph\",\"text\":\"But it's only the first time you start your node, at least in theory.\\nSo only the very first time you start your node, you need this.\\nAfter that, you keep track of the nodes you know about, you store all these gossip nodes in a file, and you start opening the file and you just try the nodes you know about and only if you run out if it doesn't work you ask to see it again\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:15:10\"}, {\"type\":\"paragraph\",\"text\":\"Yep, and then you keep syncing your list of IP addresses with the new nodes?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:15:16\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, exactly.\\nI think whenever a node connects to you for the first time, that's one of the first things they ask.\\nWho else do you know?\\nI think you can even send them unsolicited.\\nWhich is why, if you start a new node, you get inbound connections pretty quickly.\\nBecause you've announced your IP address to other people and they're gossiping it around and these other nodes then start connecting.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:15:38\"}, {\"type\":\"paragraph\",\"text\":\"Interesting.\\nSo that makes it pretty clear to me.\\nYou bootstrap to the Bitcoin network by first querying DNS records to find other Bitcoin nodes.\\nYou get a list of IP addresses.\\nYou use these to connect to the actual Bitcoin nodes, which could also be Tor nodes at that point.\\nThese you can also query from the DNS records.\\nAt that point you ask about all of the nodes they know and you update your list and from that point on you're also sharing your, the IP addresses you have with other nodes.\\nSo far these were IPv4 and IPv6 and IPv6 had a subset of onion nodes.\\nAnd with this upgrade, we'll be ready for a newer version of onion nodes.\\nThat's the story.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:16:28\"}, {\"type\":\"paragraph\",\"text\":\"That's about right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:16:28\"}, {\"type\":\"paragraph\",\"text\":\"That's our podcast.\\nGreat.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:16:30\"}, {\"type\":\"paragraph\",\"text\":\"And one tiny little thing that was recently added is that the Bitcoin node actually can spin up the version three on your node, but that is actually like a five line change.\\nSo that's quite nice.\\nThat'll just work when you start a, I don't know, I think it's version 0.21 if you started up.\\nIf you were running a version 2 node before, it's going to run a version 3 Tor node after.\\nIf you weren't, then you need to read the documentation how to set it up if you want to use it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:16:58\"}, {\"type\":\"paragraph\",\"text\":\"Good.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:16:59\"}, {\"type\":\"paragraph\",\"text\":\"So, yeah, that's all.\"}",
    "body": "## Introduction\n\nAaron van Wirdum: 00:00:07\n\nLive from Utrecht, this is the Van Wirdum Sjorsnado.\nSjors, you pointed out to me that Bitcoin Core has an amazing new feature merged into its repository.\n\nSjors Provoost: 00:00:19\n\nAbsolutely, we have bigger onions now.\n\nAaron van Wirdum: 00:00:24\n\nRight, so I had basically no idea what it meant.\nYou figured it out.\n\nSjors Provoost: 00:00:29\n\nI did.\n\nAaron van Wirdum: 00:00:34\n\nYeah so let's start at the beginning.\nIt's about Tor.\n\nSjors Provoost: 00:00:40\n\nTor was the big motivator to get everything in there.\nHave you ever used Tor or do you know what Tor is?\n\nAaron van Wirdum: 00:00:51\n\nI have a basic understanding of what Tor is, yes.\n\nSjors Provoost: 00:00:53\n\nWhen you see a Tor address it looks quite weird.\n\nAaron van Wirdum: 00:00:58\n\nRight.\n\n## How does Tor work?\n\nSjors Provoost: 00:00:58\n\nAnd so the idea is that it's a public key, essentially, a TOR address.\nAnd that refers to a hidden server somewhere on the internet.\nAnd the way you communicate to that hidden server is not directly because you don't know its IP address but indirectly through the Tor network and you use onion packages for that.\nSo the idea is that you start from the inside the last hop before the hidden server and you give that hop instructions how to reach the hidden servers and then you write instructions for the second last hop and you give it instructions how to reach the first hop.\n\nAaron van Wirdum: 00:01:42\n\nEveryone is still using IP addresses it's just you don't know the IP address of the the Tor node you're communicating with instead you're communicating with other Tor nodes and every Tor node communicates with a direct peer so they all everyone only knows the IP address of their direct peer, but they don't know where the message originated or where it ends up.\nPlus, they can't read the message because it's encrypted.\n\nSjors Provoost: 00:02:10\nThat's right.\n\nAaron van Wirdum: 00:02:11\n\nAnd in order to support this, all of these Tor nodes have their own IP address, which is their onion address, and that's what they use to, that's what you're communicating with directly.\n\n## Benefits of running a Bitcoin node behind Tor\n\nSjors Provoost: 00:02:23\n\nAnd Bitcoin Core nodes can run behind such a hidden surface.\nSo everybody can have their Bitcoin node run at a secret location so your IP address remains secret.\n\nAaron van Wirdum: 00:02:35\n\nWhat's the practical benefit of that?\n\nSjors Provoost: 00:02:38\n\nYour IP address remains secret so if you don't want the rest of the world to know that your IP address is running a Bitcoin node, maybe that's useful.\n\nAaron van Wirdum: 00:02:48\n\nYeah, and I think it's also because if you're sending transactions from an IP address, then network analyzers can reveal where transactions originated.\nAlthough I guess that's also being solved.\nThere's other solutions for that as well.\n\nSjors Provoost: 00:03:03\n\nThat's defense in depth.\nIdeally your node behaves in a way that it looks indistinguishable from all other nodes.\nYour node downloads all the blocks and it downloads all the mempool transactions and you can't tell which wallet is running inside which node, but there's all these sneaky companies that try anyway.\nAnd then they might know that you sent a specific transaction, or then they might know which Bitcoins belong to you, and since your IP address is quite easy to figure out who you are.\nIt could be nice to have Tor in theory.\nBut regardless, that's just how it works.\n\nAaron van Wirdum: 00:03:40\n\nSo you can use Bitcoin from behind Tor and I think the thing was that there's a new type of Onion addresses.\nThere was an update in the Tor protocol.\n\nSjors Provoost: 00:03:52\n\nThat's right.\n\nAaron van Wirdum: 00:03:52\n\nAnd that uses new addresses.\n\nSjors Provoost: 00:03:55\n\nYes.\nSo the Tor addresses are now longer, which just makes them more secure.\nWe don't need to go into why that is, because I don't know why that is.\nAll we know is that Onion addresses now, in version 3, are a bit longer.\nAnd that means that if you want to keep running a Bitcoin node on Tor, you'll have to use those longer addresses because Tor is centralized and they have decided to eventually get rid of the version 2 addresses.\n\nAaron van Wirdum: 00:04:23\n\nOkay, but they didn't yet.\nSo right now version 2 addresses are still usable?\n\nSjors Provoost: 00:04:27\n\nYes, I think they've been officially deprecated now and I think in about a year or so, they won't work anymore.\n\nAaron van Wirdum: 00:04:33\n\nI see.\nSo anyone who wants to continue using Tor needs to upgrade before next year.\n\nSjors Provoost: 00:04:42\n\nSomething like that.\n\nAaron van Wirdum: 00:04:42\n\nSo that's why Bitcoin would need to be upgraded in order to support this new address.\n\nSjors Provoost: 00:04:47\n\nYes.\nSo then we get to the question of why would this make a difference?\nWhat's wrong with a longer address?\nAnd that has to do with how Bitcoin nodes spread the word about who they are.\nBecause how do you know which node to connect to?\nAnd the idea there is that nodes can communicate with each other, they send each other lists of known nodes.\nSo they ask each other, hey, which Bitcoin nodes do you know?\nAnd then they get a list of IP addresses.\nAnd generally those are either IPv4 addresses or IPv6 addresses.\nIPv6 is the new kid in town since, 1998 or something.\n\nAaron van Wirdum: 00:05:26\n\nRight, these are the regular IP addresses.\n\nSjors Provoost: 00:05:29\n\nCorrect.\n\nAaron van Wirdum: 00:05:30\n\nThe IPv6 ones are longer as well, and that's because IPv4 was running out, right?\n\nSjors Provoost: 00:05:36\n\nRight.\nThere's only, I think, 4 billion potential IPv4 addresses, whereas there's just enough for every molecule in the universe of IPv6 addresses.\n\nAaron van Wirdum: 00:05:46\n\nRight.\nSo Bitcoin nodes keep lists of other Bitcoin nodes and their IP addresses.\n\nSjors Provoost: 00:05:55\n\nYes, and the way you would communicate a Tor address is you would piggyback on IPv6 because there is a convention, I think it's used outside of Bitcoin too, where if the IPv6 address starts with a certain prefix, certain characters, certain numbers, then everything that follows is the Tor address because the Tor version 2 address, let me see if I got it right.\nAn IPv6 address is 16 bytes and a Tor address is only 10 bytes.\nSo you can hide inside of it.\n\nAaron van Wirdum: 00:06:27\n\nSo Bitcoin nodes keep the IP addresses of other Bitcoin nodes they know, and these are these IPv4 and IPv6, and some of the IPv6 are also the Tor addresses.\nAnd when nodes connect with each other, they share their lists, so everyone has an even more complete list of all of the Bitcoin nodes.\nIs this correct?\n\nSjors Provoost: 00:06:49\n\nThat's right, yes.\nThe problem with Tor version 3 addresses is that they are 32 bytes, which is twice as long as an IPv6 address.\n\nAaron van Wirdum: 00:06:56\n\nRight, so now you can't hide it inside an IPv6 address.\n\nSjors Provoost: 00:06:59\n\nNo, so nodes have no way to communicate those addresses at the moment.\n\nAaron van Wirdum: 00:07:04\n\nRight.\nSo that has been upgraded.\n\n## How does a Bitcoin node gossip addresses?\n\nSjors Provoost: 00:07:08\n\nExactly.\nSo this is not rocket science to solve, but somebody actually needs to do it.\nAnd Wladimir van der Laan wrote a standard a while ago, I think in 2019, that has a new way of communicating, of gossiping addresses.\nAnd the major change is that you can, each message says, this is the type of address I'm going to communicate, and there can be various types, including the new Tor one, but also future ones.\nAnd then it can have different lengths.\nSo in the future, if a new address format comes along that's too long, that's not going to be a problem.\n\nAaron van Wirdum: 00:07:44\n\nSo that sounds like a pretty straightforward upgrade from my layman's perspective as a non-programmer.\n\nSjors Provoost: 00:07:52\n\nIt is.\n\nAaron van Wirdum: 00:07:52\n\nBut a very important one because we do want to keep using Tor potentially.\n\nSjors Provoost: 00:07:58\n\nYeah, and the nice thing is it's a completely new peer-to-peer message.\nSo old nodes just ignore that message, or if you know it's an old node that you're talking to, you don't use that message.\nSo newer nodes will know this new message and can communicate all these new address types and older nodes just carry on like nothing happened.\n\nAaron van Wirdum: 00:08:18\n\nOkay, I have one follow-up question about this sharing of lists and sharing of IP addresses, which is not Tor specific, but how do you actually connect to the first node?\nHow do you bootstrap to the network?\nIf you have no list yet of other nodes, then how do you find the first node?\nHow does this actually work in Bitcoin?\n\n## How does DNS work?\n\nSjors Provoost: 00:08:44\n\nYeah, so the bootstrap problem, basically, you've just downloaded Bitcoin Core or some other client and you start it up and now what?\nIs it just going to guess random IP addresses?\nNo.\nSo it needs to know another node to connect to, at least one, preferably a couple.\nThe way it tries to do that is using something called DNS seeds.\nThe internet DNS system is used for websites when you type an address www.google.com.\nWhat your browser does is it asks a DNS server what IP addresses are from that Google domain.\n\nAaron van Wirdum: 00:09:18\n\nDo you know how many DNS servers there are?\n\nSjors Provoost: 00:09:22\n\nLots of them, because if you run a website, your hosting provider will have a DNS server that points to your website, but then your country will have a DNS server that will point to your hosting provider, and your internet provider has a DNS server that points to all these different countries, etc.\nSo it's very redundant.\n\nAaron van Wirdum: 00:09:43\n\nWe're going very off the trail here, but I do find it interesting.\nHow do these DNS servers remain in sync?\n\nSjors Provoost: 00:09:52\n\nSo basically, when you have a DNS record, so if you are maintaining a website, you usually have to go into some control panel and type in the IP address of your server and then your domain name and that's stored on the DNS server.\nOne of the fields you have to fill out is the timeout.\nSo what you're saying is after 24 hours for example or after one hour you should ask me again.\nSo when you're visiting a website you're gonna ask your maybe your ISP hey do you know the IP address for this website?\nAnd if it doesn't, it's going to ask the next DNS server up the street, basically, say, do you know it?\nAnd then as soon as it finds a record, it's going to say, is this record still valid or is this expired?\nAnd if it's still valid, it'll use it.\nAnd if it's expired, it'll go up closer and closer to the actual hosting provider.\nSo it's, it's basically cached.\nDoes that make sense?\nSo the easiest would be if you go to a domain like say google.com.\nOkay, how do you find the IP address?\nWell, you ask Google what the IP address is.\nBut how do you know what the IP address is for google.com.\nYou don't know that because that's what you were trying to find out.\nSo you have to ask somebody else.\nAnd so you ask your internet provider, do you know the way to google.com?\nWell, your internet provider might not know that, but it says, I know the way to .com basically, and .com will know the way to google.com.\nSo that's kind of how it works.\n.nl, same, you go to you ask .nl, where is google.nl?\n\nAaron van Wirdum: 00:11:27\n\nOkay, that makes total sense.\n\nSjors Provoost: 00:11:30\n\nIdeally they already have this cached, because so many people go to google.com, that if you ask your ISP where is google.com, they'll know, because somebody else asked.\nBut if they don't know, they'll send you to .com.\n\nAaron van Wirdum: 00:11:41\n\nRight, so this is where I'm really getting at.\nThe DNS system is ultimately centralized.\nThere's a centralization risk there.\nWhere you're trusting the DNS server.\n\nSjors Provoost: 00:11:53\n\nAnd for Bitcoin, we're kind of abusing it.\nBecause Bitcoin nodes are not websites.\nBut the idea is that there are a couple of core developers who run DNS seeds, which are essentially DNS servers.\nAnd we're just pretending that, for example, seed.bitcoin.provoost.nl, which is what I'm running, is a website, quote unquote.\nAnd when you ask that website, quote unquote, what its IP address is, you get a whole list of IP addresses.\nBut those IP addresses are Bitcoin nodes, and every time you ask it, it's going to give you different IP addresses.\n\nAaron van Wirdum: 00:12:28\n\nRight, so what if someone corrupts you?\n\n## How does Bitcoin maintain a list of nodes?\n\nSjors Provoost: 00:12:31\n\nWell, one step back.\nSo this means that the standard infrastructure of the internet, all the internet service providers in the world and all these others are caching exactly where all the Bitcoin nodes are, because they think it's just a website.\nSo it's kind of nice that you keep all these lists of nodes redundantly stored on the internet.\nAnd there's quite a few protections on the internet, against censorship of DNS.\nSo you're leveraging all that.\nBut at the same time, if I and the other people were to lie and run a fake server, we could send you to any node we want.\nBut that would be very visible.\n\nAaron van Wirdum: 00:13:06\n\nAll right.\nAnd the reason it's visible is because anyone can request these IP addresses from you and then check if they're actually Bitcoin nodes or not, or if you're trying to cheat there.\nThat's the reason they're visible.\n\nSjors Provoost: 00:13:16\n\nExactly.\n\nAaron van Wirdum: 00:13:17\n\nIt would be hard to cheat.\n\nSjors Provoost: 00:13:20\n\nIf you were to cheat like that, very non-randomly, to add to the whole world, it'd be very obvious.\n\nAaron van Wirdum: 00:13:26\n\nRight.\nBut what if it happens?\nIs there another way to connect to the Bitcoin network at that point?\n\nSjors Provoost: 00:13:31\n\nIf they're lying, it's tricky, but if they're just offline, if all the Bitcoin DNS seeds are not reachable, then inside the Bitcoin Core source code, and also in the thing you download, is a list of IP addresses, as well as a few hidden servers.\n\nAaron van Wirdum: 00:13:47\n\nThat's also Bitcoin nodes.\nThey're embedded into the source code.\nWhich nodes are these, or why are these embedded in the source code?\n\nSjors Provoost: 00:13:57\n\nWhat happens every six months or so is we ask all the DNS seed maintainers to provide a list of the most reliable nodes.\nJust all the nodes sorted by how frequently they're online.\nBecause your DNS seed tends to track, I've polled this node once and it was online.\nSo basically what a DNS seed does on its side is it's just a crawler.\nThe DNS seed goes to a couple of Bitcoin nodes, asks it for all the nodes it knows, keeps a list and just goes to the list, and pings them all.\nThen once it's done pinging them all, it's just going to ping them all again, and it keeps track of how often they're online.\nSo you make a list sorted by reliability, you take that from all the contributors, and that goes into the source code.\nThat's the fallback.\n\nAaron van Wirdum: 00:14:48\n\nInteresting.\n\nSjors Provoost: 00:14:49\n\nBut it's only the first time you start your node, at least in theory.\nSo only the very first time you start your node, you need this.\nAfter that, you keep track of the nodes you know about, you store all these gossip nodes in a file, and you start opening the file and you just try the nodes you know about and only if you run out if it doesn't work you ask to see it again\n\nAaron van Wirdum: 00:15:10\n\nYep, and then you keep syncing your list of IP addresses with the new nodes?\n\nSjors Provoost: 00:15:16\n\nYeah, exactly.\nI think whenever a node connects to you for the first time, that's one of the first things they ask.\nWho else do you know?\nI think you can even send them unsolicited.\nWhich is why, if you start a new node, you get inbound connections pretty quickly.\nBecause you've announced your IP address to other people and they're gossiping it around and these other nodes then start connecting.\n\nAaron van Wirdum: 00:15:38\n\nInteresting.\nSo that makes it pretty clear to me.\nYou bootstrap to the Bitcoin network by first querying DNS records to find other Bitcoin nodes.\nYou get a list of IP addresses.\nYou use these to connect to the actual Bitcoin nodes, which could also be Tor nodes at that point.\nThese you can also query from the DNS records.\nAt that point you ask about all of the nodes they know and you update your list and from that point on you're also sharing your, the IP addresses you have with other nodes.\nSo far these were IPv4 and IPv6 and IPv6 had a subset of onion nodes.\nAnd with this upgrade, we'll be ready for a newer version of onion nodes.\nThat's the story.\n\nSjors Provoost: 00:16:28\n\nThat's about right.\n\nAaron van Wirdum: 00:16:28\n\nThat's our podcast.\nGreat.\n\nSjors Provoost: 00:16:30\n\nAnd one tiny little thing that was recently added is that the Bitcoin node actually can spin up the version three on your node, but that is actually like a five line change.\nSo that's quite nice.\nThat'll just work when you start a, I don't know, I think it's version 0.21 if you started up.\nIf you were running a version 2 node before, it's going to run a version 3 Tor node after.\nIf you weren't, then you need to read the documentation how to set it up if you want to use it.\n\nAaron van Wirdum: 00:16:58\n\nGood.\n\nSjors Provoost: 00:16:59\n\nSo, yeah, that's all.\n\n",
    "body_type": "markdown",
    "created_at": "2020-10-15T00:00:00.000Z",
    "domain": "https://btctranscripts.com/",
    "url": "https://btctranscripts.com/bitcoin-explained/bitcoin-core-v21-supports-tor-v3",
    "categories": [
        "podcast"
    ],
    "tags": [
        "bitcoin-core",
        "anonymity-networks"
    ],
    "media": "https://www.youtube.com/watch?v=KRPtbq8_1is",
    "authors": [
        "Sjors Provoost",
        "Aaron van Wirdum"
    ],
    "indexed_at": "2024-03-21T16:33:36.086Z",
    "transcript_by": "jeffreyweier via review.btctranscripts.com",
    "summary": "In a compelling episode of the Van Wirdum Sjorsnado, broadcast from Utrecht, speakers Sjors Provoost and Aaron van Wirdum embarked on an exploration of a significant development within Bitcoin Core\u2019s repository. The discussion opened with an intriguing mention of \"bigger onions,\" segueing into an in-depth conversation about Tor, the privacy-centric network that enables anonymous internet browsing. Tor's unique addressing system, as explained by Provoost, serves a fundamental role in routing traffic across the network to access hidden services without disclosing IP addresses.\n\nThe mechanics of Tor\u2019s operation were dissected, emphasizing the network\u2019s reliance on layered encryption\u2014reminiscent of an onion\u2019s structure\u2014to safeguard user anonymity. This design ensures each node in the network only identifies its immediate peers, thereby preserving the confidentiality of both message origins and destinations. Such an architecture not only bolsters privacy but also fortifies communications against potential interception.\n\nProvoost transitioned the dialogue towards the intersection of Tor and Bitcoin, underscoring the benefits of running a Bitcoin node shielded by Tor\u2019s anonymity. This arrangement allows individuals to manage nodes without unveiling their IP addresses, enhancing both privacy and security. Particularly, this setup aids in obscuring Bitcoin transaction origins from network analysis, fostering a more private and robust Bitcoin network.\n\nA notable segment of the discussion centered on a new feature in Bitcoin Core concerning the evolution from version 2 to version 3 Tor addresses, which are notably longer and offer increased security. However, this transition introduced challenges for Bitcoin nodes previously utilizing IPv6 addresses. Provoost elucidated the technical obstacles encountered in adapting Bitcoin Core to accommodate the elongated version 3 Tor addresses, highlighting the critical need for upgrades to maintain compatibility with Tor.\n\nThe resolution to these challenges was attributed to Wladimir van der Laan's standard, which presented a versatile approach allowing Bitcoin nodes to exchange a variety of address types, including the latest Tor format. This adaptation ensures Bitcoin\u2019s ongoing compatibility with Tor advancements, safeguarding user privacy and the capacity for anonymous transactions.\n\nFurthermore, the conversation ventured into the foundational challenges new nodes face in discovering other nodes within the Bitcoin network. Here, the role of DNS seeds became evident, utilizing the internet\u2019s domain name system to bridge connections between nodes. This method underscores the resilience and interconnectedness of the Bitcoin network, ensuring its operability and accessibility globally.\n\nAdditionally, the dialogue between Provoost and van Wirdum delved into the workings of the internet\u2019s Domain Name System (DNS) and its application within Bitcoin. Provoost illuminated the process of translating domain names into IP addresses, pointing out the hierarchical structure dependent on centralized DNS servers. Despite the efficiency of this system for conventional web browsing, it introduces centralization risks contrary to Bitcoin\u2019s decentralized ethos.\n\nThe speakers then outlined how the Bitcoin network employs the DNS system to compile an active list of nodes, presenting them as websites through DNS seeds operated by core developers. Although concerns of centralization loom with DNS, this strategy leverages inherent protections against DNS censorship, maintaining a level of resilience.\n\nAddressing the risk of DNS seed compromise, the speakers discussed the transparency of fraudulent activities due to the public nature of the IP addresses requested, which can be independently verified. The dynamically provided list of Bitcoin nodes via DNS seeds adds a layer of security through unpredictability, impeding malicious efforts to manipulate node connectivity.\n\nTo bolster the network against DNS seed failures or malevolence, Bitcoin integrates a fallback mechanism in its core software, incorporating a hardcoded list of reliable node IP addresses. This list, periodically refreshed based on input from DNS seed operators, guarantees initial network connectivity for new nodes. Subsequent connections utilize a \"gossip\" protocol, decentralizing the maintenance of an up-to-date network map and further securing the network.\n\nThe conversation culminated in highlighting recent improvements to Bitcoin network connectivity, including support for the latest version of Tor onion services, reaffirming Bitcoin's commitment to privacy and security. Through their insightful exchange, Sjors Provoost and Aaron van Wirdum adeptly unraveled the technical underpinnings of Bitcoin's network infrastructure, showcasing the innovative strategies devised to align Bitcoin's decentralized nature with the prevailing centralized internet architecture."
}