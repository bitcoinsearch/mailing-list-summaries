{
    "id": "bitcointranscripts+bitcoin-explained+the-block-1-983-702-problem",
    "title": "The Block 1,983,702 Problem",
    "body_formatted": "{\"type\":\"heading\",\"text\":\"Introduction\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:00:19\"}, {\"type\":\"paragraph\",\"text\":\"Live from Utrecht, this is Bitcoin Explained.\\nHey Sjors.\"}, {\"type\":\"paragraph\",\"text\":\"[omitted sponsors segment]\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:01:20\"}, {\"type\":\"paragraph\",\"text\":\"Sjors, today we're discussing a very niche bug that I had never heard of, but apparently there's a bug in the Bitcoin protocol.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:01:31\"}, {\"type\":\"paragraph\",\"text\":\"Well, there was a bug in the Bitcoin protocol.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:01:35\"}, {\"type\":\"paragraph\",\"text\":\"But there's still a problem.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:01:38\"}, {\"type\":\"paragraph\",\"text\":\"There was a bug, then there was no bug, then there was a bug, then there was no bug.\\nThere's still a problem, but not a bug.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:01:45\"}, {\"type\":\"paragraph\",\"text\":\"Okay, I see.\\nSo, there was a bug, now there's no bug, but there's still a problem which is not a bug.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:01:51\"}, {\"type\":\"paragraph\",\"text\":\"Well, it's kind of a bug, but it's not like a dangerous bug like the original thing.\"}, {\"type\":\"heading\",\"text\":\"Explaining the Bug and Its Implications\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:01:55\"}, {\"type\":\"paragraph\",\"text\":\"Sounds pretty buggy.\\nAnyway, so it's called the \\\"1,983,702\\\" problem.\\nDid I say it right even?\\nThe block \\\"1,983,702\\\" problem.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:11\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, that sounds good.\\nOr the block \\\"1,983,702\\\" problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:14\"}, {\"type\":\"paragraph\",\"text\":\"So, this will be a problem in.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:18\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, there's another term you could use is the BIP34 does not imply BIP30 problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:27\"}, {\"type\":\"paragraph\",\"text\":\"I don't know which one is worse.\\nThey're both pretty bad.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:30\"}, {\"type\":\"paragraph\",\"text\":\"Okay, cool.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:31\"}, {\"type\":\"paragraph\",\"text\":\"So, this will be a problem in block, well, again, 1,900,000 something.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:38\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, which is like a couple decades from now.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:40\"}, {\"type\":\"paragraph\",\"text\":\"Yes, like 22 years from now, my sort of napkin math told me.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:44\"}, {\"type\":\"paragraph\",\"text\":\"And to be clear, It's a problem, it's not like bad.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:02:49\"}, {\"type\":\"paragraph\",\"text\":\"Okay, but it is something that needs to be solved eventually, in some way or another.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:02:55\"}, {\"type\":\"paragraph\",\"text\":\"It's better if we solve it, yeah.\\nBut it's not like the 2106 problem, which, like in the year 2106, the whole blockchain simply stops.\\nThat's definitely a problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:03:05\"}, {\"type\":\"paragraph\",\"text\":\"Is this not a problem that's going to require a consensus change?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:03:09\"}, {\"type\":\"paragraph\",\"text\":\"No, ideally it would.\\nBut not a hard fork.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:03:12\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\\nHow did you find about it?\\nLike I said, I'd never heard of this.\\nIs this just something you, this is your hobby you look for very niche things that no one else has heard about?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:03:23\"}, {\"type\":\"paragraph\",\"text\":\"Well, we sometimes need to scrape the bottle of the barrel for episodes titles, but in this case, I was trying to understand a bug in Stratum V2, something I'm working on recently, and had something to do with the coinbase transactions and whether or not it has a witness.\\nTurns out it does have a witness, or at least it can have a witness, which I didn't know, and That's why I kept banging my head against it.\\nBut as I was trying to understand how the code works, I was reading the code comments, and I came across this like almost full-page story about this problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:03:57\"}, {\"type\":\"paragraph\",\"text\":\"Okay, I'm gonna just call it the \\\"1,900,000\\\" problem because I don't wanna read it in full every time.\\nSo, the 1 million 900,000 problem, we'll start at the beginning.\\nSo, you mentioned there was a bug.\\nIt all started with a bug, right?\\nAnd this has been a bug in Bitcoin since the beginning?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:18\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:19\"}, {\"type\":\"paragraph\",\"text\":\"Like it's an OG Satoshi bug?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:21\"}, {\"type\":\"paragraph\",\"text\":\"Exactly, an OG Satoshi bug, which is that it was possible for two identical transactions to exist, or more than one basically, identical transactions to exist in sequence.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:33\"}, {\"type\":\"paragraph\",\"text\":\"It was or wasn't?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:35\"}, {\"type\":\"paragraph\",\"text\":\"It was possible.\\nAnd this was creating a problem because, well, when the transaction exists twice, then the original one essentially just disappears.\\nThis has to do with how transactions work.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:04:51\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, let's halt here for a second.\\nSo how do you get two identical transactions?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:04:56\"}, {\"type\":\"paragraph\",\"text\":\"Same hash.\\nSo, the same hash means it's the same content.\\nSo, it's the same inputs, the same outputs.\\nAnd so typically you would expect this in a coinbase transaction in the early days, because a coinbase transaction doesn't have any inputs, or maybe it is the name of your pool, which would be the same if you were mining multiple blocks.\\nAnd then the outputs might be the address that you're paying yourself to, which might also be the same of your pool.\\nSo, if you mined in the early days two blocks to the same address and with the same pool name and you were like, I guess that...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:05:30\"}, {\"type\":\"paragraph\",\"text\":\"yeah.\\nThat makes sense.\\nSo, you're a pool in the early days, you have your Bitcoin address, one blah blah blah blah blah, because that was the early addresses, and you're mining new coins, so there's no inputs, and you just, these new 50 coins are sent to this one blah blah blah address.\\nAnd if that happens twice, if you say you mine two blocks in a row, it's going to be the exact same transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:05:54\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, however, it also would have to be the same amount, right?\\nSo, this would be either a block with no transactions in it, so no fees.\\nSo the coinbase amount would be exactly 50 Bitcoin back in the day, or it would be coincidentally the exact same total fees.\\nThe thing is, it only happened twice.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:06:14\"}, {\"type\":\"paragraph\",\"text\":\"Especially In the early days, there were still a lot of transactions that didn't pay any fee, I guess.\\nOr there was a fixed fee for a while.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:06:20\"}, {\"type\":\"paragraph\",\"text\":\"Probably a fixed fee.\\nSo then maybe if you had...\\nI don't know.\\nI didn't look at those specific blocks.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:06:24\"}, {\"type\":\"paragraph\",\"text\":\"Anyways, that is the most likely reason why that would happen.\\nIs it plausible that it could happen in any other circumstance to identical transactions?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:06:36\"}, {\"type\":\"paragraph\",\"text\":\"Well, it could happen as a child of the coin.\\nSo if the coinbase transactions are identical, then you could make another transaction.\\nBasically, you could just replay another transaction from the past that spends that coinbase transaction.\\nSo the whole history of that coinbase could be repeated.\\nSo if somebody mines a block and then they send it to the Pirate Bay and they download a movie, you could redo all that history.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:00\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, It would just have to start from the same coinbase transaction that's already identical.\\nThat's the only way you can get more identical transactions.\\nYou start from there, yeah.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:09\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Or if you break SHA-256.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:12\"}, {\"type\":\"paragraph\",\"text\":\"Which is also an episode we recorded at some point, I think.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:17\"}, {\"type\":\"paragraph\",\"text\":\"I don't think anybody broke SHA-256, but we did talk about hashes in general.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:21\"}, {\"type\":\"paragraph\",\"text\":\"We talked about what it means to break it, I think.\\nAnyways, I'm going on to tangents here.\\nOkay, so that's how you can get identical transaction IDs. And so you said it's possible, so why is it a bug if it's possible?\\nBecause I thought you were gonna say it's impossible, but you said it's possible.\\nWhy is it a bug then?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:42\"}, {\"type\":\"paragraph\",\"text\":\"It's possible, it was possible to be exact, but the bug is that it creates problems for you, especially for you as the recipient of that transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:07:52\"}, {\"type\":\"paragraph\",\"text\":\"So the miner in this case?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:07:53\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so the miner mines, say, 50 Bitcoin and doesn't spend it, and then a week later, he mines 50 Bitcoin and also doesn't spend it.\\nNow he's like, oh, I've got 100 Bitcoins, how am I gonna spend this?\\nOh, I'm gonna make a transaction and this transaction points to a previous transaction, that's what a transaction is to do.\\nSo you would point to the original coinbase transaction by its hash and then also by the position of the output in the coinbase transaction.\\nBut then the question is, which one do you mean?\\nAnd the Bitcoin Core software would simply look at the most recent one and would spend that.\\nAnd There was only one entry, so it would just be overwritten.\\nSo the original coins would be gone.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:08:42\"}, {\"type\":\"paragraph\",\"text\":\"Okay, you have to explain this, I think.\\nWhy would the original...\\nSo you say Bitcoin Core would just take the most recent one.\\nSo why wouldn't the older one just also still exist for next time you want to spend?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:08:53\"}, {\"type\":\"paragraph\",\"text\":\"Well, so Bitcoin Core keeps track of a list of outputs that exist.\\nBasically, the transaction hash and the identifier.\\nSo if you add another one that is the same, it would just overwrite it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:09:05\"}, {\"type\":\"paragraph\",\"text\":\"Oh, sorry, do you just mean the UTXO set here?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:09:08\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, although I think at the time the UTXO set worked a little different than it does now.\\nBut I think essentially it was the same thing.\\nIt's just a list of coins that exist.\\nSo it's a transaction hash and an identifier and whatever script you need to spend it.\\nAnd so if you were to create the transaction again, that would just be the same entry in the database.\\nSo the database would think there's only one.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:09:29\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so not both transactions would be included in this database.\\nIt would just be considered as the same transaction, so there's only one.\\nSo then if you spend it, both are gone because they overlap.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:09:41\"}, {\"type\":\"paragraph\",\"text\":\"Because you deleted one entry.\\nSo this can lead to quite strange situations.\\nFor example, let's say you mine a transaction once and then a couple blocks later you mine it again and then you spend it and so then it disappeared, right?\\nThat's one way, but let's say you mine one transaction,\\nyou mine a couple other blocks, and then you mine the transaction again.\\nNow, if there's a re-org, the blockchain undoes your most recent block, and then creates some other blocks.\\nThat means that your transaction has now disappeared from your point of view.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:10:29\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, okay, I get it.\\nSo, let me try to re-explain that, even though it was kind of clear to me, but maybe if I re-explain that might help one other person out there.\\nSo, yeah, you're creating a blockchain, obviously, and then the first coinbase transaction is included in block three, and then the next one is included in block seven.\\nBut then there's another block seven, and that's the blockchain that the network goes with.\\nThat becomes the longest chain.\\nSo now your second coinbase transaction is deleted from your UTXO set, basically, or your database, and it's not like the one before that is not like automatically restored either.\\nSo now you lost both.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:11:12\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, you lost both.\\nHowever, somebody else who just starts up a new blockchain, a Bitcoin blockchain, will never see the original second block.\\nSo they will only see the first block in which you do get the coinbase.\\nAnd as far as they're concerned, it's still there.\\nSo now you have a consensus failure.\\nBecause part of the network believes that a coin exists and the other does not and that will explode as soon as somebody tries to spend it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:11:33\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, or to put it a little bit more accurately, maybe...\\nI mean, I think you're saying it technically accurately, but the more normie way of saying it is there's no consensus on who owns which coins.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:11:44\"}, {\"type\":\"paragraph\",\"text\":\"Well, yeah, There's no consensus on who owns that, on whether that specific coin exists.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:11:48\"}, {\"type\":\"paragraph\",\"text\":\"Not so much who owns it.\\nWell, that's a technical way of saying it, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:11:51\"}, {\"type\":\"paragraph\",\"text\":\"Well, it's not about who owns it, it's that it exists or not.\\nSo you can spend a coin that doesn't exist.\\nIt's not about not satisfying the script, but it's just about the coin not existing.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:12:01\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, you're right actually.\\nIn the real case, some nodes would actually think the coins don't exist at all anymore because yes, I see what you're saying.\\nYeah, you're right.\\nAnyways, the important part is that the UTXO set or what, Sorry, why do you not call it the UTXO set?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:12:17\"}, {\"type\":\"paragraph\",\"text\":\"Did you say back in the day was- So this is the part I'm a little vague on, but initially the concept that we call the UTXO set, so a list of coins that exist, is not something that Satoshi invented as such.\\nI think we'll cover that again maybe in a future episode.\\nBut this idea of having a database of which coin exists and you just add and remove coins from it, I think at the time it was not like that.\\nIt was just a list of all transactions that were still relevant or something like that.\\nIt was less efficient.\\nSo, I think in 2018 or 2017, it was refactored into what we would now consider the UTXO set.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:12:58\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:12:59\"}, {\"type\":\"paragraph\",\"text\":\"But this less efficient implementation had the same problem.\\nThe modern UTXO set would definitely have this problem.\\nAnd my understanding is the original one had two, even though it stored more data than we do now.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:10\"}, {\"type\":\"paragraph\",\"text\":\"Anyways, the key point here being that the ownership records that every node holds would start to diverge.\\nAnd if that starts to happen, that is a consensus failure.\\nThat you could get to a place where you try spending coins and it confirms on your end and it doesn't confirm on the other end and networks start to, it's chaos.\\nLike that's, so that's potentially, that was a potential actual risk with this OG Satoshi bug.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:13:35\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and as far as I know, what did happen was there were two instances of these duplicate coinbases.\\nBasically miners losing 50 BTC.\\nBut I don't think there were cases of also re-org on top of that that would have created this mess.\\nBut maybe there was and nobody noticed it.\\nBecause the mess would not have been...\\nWell, I think we would have noticed it now, yeah.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:13:58\"}, {\"type\":\"paragraph\",\"text\":\"Probably right.\\nThat would have been very unlucky as well.\\nLike, you've got to have an exact re-org exactly on that block where this exact block happened.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:14:07\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and because as far as we can tell it only happened twice, it might have happened more often in chains that never survived.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:14:14\"}, {\"type\":\"paragraph\",\"text\":\"Well, no, then we would have the problem, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:14:17\"}, {\"type\":\"paragraph\",\"text\":\"Well maybe we are the surviving chain where that didn't happen, but there may have been other chains where it did happen and it didn't survive.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:14:23\"}, {\"type\":\"paragraph\",\"text\":\"Well we would have probably heard it then at some point, don't you think?\\nBecause then there would have been nodes with these different transaction records, UTXO, set, whatever you want to call it.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:14:32\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, but I mean, if this was long enough ago, maybe they just restarted the computer and just didn't care, but probably didn't happen.\\nFair.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:14:40\"}, {\"type\":\"paragraph\",\"text\":\"All right.\\nSo this was the OG Satoshi bug.\\nAnd This bug was fixed.\"}, {\"type\":\"heading\",\"text\":\"Addressing the Bug: BIP30's Role\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:14:47\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\\nAnd this is where BIP30 comes in.\\nThis was introduced in 2012.\\nWhat BIP30 does is very simple.\\nIt says there shall never be two transactions with the same hash at the same time.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:15:01\"}, {\"type\":\"paragraph\",\"text\":\"At the same time?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:15:02\"}, {\"type\":\"paragraph\",\"text\":\"At the same time.\\nAs in, if you create a transaction right now, it's not allowed to already exist in the UTXO set.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:15:08\"}, {\"type\":\"paragraph\",\"text\":\"Okay, but it's just an invalid transaction.\\nSo if the same thing would happen, if the miner would create this coinbase transaction where he pays himself to the same address.\\nThe Bitcoin network nodes, my node, your node, would just say, this is not valid, you just wasted your energy, we're going to wait for a valid block.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:15:25\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\\nNow, let's say they do that, they make a coinbase, then they spend it, then they can make the same coinbase again.\\nThat's no problem.\\nSo BIP30 does allow that.\\nSo that was great and that worked.\\nThe only problem is that this rule is a bit difficult to check, because it means that whenever you get a new block, for every transaction in that block, you have to make sure that it doesn't already exist, the transaction itself.\\nSo right now, whenever you check a block, you go through every transaction and you check that all its inputs exist, so it's spending from something that exists, but you do not check if the transaction itself exists, or at least you don't now because of what we'll discuss.\\nBut with BIP30, you would have to do that.\\nYou'd have to do an extra check for every transaction.\\nLike, hey, now that I've checked that all the inputs are valid, or whichever sequence we're going to do, does this transaction exist?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:16:25\"}, {\"type\":\"paragraph\",\"text\":\"So that was the case in 2012, for a brief while, at least, after BIP30 was deployed.\\nAnd this sounds like it's an especially annoying or burdensome check because it's so unlikely that it's necessary, especially for all non-coinbase transactions.\\nBut just technically...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:16:44\"}, {\"type\":\"paragraph\",\"text\":\"It's completely unnecessary in the sense that no miner would be this stupid, but of course if you don't check then they would be.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:16:50\"}, {\"type\":\"paragraph\",\"text\":\"You have to check, but it's burdensome.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:16:52\"}, {\"type\":\"paragraph\",\"text\":\"But it wastes some resources.\\nI don't know how much, if it's like 1% or 10%, but it's annoying.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:17:00\"}, {\"type\":\"paragraph\",\"text\":\"And also, in general, you want miners and all nodes to be able to check the validity of new blocks as soon as possible.\"}, {\"type\":\"heading\",\"text\":\"Efficiency and BIP34: A Solution with Caveats\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:17:10\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so every second you can shave off, the checking time is better.\\nSo, BIP34 was introduced, which made this process more efficient.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:17:18\"}, {\"type\":\"paragraph\",\"text\":\"When was this?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:17:20\"}, {\"type\":\"paragraph\",\"text\":\"Same year, just half a year later.\\nThat is to say...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:17:21\"}, {\"type\":\"paragraph\",\"text\":\"And was this introduced especially because, before the reason we just mentioned?\\nYes.\\nOkay, so it was like a performance improvement.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:17:29\"}, {\"type\":\"paragraph\",\"text\":\"I think so.\\nSo, the little background is that BIP30 was a relatively simple software that could be deployed very quickly because they realized the problem and they wanted to fix it as quickly as possible so nobody would deliberately exploit it.\\nBIP34 was something that was deployed a bit more carefully, very much like the BIP9 style soft fork.\\nSo there was some signaling involved, block version number went up and you had like so many percent of the miners had to signal it, et cetera, et cetera.\\nSo BIP34 was a more thorough solution, but it was also deployed more carefully.\\nSo what does BIP34 do?\\nWell, it makes sure that, well, that was the idea, that the coinbase transaction is unique by definition by adding the block height to it.\\nSo every coinbase transaction must start with the block height.\\nAnd because it must start with the block height, it's going to be different than previous transactions which had a different block height, or previous coinbase transactions had a different block height, so you won't have the duplicates.\\nThat is to say moving forward, you don't have to duplicate.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:18:33\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, okay, yeah, this makes sense.\\nThis way every coinbase necessarily is unique, like every coinbase transaction necessarily is unique because it's in a new block that has new block height.\\nAnd therefore every transaction that is spent from that coin is also unique.\\nSo now every transaction has to be unique.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:17:52\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:18:53\\nOkay, yeah, makes sense.\\nGood solution, Sjors, I like it.\\nWho came up with this?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:18:58\"}, {\"type\":\"paragraph\",\"text\":\"I think it was...\\nI'm not sure.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:02\"}, {\"type\":\"paragraph\",\"text\":\"Well, whoever came up with it, congratulations.\\nThank you.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:05\"}, {\"type\":\"paragraph\",\"text\":\"I think it was...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:06\"}, {\"type\":\"paragraph\",\"text\":\"However, I guess there's another problem you're going to mention about this solution or not.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:10\"}, {\"type\":\"paragraph\",\"text\":\"I think the original one was Peter Wuille and the second one was Russell O'Connor.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:15\"}, {\"type\":\"paragraph\",\"text\":\"However, so I guess this is why we're making this episode.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:18\"}, {\"type\":\"paragraph\",\"text\":\"No, Gavin Andresen.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:19\"}, {\"type\":\"paragraph\",\"text\":\"Gavin Andresen.\\nI could have guessed.\\nGavin, you messed up.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:25\"}, {\"type\":\"paragraph\",\"text\":\"Well, I don't know.\\nI mean, it's just he's the author, so it doesn't mean that he came up with it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:30\"}, {\"type\":\"paragraph\",\"text\":\"It was a joke, but maybe it's a kind of a sensitive joke at this point in time.\\nSjors, go on.\\nBecause there is a problem.\\nIt introduced a problem.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:42\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nWell, actually, it did not introduce a problem.\\nSo just having this rule is fine.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:49\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\\nGood job, Gavin.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:52\"}, {\"type\":\"paragraph\",\"text\":\"However...\\nSo Gavin, whatever it was, he didn't do anything wrong.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:19:55\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:19:56\"}, {\"type\":\"paragraph\",\"text\":\"However, then in 2015, somebody tried to be smart and said, hey, we have this BIP34, which means that we don't need to check for BIP30 anymore.\\nWe can make it faster.\\nSo perhaps I said before in the episode, oh this was the reason the performance thing was the reason to introduce it.\\nMaybe not.\\nMaybe they did it because it was just a more elegant solution and it would prevent mistakes.\\nBut then a couple of years later, somebody realized, hey, we can actually make this faster by not checking BIP30 anymore.\\nBecause we know that the blocks must be unique, right?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:20:31\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, like I explained just now.\\nI immediately got it.\\nWhy did it take these Bitcoin core developers so long, Sjors?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:20:37\"}, {\"type\":\"paragraph\",\"text\":\"I don't know.\\nSo, in 2015, that optimization was merged.\\nAnd well, then in 2018, so three years later, somebody realized, oh, oops!\\nthat doesn't actually work.\"}, {\"type\":\"heading\",\"text\":\"The Unforeseen Consequences of Optimizations\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:20:53\"}, {\"type\":\"paragraph\",\"text\":\"Wait, wait, wait, sorry, I lost the plot.\\nWhere are we now?\\nWhat's the year?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:20:57\"}, {\"type\":\"paragraph\",\"text\":\"Well, the year of the fix is 2018, but I guess the year of the realization was late 2017.\\nSo somewhere, I think it was October 2017, but this wasn't documented, but it kind of follows.\\nSomebody realized, oh wait a minute, there are exceptions to this convenient rule.\\nRemember that the rule of BIP34 is that you put the height of the block at the beginning of the coinbase.\\nSo block number one would have height number one, etc.\\nBut that rule only applies starting with block, I don't know, 200,000 something.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:21:36\"}, {\"type\":\"paragraph\",\"text\":\"It started being applied in 2012.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:21:39\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and it started being applied from height number 220,000 or something like that.\\nSo then the question, and so from there on this rule is correct, but the problem is, and that's what people realize, is that it doesn't apply earlier.\\nThe rule wasn't active earlier.\\nSo what is actually in those earlier coinbase transactions?\\nMight there be numbers in those earlier coinbase transactions, numbers that could represent a block height?\\nThe answer is yes.\\nThere were numbers in there.\\nSo there were older coinbase transactions that had numbers in there that represented blocks that might occur in the future.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:22:12\"}, {\"type\":\"paragraph\",\"text\":\"Okay, I know what you're saying, but you don't, The word represent is confusing here.\\nThere were just numbers in there and they could be interpreted as blocks from the future.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:22:21\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, either it was a very smart miner that foresaw that this problem was going to happen.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:22:25\"}, {\"type\":\"paragraph\",\"text\":\"For instance, there could have been an early miner who, for whatever reason, placed the number one million in the coinbase.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:22:34\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so as the episode suggests, some miner put the number 1,983,702 in the coinbase.\\nThey didn't actually put that number in there, they were probably just writing their name, and the name, if you map it into how a computer reads it, might have looked like a big number.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:22:50\"}, {\"type\":\"paragraph\",\"text\":\"So, there was a block in, like, say 2009, that starts with the number 1,900,000 something.\\nSo, by the time we actually get to block number 1,900,000, and that number has to be put in the coinbase, there's a risk that it was a pretty, that's not gonna happen, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:23:16\"}, {\"type\":\"paragraph\",\"text\":\"Normally this would not happen,\\nBut in theory, somebody would have to put the same number in it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:23:21\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:23:22\"}, {\"type\":\"paragraph\",\"text\":\"And then could, if they wanted to, wouldn't happen accidentally, make the rest of the coinbase identical to that original transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:23:29\"}, {\"type\":\"paragraph\",\"text\":\"So, yeah, so it would just have to spend the same amount of...\\nWell, no, because there's 50 coins in the original coinbase.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:23:37\"}, {\"type\":\"paragraph\",\"text\":\"Much more.\\nSo, Merge looked at this specific transaction, and it turns out that that was a very lucky block.\\nSo, not only did it get a 50 Bitcoin coinbase subsidy, which modern blocks don't get, it also got, I think, 50 or so BTC in fees.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:23:55\"}, {\"type\":\"paragraph\",\"text\":\"That's good.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:23:56\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so that's a very nice little block in the past.\\nSo if you wanted to reproduce this, your coinbase transaction would have to create about 107 Bitcoin.\\nIt would have to spend 107 Bitcoin.\\nThat is only allowed if there is 107 Bitcoin worth of fees in that block.\\nSo that's never going to happen accidentally.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:24:15\"}, {\"type\":\"paragraph\",\"text\":\"The other thing that has to happen is that the attacker would have to actually probably pay these fees himself and then burn it in this block.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:24:22\"}, {\"type\":\"paragraph\",\"text\":\"Yes, because he cannot send it to some arbitrary destination.\\nHe has to reproduce the original coinbase transaction, which means that his 107 Bitcoin has to go to the original owner of that coinbase transaction.\\nAnd so maybe this miner, you know, was frozen and wakes up and decides that this is a fun joke because he can just get the 107 Bitcoin back after doing this.\\nBut the other problem is it would have to be a non-SegWit block, because there was no SegWit back then, and SegWit adds something to the coinbase.\\nWell, you can't add that to the coinbase, because then it would be a different block.\\nSo that means all the fees would have to be in non-SegWit transactions.\\nThere's all sorts of problems with this attack.\\nOne problem I can think about is that the next miner might be like, hey, there's a lot of fees in that original block, let me reorg it and mine it myself.\\nBut anyway, so but this could be done.\\nAnd then you would have an identical transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:25:18\"}, {\"type\":\"paragraph\",\"text\":\"Hang on, hang on.\\nMaybe first finish your sentence.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:25:21\"}, {\"type\":\"paragraph\",\"text\":\"So if the attacker did that, they would have an identical transaction.\\nAnd this is what people realized back in 2017, 2018.\\nThat's bad because that is a BIP30 violation.\\nBut we are not checking BIP30 anymore.\\nSo we should check BIP30 again.\\nThat's the solution, basically.\\nBut it was a realization, like, oh, if we don't fix this, let me, you know, they would have to look at all the other numbers that were in all the transactions and see if this could happen earlier.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:25:50\"}, {\"type\":\"paragraph\",\"text\":\"Okay, also, there could still be nodes that are checking BIP30, right, in theory?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:25:54\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, that could be very old nodes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:25:55\"}, {\"type\":\"paragraph\",\"text\":\"Which could be sort of its own problem.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:25:57\"}, {\"type\":\"paragraph\",\"text\":\"All the nodes from before 2015 would check BIP-30, and they would not approve this walk if this attacker did that.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:26:06\"}, {\"type\":\"paragraph\",\"text\":\"Let me sort of cut down, shortcut to, okay, so let's say an actual, let's say just, you know, the classical example, like a state-level attacker that does want to burn a hundred bitcoins just to fuck with Bitcoin.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:26:20\"}, {\"type\":\"paragraph\",\"text\":\"It doesn't have to be a state level attacker like a hundred Bitcoin is there's a lot of money but it's not a state level money.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:26:26\"}, {\"type\":\"paragraph\",\"text\":\"Well hang on we're talking in 20 years from now Sjors.\\nThat's enough to buy North America.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:26:31\"}, {\"type\":\"paragraph\",\"text\":\"Sure okay.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:26:33\"}, {\"type\":\"paragraph\",\"text\":\"So a state level attacker wants to do this, what's the actual specific consequence?\\nWould he also have to do the re-org thing?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:26:45\"}, {\"type\":\"paragraph\",\"text\":\"Well, okay.\\nSo, the question is, first of all, you want to...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:26:47\"}, {\"type\":\"paragraph\",\"text\":\"What's the actual risk?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:26:48\"}, {\"type\":\"paragraph\",\"text\":\"Well, the first risk, and again, this has been fixed, but if it had not been fixed, the first risk is that they could violate BIP30.\\nAnd that means that if you had a node from before 2015, it would not accept the block.\\nNew nodes would accept the block.\\nSo you get a chain split.\\nAnd of course, you know, the majority of people would probably be on the modern nodes because you wouldn't be running 25 year old software, but it's still not healthy.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:27:11\"}, {\"type\":\"paragraph\",\"text\":\"I mean, I'm pretty lazy with upgrading, to be honest.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:27:13\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, Well, your computer will force you to, probably.\\nThe other thing is, then you could have shenanigans.\\nYou could be talking about this reorg scenario.\\nI don't know if that's useful for the attacker or just shoots himself in the foot.\\nBut there may be other weird things that you can do.\\nLike it's not part of the...\\nIt shouldn't happen, basically.\\nSo you can try and reason about it, but you just want to prevent that from happening.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:27:39\"}, {\"type\":\"paragraph\",\"text\":\"Okay, so we've got 22 years more or less to do something about this problem.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:27:44\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, We didn't wait that long.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:27:46\"}, {\"type\":\"paragraph\",\"text\":\"What are we going to do?\\nOh, it's solved already?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:27:48\"}, {\"type\":\"paragraph\",\"text\":\"Yes, in 2018, once they realized this problem was solved, and the solution is straightforward. As of block 1,983,702, we simply started checking BIP30 again.\"}, {\"type\":\"heading\",\"text\":\"Averting a Potential Crisis: The Fix and Its Implications\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:01\"}, {\"type\":\"paragraph\",\"text\":\"Oh, so we're back to checking BIP30 with all these inefficiencies?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:05\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nWe won't now, but we will check it from that block onward.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:09\"}, {\"type\":\"paragraph\",\"text\":\"Oh okay. Yeah, that makes sense.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:11\"}, {\"type\":\"paragraph\",\"text\":\"Which means we have 30 years to actually solve the problem but if we don't solve the problem we'll just check BIP30.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:16\"}, {\"type\":\"paragraph\",\"text\":\"So, in 20 years, if you haven't upgraded your Bitcoin Core node...\\nYour Bitcoin Core node today, if left unupgraded, will still begin checking for BIP30 two decades from now?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:31\"}, {\"type\":\"paragraph\",\"text\":\"That's right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:32\"}, {\"type\":\"paragraph\",\"text\":\"Oh, okay, interesting.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:33\"}, {\"type\":\"paragraph\",\"text\":\"So, your node will likely do so unless you haven't upgraded since before 2018, right?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:38\"}, {\"type\":\"paragraph\",\"text\":\"I'm not sure.\\nNo, probably I did.\\nYeah, I did upgrade since 2018.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:41\"}, {\"type\":\"paragraph\",\"text\":\"There are so many security vulnerabilities in old Bitcoin nodes that this is the last of your problems.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:28:47\"}, {\"type\":\"paragraph\",\"text\":\"I might be like three versions behind, but it's not that bad.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:28:50\"}, {\"type\":\"paragraph\",\"text\":\"That's probably not too bad.\\nBut it gets more exciting than that because 1,983,702 is not the only block where this happens, it was an earlier block where it didn't happen but it could have or it could not have.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:29:06\"}, {\"type\":\"paragraph\",\"text\":\"Wait sorry, there was?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:29:08\"}, {\"type\":\"paragraph\",\"text\":\"There is block 490,897.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:29:11\"}, {\"type\":\"paragraph\",\"text\":\"Are we talking about the future or the past?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:29:13\"}, {\"type\":\"paragraph\",\"text\":\"The past.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:29:14\"}, {\"type\":\"paragraph\",\"text\":\"Okay, what about it?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:29:15\"}, {\"type\":\"paragraph\",\"text\":\"So this block was another one of those numbers that if you look at the all the coinbase transactions and you just find what number is in there, there were a couple of numbers in there.\\nI think one number was so low like 200,000 it was before BIP34 was activated so it wasn't a problem because it was referring to something in the same era.\\nBut the next number was 490,897, which was in October 2017.\\nAnd that block, if it wasn't for some lucky circumstances, could have already exposed this bug that we just talked about.\\nSo we wouldn't have had 30 years.\\nNo, we had two weeks, basically.\\nAt least the people who discovered this issue discovered it about two weeks before that block.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:30:01\"}, {\"type\":\"paragraph\",\"text\":\"Interesting.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:30:01\"}, {\"type\":\"paragraph\",\"text\":\"So, this is like an asteroid heading toward Earth, and NASA says, \\\"Oh, we found an asteroid coming toward Earth, but don't worry, it's going to miss us by at least the distance between here and the moon.\\\"\\nIt's fine.\\nThe only thing is we found out like two hours ago so if it had not missed us we would be dead and we would not have noticed it.\\nSo this is one of those cases where yes, the bug isn't actually harmful, but if it had been harmful, there would have been only two weeks to deal with it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:30:26\"}, {\"type\":\"paragraph\",\"text\":\"Well, I mean, the bug could have been harmful if someone wants to exploit it.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:30:31\"}, {\"type\":\"paragraph\",\"text\":\"No. So basically, by looking at the original transaction, they could see that it was not possible to exploit this.\\nAnd the reason is because that coinbase, yes, you could duplicate it, but it was already spent.\\nAnd so you then need to reproduce the transactions that spent the coinbase.\\nAnd that is impossible because one of those transactions was spending another coinbase.\\nAnd that other coinbase had a number in it, it's like 5 billion or some insane number.\\nAnd we can never get to block 5 billion, at least not in the current code, right?\\nBecause it stops in 2106.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:31:06\"}, {\"type\":\"paragraph\",\"text\":\"I see.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:31:06\"}, {\"type\":\"paragraph\",\"text\":\"And then you have a hard fork.\\nSo with a hard fork, you can fix everything basically though.\\nAnything after block 6 million or so is you don't have to worry about it.\\nSo that was good, but it was a close call.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:31:18\"}, {\"type\":\"paragraph\",\"text\":\"With a hard fork you can fix anything.\\nYou can code shorts on that.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:31:23\"}, {\"type\":\"paragraph\",\"text\":\"I'm not saying you're not introducing a new problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:31:25\"}, {\"type\":\"paragraph\",\"text\":\"Are you pushing for a hard fork?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:31:27\"}, {\"type\":\"paragraph\",\"text\":\"No, you can just wait until 2106.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:31:30\"}, {\"type\":\"paragraph\",\"text\":\"Anyways, okay, we had a near miss in 2017.\\nThat turned out to not be a real problem.\\nNow we got 20 years to either fix this problem or just ignore it because it's kind of already fixed.\\nAnything else?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:31:46\"}, {\"type\":\"paragraph\",\"text\":\"Yes, so the fix was shipped in 2018.\\nIt just basically says, okay, from this block, gonna check BIP30.\\nSo anybody running a modern node doesn't have to worry too much.\\nExcept on TestNet.,I think on TestNet, it's already checking BIP30 now.\\nBut who cares about TestNet.?\\nBecause TestNet had the same kind of problem.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:32:11\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:32:12\"}, {\"type\":\"paragraph\",\"text\":\"And it was fixed in the same way.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:32:14\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:32:14\"}, {\"type\":\"paragraph\",\"text\":\"And I think in TestNet there was another block like that in block 2,200,000 or something like that.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:32:21\"}, {\"type\":\"paragraph\",\"text\":\"I don't care about TestNet..\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:32:22\"}, {\"type\":\"paragraph\",\"text\":\"Testnet is already at block 2,500,000.\\nSo I think it's already checking BIP30.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:32:26\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:32:27\"}, {\"type\":\"paragraph\",\"text\":\"And there's a little code comment saying like, \\\"Oh, I'm sure somebody will fix it before then.\\\"\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:32:32\"}, {\"type\":\"paragraph\",\"text\":\"Oh, I was going to ask, are there others?\\nSo we got 20 years, are there other solutions?\\nLike, is this just it, or do we have other ways out of this conundrum that we find ourselves in?\"}, {\"type\":\"heading\",\"text\":\"Future Proofing Bitcoin Against Similar Issues\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:32:41\"}, {\"type\":\"paragraph\",\"text\":\"So ideally, you want to have something in every block that we know was not in those blocks before BIP34 activated.\\nAnd there's a bunch of candidates that were mentioned back in the day, but one candidate that I saw on Twitter, I think it was Calvin Kim that said it, but I don't know if he came up with it or heard it from somebody else.\\nAnd that is to basically make SegWit mandatory.\\nAnd why?\\nRight now...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:33:14\"}, {\"type\":\"paragraph\",\"text\":\"SegWit for every transaction mandatory?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:33:16\"}, {\"type\":\"paragraph\",\"text\":\"No, just say for every block.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:33:18\"}, {\"type\":\"paragraph\",\"text\":\"For every coinbase transaction?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:33:21\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nSo every block has to commit to SegWit, has to include the SegWit commitment.\\nThe SegWit commitment is an `OP_RETURN` that refers to the tree of SegWit transactions.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:33:30\"}, {\"type\":\"paragraph\",\"text\":\"Oh, wait, so are you just, oh.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:33:33\"}, {\"type\":\"paragraph\",\"text\":\"So the transactions in the block don't have to be segwit.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:33:36\"}, {\"type\":\"paragraph\",\"text\":\"Oh, so what you're saying is there could still be a block mine that has zero segwit transactions.\\nBut as soon as there's one segwit transaction in a block, you need the segwit thing in the coinbase and therefore the transaction ID is different.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:33:48\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and so right now, every time there is a SegWit block, yes, that's happened automatically.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:33:53\"}, {\"type\":\"paragraph\",\"text\":\"Okay, has there been...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:33:53\"}, {\"type\":\"paragraph\",\"text\":\"But empty blocks or blocks with no SegWit transactions do not commit to SegWit.\\nBut definitely empty blocks don't.\\nHowever, they can, they just don't.\\nBecause they don't have to.\\nSo the change would be to say,\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:34:04\"}, {\"type\":\"paragraph\",\"text\":\"Let me ask this question real quick.\\nSo, because I was going to ask, has there been any block mined that doesn't include any segwit transactions?\\nSince segwit is out and that would be empty blocks.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:34:16\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:34:16\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nMakes sense.\\nOkay, go on.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:34:17\"}, {\"type\":\"paragraph\",\"text\":\"So basically, you know, the difficulty then would just be, okay, when you propose an empty block, which you have to do as a miner sometimes, very briefly, just make sure that it's a segwit block.\\nSo that would be a fairly simple soft fork.\\nBut there are other ideas out there.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:34:35\"}, {\"type\":\"paragraph\",\"text\":\"It's probably still like, you know, in the sort of Puritan Bitcoin conservative, you know, which is a good philosophy, It's still kind of a cost to miners, which you're imposing on miners, like now they have to do something extra.\\nLike it might still be controversial, I don't know.\\nWhat do you think?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:34:54\"}, {\"type\":\"paragraph\",\"text\":\"I don't know if it's a cost to miners because if they use Bitcoin Core to create the block templates, Bitcoin Core would just do it for them.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:35:01\"}, {\"type\":\"paragraph\",\"text\":\"Well, the cost I'm referring to is you have to upgrade your Bitcoin Core node once in a while.\\nIt's not backwards compatible is what I'm basically saying.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:35:10\"}, {\"type\":\"paragraph\",\"text\":\"Not for the miners, no, but that's always true for Soft Forks.\\nWell, no, it's not always true for Soft Forks.\\nGenerally soft forks are done in such a way that if you only mine standard transactions, then you're going to be fine.\\nBut for this case, yes, miners would have to do something, just like they had in the first time it was introduced.\\nSo yeah, it's not entirely innocent.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:35:31\"}, {\"type\":\"paragraph\",\"text\":\"It seems to me like a very plausible or reasonable solution.\\nI'm just pointing out that even that might have some pushback.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:35:37\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, and the other solutions have this same, I think, have the same property, is that every miner would have to do it, or they might lose a block if they mine an empty block.\\nSo I think another one was, okay, we just add the block height again, but we add it to a different field, like the lock time of the coinbase transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:35:54\"}, {\"type\":\"paragraph\",\"text\":\"Because lock time wasn't activated back in?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:35:57\"}, {\"type\":\"paragraph\",\"text\":\"Lock time wasn't used.\\nAs far as I know, again, you'd have to run a script and check.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:36:01\"}, {\"type\":\"paragraph\",\"text\":\"Well, LockTime was introduced in 2015, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:36:05\"}, {\"type\":\"paragraph\",\"text\":\"It's possible, but the field might, the field with the numbers were there.\\nThey didn't have any meaning, right?\\nSo you still have to check that they weren't used.\\nBut that's easy.\\nI think this SegWit thing is the simplest one.\\nThe other option is we can buy ourselves another 20 years or so to block 3,808,179.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:36:27\"}, {\"type\":\"paragraph\",\"text\":\"How?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:36:27\"}, {\"type\":\"paragraph\",\"text\":\"Well, we would have to very carefully study block 1,983,702.\\nWell not this block, but the original block that created it.\\nAnd that coinbase has been spent so it can already be recreated but you have to look at all the descendants.\\nSo this thing was spent to like around 10 different addresses and those could spend and those could spend.\\nAnd if you can show that for every transaction descending from it, it was also using a coinbase transaction that cannot be duplicated, maybe you can prove that it, you know, you could write a proof that it can never happen, gives you another 20 years.\\nI think that's a stupid exercise compared to the simple soft fork.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:04\"}, {\"type\":\"paragraph\",\"text\":\"Well, you didn't figure it out for this podcast, if that's the case or not?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:37:07\"}, {\"type\":\"paragraph\",\"text\":\"I did ask it on Stack Overflow in a comment somewhere, but no, I did not.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:11\"}, {\"type\":\"paragraph\",\"text\":\"Sure, do you even do?\\nWhat do you do for this podcast?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:37:16\"}, {\"type\":\"paragraph\",\"text\":\"Nothing.\\nMoving on.\\nI did actually run a script to check that there are no `OP_RETURN` transactions before BIP324 activated.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:26\"}, {\"type\":\"paragraph\",\"text\":\"Wait, sorry, can you repeat that just for me?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:37:28\"}, {\"type\":\"paragraph\",\"text\":\"There were no `OP_RETURN` transactions in the coinbase before BIP324 activated.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:33\"}, {\"type\":\"paragraph\",\"text\":\"You did actually check that?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:37:35\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:35\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:37:35\"}, {\"type\":\"paragraph\",\"text\":\"Which means that you don't even have to commit to SegWit; you just have to put `OP_RETURN` in a coinbase transaction.\\nThat will be the rule.\\nBut of course, it's easier to just say SegWit.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:37:46\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\\nSo far, I think we agree SegWit is the most reasonable, low effort kind of way of doing this.\\nI guess you could do Taproot as well, maybe, or no?\\nDoes it make sense?\\nNo, just SegWit.\\nI'm just thinking out loud.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:00\"}, {\"type\":\"paragraph\",\"text\":\"You want to keep it simple?\\nSo the funny thing is there was in 2019 a proposal...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:04\"}, {\"type\":\"paragraph\",\"text\":\"I'm just thinking of soft forks that were introduced after 2015 to make me sound smart.\\nBut yeah, SegWit is the obvious thing here.\\nGo on.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:12\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, so there was a great consensus cleanup proposal back in 2019 by Matt Corallo, BlueMatt, which contained a bunch of these very small fixes, kind of similar to this one, but not actually this one.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:27\"}, {\"type\":\"paragraph\",\"text\":\"A fix for this specific problem?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:29\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, it was not in there.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:31\"}, {\"type\":\"paragraph\",\"text\":\"So why do you even bring it up?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:33\"}, {\"type\":\"paragraph\",\"text\":\"Because I was curious whether the great consensus cleanup would clean this up.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:36\"}, {\"type\":\"paragraph\",\"text\":\"Right, and it doesn't.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:38\"}, {\"type\":\"paragraph\",\"text\":\"But it would if you were to revive that proposal you should clean this up too.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:42\"}, {\"type\":\"paragraph\",\"text\":\"Okay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:42\"}, {\"type\":\"paragraph\",\"text\":\"Because it also fixes the time warp attack and other things that we've discussed in other episodes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:47\"}, {\"type\":\"paragraph\",\"text\":\"Sure, yeah.\\nOkay.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:51\"}, {\"type\":\"paragraph\",\"text\":\"That's all I have.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:38:52\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, well, I mean, sounds to me like SegWit is the easy way to go, and also...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:38:57\"}, {\"type\":\"paragraph\",\"text\":\"We have a few decades to figure this out.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:39:00\"}, {\"type\":\"paragraph\",\"text\":\"We can think about it a while.\\nAll right, thanks, Sjors.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost: 00:39:02\"}, {\"type\":\"paragraph\",\"text\":\"All right and thank you for listening to Bitcoin.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum: 00:39:05\"}, {\"type\":\"paragraph\",\"text\":\"Explained.\"}",
    "body": "## Introduction\n\nAaron van Wirdum: 00:00:19\n\nLive from Utrecht, this is Bitcoin Explained.\nHey Sjors.\n\n[omitted sponsors segment]\n\nAaron van Wirdum: 00:01:20\n\nSjors, today we're discussing a very niche bug that I had never heard of, but apparently there's a bug in the Bitcoin protocol.\n\nSjors Provoost: 00:01:31\n\nWell, there was a bug in the Bitcoin protocol.\n\nAaron van Wirdum: 00:01:35\n\nBut there's still a problem.\n\nSjors Provoost: 00:01:38\n\nThere was a bug, then there was no bug, then there was a bug, then there was no bug.\nThere's still a problem, but not a bug.\n\nAaron van Wirdum: 00:01:45\n\nOkay, I see.\nSo, there was a bug, now there's no bug, but there's still a problem which is not a bug.\n\nSjors Provoost: 00:01:51\n\nWell, it's kind of a bug, but it's not like a dangerous bug like the original thing.\n\n## Explaining the Bug and Its Implications\n\nAaron van Wirdum: 00:01:55\n\nSounds pretty buggy.\nAnyway, so it's called the \"1,983,702\" problem.\nDid I say it right even?\nThe block \"1,983,702\" problem.\n\nSjors Provoost: 00:02:11\n\nYeah, that sounds good.\nOr the block \"1,983,702\" problem.\n\nAaron van Wirdum: 00:02:14\n\nSo, this will be a problem in.\n\nSjors Provoost: 00:02:18\n\nYeah, there's another term you could use is the BIP34 does not imply BIP30 problem.\n\nAaron van Wirdum: 00:02:27\n\nI don't know which one is worse.\nThey're both pretty bad.\n\nSjors Provoost: 00:02:30\n\nOkay, cool.\n\nAaron van Wirdum: 00:02:31\n\nSo, this will be a problem in block, well, again, 1,900,000 something.\n\nSjors Provoost: 00:02:38\n\nYeah, which is like a couple decades from now.\n\nAaron van Wirdum: 00:02:40\n\nYes, like 22 years from now, my sort of napkin math told me.\n\nSjors Provoost: 00:02:44\n\nAnd to be clear, It's a problem, it's not like bad.\n\nAaron van Wirdum: 00:02:49\n\nOkay, but it is something that needs to be solved eventually, in some way or another.\n\nSjors Provoost: 00:02:55\n\nIt's better if we solve it, yeah.\nBut it's not like the 2106 problem, which, like in the year 2106, the whole blockchain simply stops.\nThat's definitely a problem.\n\nAaron van Wirdum: 00:03:05\n\nIs this not a problem that's going to require a consensus change?\n\nSjors Provoost: 00:03:09\n\nNo, ideally it would.\nBut not a hard fork.\n\nAaron van Wirdum: 00:03:12\n\nOkay.\nHow did you find about it?\nLike I said, I'd never heard of this.\nIs this just something you, this is your hobby you look for very niche things that no one else has heard about?\n\nSjors Provoost: 00:03:23\n\nWell, we sometimes need to scrape the bottle of the barrel for episodes titles, but in this case, I was trying to understand a bug in Stratum V2, something I'm working on recently, and had something to do with the coinbase transactions and whether or not it has a witness.\nTurns out it does have a witness, or at least it can have a witness, which I didn't know, and That's why I kept banging my head against it.\nBut as I was trying to understand how the code works, I was reading the code comments, and I came across this like almost full-page story about this problem.\n\nAaron van Wirdum: 00:03:57\n\nOkay, I'm gonna just call it the \"1,900,000\" problem because I don't wanna read it in full every time.\nSo, the 1 million 900,000 problem, we'll start at the beginning.\nSo, you mentioned there was a bug.\nIt all started with a bug, right?\nAnd this has been a bug in Bitcoin since the beginning?\n\nSjors Provoost: 00:04:18\n\nYes.\n\nAaron van Wirdum: 00:04:19\n\nLike it's an OG Satoshi bug?\n\nSjors Provoost: 00:04:21\n\nExactly, an OG Satoshi bug, which is that it was possible for two identical transactions to exist, or more than one basically, identical transactions to exist in sequence.\n\nAaron van Wirdum: 00:04:33\n\nIt was or wasn't?\n\nSjors Provoost: 00:04:35\n\nIt was possible.\nAnd this was creating a problem because, well, when the transaction exists twice, then the original one essentially just disappears.\nThis has to do with how transactions work.\n\nAaron van Wirdum: 00:04:51\n\nYeah, let's halt here for a second.\nSo how do you get two identical transactions?\n\nSjors Provoost: 00:04:56\n\nSame hash.\nSo, the same hash means it's the same content.\nSo, it's the same inputs, the same outputs.\nAnd so typically you would expect this in a coinbase transaction in the early days, because a coinbase transaction doesn't have any inputs, or maybe it is the name of your pool, which would be the same if you were mining multiple blocks.\nAnd then the outputs might be the address that you're paying yourself to, which might also be the same of your pool.\nSo, if you mined in the early days two blocks to the same address and with the same pool name and you were like, I guess that...\n\nAaron van Wirdum: 00:05:30\n\nyeah.\nThat makes sense.\nSo, you're a pool in the early days, you have your Bitcoin address, one blah blah blah blah blah, because that was the early addresses, and you're mining new coins, so there's no inputs, and you just, these new 50 coins are sent to this one blah blah blah address.\nAnd if that happens twice, if you say you mine two blocks in a row, it's going to be the exact same transaction.\n\nSjors Provoost: 00:05:54\n\nYeah, however, it also would have to be the same amount, right?\nSo, this would be either a block with no transactions in it, so no fees.\nSo the coinbase amount would be exactly 50 Bitcoin back in the day, or it would be coincidentally the exact same total fees.\nThe thing is, it only happened twice.\n\nAaron van Wirdum: 00:06:14\n\nEspecially In the early days, there were still a lot of transactions that didn't pay any fee, I guess.\nOr there was a fixed fee for a while.\n\nSjors Provoost: 00:06:20\n\nProbably a fixed fee.\nSo then maybe if you had...\nI don't know.\nI didn't look at those specific blocks.\n\nAaron van Wirdum: 00:06:24\n\nAnyways, that is the most likely reason why that would happen.\nIs it plausible that it could happen in any other circumstance to identical transactions?\n\nSjors Provoost: 00:06:36\n\nWell, it could happen as a child of the coin.\nSo if the coinbase transactions are identical, then you could make another transaction.\nBasically, you could just replay another transaction from the past that spends that coinbase transaction.\nSo the whole history of that coinbase could be repeated.\nSo if somebody mines a block and then they send it to the Pirate Bay and they download a movie, you could redo all that history.\n\nAaron van Wirdum: 00:07:00\n\nYeah, It would just have to start from the same coinbase transaction that's already identical.\nThat's the only way you can get more identical transactions.\nYou start from there, yeah.\n\nSjors Provoost: 00:07:09\n\nExactly.\n\nOr if you break SHA-256.\n\nAaron van Wirdum: 00:07:12\n\nWhich is also an episode we recorded at some point, I think.\n\nSjors Provoost: 00:07:17\n\nI don't think anybody broke SHA-256, but we did talk about hashes in general.\n\nAaron van Wirdum: 00:07:21\n\nWe talked about what it means to break it, I think.\nAnyways, I'm going on to tangents here.\nOkay, so that's how you can get identical transaction IDs. And so you said it's possible, so why is it a bug if it's possible?\nBecause I thought you were gonna say it's impossible, but you said it's possible.\nWhy is it a bug then?\n\nSjors Provoost: 00:07:42\n\nIt's possible, it was possible to be exact, but the bug is that it creates problems for you, especially for you as the recipient of that transaction.\n\nAaron van Wirdum: 00:07:52\n\nSo the miner in this case?\n\nSjors Provoost: 00:07:53\n\nYeah, so the miner mines, say, 50 Bitcoin and doesn't spend it, and then a week later, he mines 50 Bitcoin and also doesn't spend it.\nNow he's like, oh, I've got 100 Bitcoins, how am I gonna spend this?\nOh, I'm gonna make a transaction and this transaction points to a previous transaction, that's what a transaction is to do.\nSo you would point to the original coinbase transaction by its hash and then also by the position of the output in the coinbase transaction.\nBut then the question is, which one do you mean?\nAnd the Bitcoin Core software would simply look at the most recent one and would spend that.\nAnd There was only one entry, so it would just be overwritten.\nSo the original coins would be gone.\n\nAaron van Wirdum: 00:08:42\n\nOkay, you have to explain this, I think.\nWhy would the original...\nSo you say Bitcoin Core would just take the most recent one.\nSo why wouldn't the older one just also still exist for next time you want to spend?\n\nSjors Provoost: 00:08:53\n\nWell, so Bitcoin Core keeps track of a list of outputs that exist.\nBasically, the transaction hash and the identifier.\nSo if you add another one that is the same, it would just overwrite it.\n\nAaron van Wirdum: 00:09:05\n\nOh, sorry, do you just mean the UTXO set here?\n\nSjors Provoost: 00:09:08\n\nYeah, although I think at the time the UTXO set worked a little different than it does now.\nBut I think essentially it was the same thing.\nIt's just a list of coins that exist.\nSo it's a transaction hash and an identifier and whatever script you need to spend it.\nAnd so if you were to create the transaction again, that would just be the same entry in the database.\nSo the database would think there's only one.\n\nAaron van Wirdum: 00:09:29\n\nOkay, so not both transactions would be included in this database.\nIt would just be considered as the same transaction, so there's only one.\nSo then if you spend it, both are gone because they overlap.\n\nSjors Provoost: 00:09:41\n\nBecause you deleted one entry.\nSo this can lead to quite strange situations.\nFor example, let's say you mine a transaction once and then a couple blocks later you mine it again and then you spend it and so then it disappeared, right?\nThat's one way, but let's say you mine one transaction,\nyou mine a couple other blocks, and then you mine the transaction again.\nNow, if there's a re-org, the blockchain undoes your most recent block, and then creates some other blocks.\nThat means that your transaction has now disappeared from your point of view.\n\nAaron van Wirdum: 00:10:29\n\nYeah, okay, I get it.\nSo, let me try to re-explain that, even though it was kind of clear to me, but maybe if I re-explain that might help one other person out there.\nSo, yeah, you're creating a blockchain, obviously, and then the first coinbase transaction is included in block three, and then the next one is included in block seven.\nBut then there's another block seven, and that's the blockchain that the network goes with.\nThat becomes the longest chain.\nSo now your second coinbase transaction is deleted from your UTXO set, basically, or your database, and it's not like the one before that is not like automatically restored either.\nSo now you lost both.\n\nSjors Provoost: 00:11:12\n\nYeah, you lost both.\nHowever, somebody else who just starts up a new blockchain, a Bitcoin blockchain, will never see the original second block.\nSo they will only see the first block in which you do get the coinbase.\nAnd as far as they're concerned, it's still there.\nSo now you have a consensus failure.\nBecause part of the network believes that a coin exists and the other does not and that will explode as soon as somebody tries to spend it.\n\nAaron van Wirdum: 00:11:33\n\nYeah, or to put it a little bit more accurately, maybe...\nI mean, I think you're saying it technically accurately, but the more normie way of saying it is there's no consensus on who owns which coins.\n\nSjors Provoost: 00:11:44\n\nWell, yeah, There's no consensus on who owns that, on whether that specific coin exists.\n\nAaron van Wirdum: 00:11:48\n\nNot so much who owns it.\nWell, that's a technical way of saying it, right?\n\nSjors Provoost: 00:11:51\n\nWell, it's not about who owns it, it's that it exists or not.\nSo you can spend a coin that doesn't exist.\nIt's not about not satisfying the script, but it's just about the coin not existing.\n\nAaron van Wirdum: 00:12:01\n\nYeah, you're right actually.\nIn the real case, some nodes would actually think the coins don't exist at all anymore because yes, I see what you're saying.\nYeah, you're right.\nAnyways, the important part is that the UTXO set or what, Sorry, why do you not call it the UTXO set?\n\nSjors Provoost: 00:12:17\n\nDid you say back in the day was- So this is the part I'm a little vague on, but initially the concept that we call the UTXO set, so a list of coins that exist, is not something that Satoshi invented as such.\nI think we'll cover that again maybe in a future episode.\nBut this idea of having a database of which coin exists and you just add and remove coins from it, I think at the time it was not like that.\nIt was just a list of all transactions that were still relevant or something like that.\nIt was less efficient.\nSo, I think in 2018 or 2017, it was refactored into what we would now consider the UTXO set.\n\nAaron van Wirdum: 00:12:58\n\nOkay.\n\nSjors Provoost: 00:12:59\n\nBut this less efficient implementation had the same problem.\nThe modern UTXO set would definitely have this problem.\nAnd my understanding is the original one had two, even though it stored more data than we do now.\n\nAaron van Wirdum: 00:13:10\n\nAnyways, the key point here being that the ownership records that every node holds would start to diverge.\nAnd if that starts to happen, that is a consensus failure.\nThat you could get to a place where you try spending coins and it confirms on your end and it doesn't confirm on the other end and networks start to, it's chaos.\nLike that's, so that's potentially, that was a potential actual risk with this OG Satoshi bug.\n\nSjors Provoost: 00:13:35\n\nYeah, and as far as I know, what did happen was there were two instances of these duplicate coinbases.\nBasically miners losing 50 BTC.\nBut I don't think there were cases of also re-org on top of that that would have created this mess.\nBut maybe there was and nobody noticed it.\nBecause the mess would not have been...\nWell, I think we would have noticed it now, yeah.\n\nAaron van Wirdum: 00:13:58\n\nProbably right.\nThat would have been very unlucky as well.\nLike, you've got to have an exact re-org exactly on that block where this exact block happened.\n\nSjors Provoost: 00:14:07\n\nYeah, and because as far as we can tell it only happened twice, it might have happened more often in chains that never survived.\n\nAaron van Wirdum: 00:14:14\n\nWell, no, then we would have the problem, right?\n\nSjors Provoost: 00:14:17\n\nWell maybe we are the surviving chain where that didn't happen, but there may have been other chains where it did happen and it didn't survive.\n\nAaron van Wirdum: 00:14:23\n\nWell we would have probably heard it then at some point, don't you think?\nBecause then there would have been nodes with these different transaction records, UTXO, set, whatever you want to call it.\n\nSjors Provoost: 00:14:32\n\nYeah, but I mean, if this was long enough ago, maybe they just restarted the computer and just didn't care, but probably didn't happen.\nFair.\n\nAaron van Wirdum: 00:14:40\n\nAll right.\nSo this was the OG Satoshi bug.\nAnd This bug was fixed.\n\n## Addressing the Bug: BIP30's Role\n\nSjors Provoost: 00:14:47\n\nExactly.\nAnd this is where BIP30 comes in.\nThis was introduced in 2012.\nWhat BIP30 does is very simple.\nIt says there shall never be two transactions with the same hash at the same time.\n\nAaron van Wirdum: 00:15:01\n\nAt the same time?\n\nSjors Provoost: 00:15:02\n\nAt the same time.\nAs in, if you create a transaction right now, it's not allowed to already exist in the UTXO set.\n\nAaron van Wirdum: 00:15:08\n\nOkay, but it's just an invalid transaction.\nSo if the same thing would happen, if the miner would create this coinbase transaction where he pays himself to the same address.\nThe Bitcoin network nodes, my node, your node, would just say, this is not valid, you just wasted your energy, we're going to wait for a valid block.\n\nSjors Provoost: 00:15:25\n\nExactly.\nNow, let's say they do that, they make a coinbase, then they spend it, then they can make the same coinbase again.\nThat's no problem.\nSo BIP30 does allow that.\nSo that was great and that worked.\nThe only problem is that this rule is a bit difficult to check, because it means that whenever you get a new block, for every transaction in that block, you have to make sure that it doesn't already exist, the transaction itself.\nSo right now, whenever you check a block, you go through every transaction and you check that all its inputs exist, so it's spending from something that exists, but you do not check if the transaction itself exists, or at least you don't now because of what we'll discuss.\nBut with BIP30, you would have to do that.\nYou'd have to do an extra check for every transaction.\nLike, hey, now that I've checked that all the inputs are valid, or whichever sequence we're going to do, does this transaction exist?\n\nAaron van Wirdum: 00:16:25\n\nSo that was the case in 2012, for a brief while, at least, after BIP30 was deployed.\nAnd this sounds like it's an especially annoying or burdensome check because it's so unlikely that it's necessary, especially for all non-coinbase transactions.\nBut just technically...\n\nSjors Provoost: 00:16:44\n\nIt's completely unnecessary in the sense that no miner would be this stupid, but of course if you don't check then they would be.\n\nAaron van Wirdum: 00:16:50\n\nYou have to check, but it's burdensome.\n\nSjors Provoost: 00:16:52\n\nBut it wastes some resources.\nI don't know how much, if it's like 1% or 10%, but it's annoying.\n\nAaron van Wirdum: 00:17:00\n\nAnd also, in general, you want miners and all nodes to be able to check the validity of new blocks as soon as possible.\n\n## Efficiency and BIP34: A Solution with Caveats\n\nSjors Provoost: 00:17:10\n\nYeah, so every second you can shave off, the checking time is better.\nSo, BIP34 was introduced, which made this process more efficient.\n\nAaron van Wirdum: 00:17:18\n\nWhen was this?\n\nSjors Provoost: 00:17:20\n\nSame year, just half a year later.\nThat is to say...\n\nAaron van Wirdum: 00:17:21\n\nAnd was this introduced especially because, before the reason we just mentioned?\nYes.\nOkay, so it was like a performance improvement.\n\nSjors Provoost: 00:17:29\n\nI think so.\nSo, the little background is that BIP30 was a relatively simple software that could be deployed very quickly because they realized the problem and they wanted to fix it as quickly as possible so nobody would deliberately exploit it.\nBIP34 was something that was deployed a bit more carefully, very much like the BIP9 style soft fork.\nSo there was some signaling involved, block version number went up and you had like so many percent of the miners had to signal it, et cetera, et cetera.\nSo BIP34 was a more thorough solution, but it was also deployed more carefully.\nSo what does BIP34 do?\nWell, it makes sure that, well, that was the idea, that the coinbase transaction is unique by definition by adding the block height to it.\nSo every coinbase transaction must start with the block height.\nAnd because it must start with the block height, it's going to be different than previous transactions which had a different block height, or previous coinbase transactions had a different block height, so you won't have the duplicates.\nThat is to say moving forward, you don't have to duplicate.\n\nAaron van Wirdum: 00:18:33\n\nYeah, okay, yeah, this makes sense.\nThis way every coinbase necessarily is unique, like every coinbase transaction necessarily is unique because it's in a new block that has new block height.\nAnd therefore every transaction that is spent from that coin is also unique.\nSo now every transaction has to be unique.\n\nSjors Provoost: 00:17:52\n\nYes.\n\nAaron van Wirdum: 00:18:53\nOkay, yeah, makes sense.\nGood solution, Sjors, I like it.\nWho came up with this?\n\nSjors Provoost: 00:18:58\n\nI think it was...\nI'm not sure.\n\nAaron van Wirdum: 00:19:02\n\nWell, whoever came up with it, congratulations.\nThank you.\n\nSjors Provoost: 00:19:05\n\nI think it was...\n\nAaron van Wirdum: 00:19:06\n\nHowever, I guess there's another problem you're going to mention about this solution or not.\n\nSjors Provoost: 00:19:10\n\nI think the original one was Peter Wuille and the second one was Russell O'Connor.\n\nAaron van Wirdum: 00:19:15\n\nHowever, so I guess this is why we're making this episode.\n\nSjors Provoost: 00:19:18\n\nNo, Gavin Andresen.\n\nAaron van Wirdum: 00:19:19\n\nGavin Andresen.\nI could have guessed.\nGavin, you messed up.\n\nSjors Provoost: 00:19:25\n\nWell, I don't know.\nI mean, it's just he's the author, so it doesn't mean that he came up with it.\n\nAaron van Wirdum: 00:19:30\n\nIt was a joke, but maybe it's a kind of a sensitive joke at this point in time.\nSjors, go on.\nBecause there is a problem.\nIt introduced a problem.\n\nSjors Provoost: 00:19:42\n\nYes.\nWell, actually, it did not introduce a problem.\nSo just having this rule is fine.\n\nAaron van Wirdum: 00:19:49\n\nOkay.\nGood job, Gavin.\n\n\nSjors Provoost: 00:19:52\n\nHowever...\nSo Gavin, whatever it was, he didn't do anything wrong.\n\nAaron van Wirdum: 00:19:55\n\nOkay.\n\nSjors Provoost: 00:19:56\n\nHowever, then in 2015, somebody tried to be smart and said, hey, we have this BIP34, which means that we don't need to check for BIP30 anymore.\nWe can make it faster.\nSo perhaps I said before in the episode, oh this was the reason the performance thing was the reason to introduce it.\nMaybe not.\nMaybe they did it because it was just a more elegant solution and it would prevent mistakes.\nBut then a couple of years later, somebody realized, hey, we can actually make this faster by not checking BIP30 anymore.\nBecause we know that the blocks must be unique, right?\n\nAaron van Wirdum: 00:20:31\n\nYeah, like I explained just now.\nI immediately got it.\nWhy did it take these Bitcoin core developers so long, Sjors?\n\nSjors Provoost: 00:20:37\n\nI don't know.\nSo, in 2015, that optimization was merged.\nAnd well, then in 2018, so three years later, somebody realized, oh, oops!\nthat doesn't actually work.\n\n## The Unforeseen Consequences of Optimizations\n\nAaron van Wirdum: 00:20:53\n\nWait, wait, wait, sorry, I lost the plot.\nWhere are we now?\nWhat's the year?\n\nSjors Provoost: 00:20:57\n\nWell, the year of the fix is 2018, but I guess the year of the realization was late 2017.\nSo somewhere, I think it was October 2017, but this wasn't documented, but it kind of follows.\nSomebody realized, oh wait a minute, there are exceptions to this convenient rule.\nRemember that the rule of BIP34 is that you put the height of the block at the beginning of the coinbase.\nSo block number one would have height number one, etc.\nBut that rule only applies starting with block, I don't know, 200,000 something.\n\nAaron van Wirdum: 00:21:36\n\nIt started being applied in 2012.\n\nSjors Provoost: 00:21:39\n\nYeah, and it started being applied from height number 220,000 or something like that.\nSo then the question, and so from there on this rule is correct, but the problem is, and that's what people realize, is that it doesn't apply earlier.\nThe rule wasn't active earlier.\nSo what is actually in those earlier coinbase transactions?\nMight there be numbers in those earlier coinbase transactions, numbers that could represent a block height?\nThe answer is yes.\nThere were numbers in there.\nSo there were older coinbase transactions that had numbers in there that represented blocks that might occur in the future.\n\nAaron van Wirdum: 00:22:12\n\nOkay, I know what you're saying, but you don't, The word represent is confusing here.\nThere were just numbers in there and they could be interpreted as blocks from the future.\n\nSjors Provoost: 00:22:21\n\nYeah, either it was a very smart miner that foresaw that this problem was going to happen.\n\nAaron van Wirdum: 00:22:25\n\nFor instance, there could have been an early miner who, for whatever reason, placed the number one million in the coinbase.\n\nSjors Provoost: 00:22:34\n\nYeah, so as the episode suggests, some miner put the number 1,983,702 in the coinbase.\nThey didn't actually put that number in there, they were probably just writing their name, and the name, if you map it into how a computer reads it, might have looked like a big number.\n\nAaron van Wirdum: 00:22:50\n\nSo, there was a block in, like, say 2009, that starts with the number 1,900,000 something.\nSo, by the time we actually get to block number 1,900,000, and that number has to be put in the coinbase, there's a risk that it was a pretty, that's not gonna happen, right?\n\nSjors Provoost: 00:23:16\n\nNormally this would not happen,\nBut in theory, somebody would have to put the same number in it.\n\nAaron van Wirdum: 00:23:21\n\nYes.\n\nSjors Provoost: 00:23:22\n\nAnd then could, if they wanted to, wouldn't happen accidentally, make the rest of the coinbase identical to that original transaction.\n\nAaron van Wirdum: 00:23:29\n\nSo, yeah, so it would just have to spend the same amount of...\nWell, no, because there's 50 coins in the original coinbase.\n\nSjors Provoost: 00:23:37\n\nMuch more.\nSo, Merge looked at this specific transaction, and it turns out that that was a very lucky block.\nSo, not only did it get a 50 Bitcoin coinbase subsidy, which modern blocks don't get, it also got, I think, 50 or so BTC in fees.\n\nAaron van Wirdum: 00:23:55\n\nThat's good.\n\nSjors Provoost: 00:23:56\n\nYeah, so that's a very nice little block in the past.\nSo if you wanted to reproduce this, your coinbase transaction would have to create about 107 Bitcoin.\nIt would have to spend 107 Bitcoin.\nThat is only allowed if there is 107 Bitcoin worth of fees in that block.\nSo that's never going to happen accidentally.\n\nAaron van Wirdum: 00:24:15\n\nThe other thing that has to happen is that the attacker would have to actually probably pay these fees himself and then burn it in this block.\n\nSjors Provoost: 00:24:22\n\nYes, because he cannot send it to some arbitrary destination.\nHe has to reproduce the original coinbase transaction, which means that his 107 Bitcoin has to go to the original owner of that coinbase transaction.\nAnd so maybe this miner, you know, was frozen and wakes up and decides that this is a fun joke because he can just get the 107 Bitcoin back after doing this.\nBut the other problem is it would have to be a non-SegWit block, because there was no SegWit back then, and SegWit adds something to the coinbase.\nWell, you can't add that to the coinbase, because then it would be a different block.\nSo that means all the fees would have to be in non-SegWit transactions.\nThere's all sorts of problems with this attack.\nOne problem I can think about is that the next miner might be like, hey, there's a lot of fees in that original block, let me reorg it and mine it myself.\nBut anyway, so but this could be done.\nAnd then you would have an identical transaction.\n\nAaron van Wirdum: 00:25:18\n\nHang on, hang on.\nMaybe first finish your sentence.\n\nSjors Provoost: 00:25:21\n\nSo if the attacker did that, they would have an identical transaction.\nAnd this is what people realized back in 2017, 2018.\nThat's bad because that is a BIP30 violation.\nBut we are not checking BIP30 anymore.\nSo we should check BIP30 again.\nThat's the solution, basically.\nBut it was a realization, like, oh, if we don't fix this, let me, you know, they would have to look at all the other numbers that were in all the transactions and see if this could happen earlier.\n\nAaron van Wirdum: 00:25:50\n\nOkay, also, there could still be nodes that are checking BIP30, right, in theory?\n\nSjors Provoost: 00:25:54\n\nYeah, that could be very old nodes.\n\nAaron van Wirdum: 00:25:55\n\nWhich could be sort of its own problem.\n\nSjors Provoost: 00:25:57\n\nAll the nodes from before 2015 would check BIP-30, and they would not approve this walk if this attacker did that.\n\nAaron van Wirdum: 00:26:06\n\nLet me sort of cut down, shortcut to, okay, so let's say an actual, let's say just, you know, the classical example, like a state-level attacker that does want to burn a hundred bitcoins just to fuck with Bitcoin.\n\nSjors Provoost: 00:26:20\n\nIt doesn't have to be a state level attacker like a hundred Bitcoin is there's a lot of money but it's not a state level money.\n\nAaron van Wirdum: 00:26:26\n\nWell hang on we're talking in 20 years from now Sjors.\nThat's enough to buy North America.\n\nSjors Provoost: 00:26:31\n\nSure okay.\n\nAaron van Wirdum: 00:26:33\n\nSo a state level attacker wants to do this, what's the actual specific consequence?\nWould he also have to do the re-org thing?\n\nSjors Provoost: 00:26:45\n\nWell, okay.\nSo, the question is, first of all, you want to...\n\nAaron van Wirdum: 00:26:47\n\nWhat's the actual risk?\n\nSjors Provoost: 00:26:48\n\nWell, the first risk, and again, this has been fixed, but if it had not been fixed, the first risk is that they could violate BIP30.\nAnd that means that if you had a node from before 2015, it would not accept the block.\nNew nodes would accept the block.\nSo you get a chain split.\nAnd of course, you know, the majority of people would probably be on the modern nodes because you wouldn't be running 25 year old software, but it's still not healthy.\n\nAaron van Wirdum: 00:27:11\n\nI mean, I'm pretty lazy with upgrading, to be honest.\n\nSjors Provoost: 00:27:13\n\nYeah, Well, your computer will force you to, probably.\nThe other thing is, then you could have shenanigans.\nYou could be talking about this reorg scenario.\nI don't know if that's useful for the attacker or just shoots himself in the foot.\nBut there may be other weird things that you can do.\nLike it's not part of the...\nIt shouldn't happen, basically.\nSo you can try and reason about it, but you just want to prevent that from happening.\n\nAaron van Wirdum: 00:27:39\n\nOkay, so we've got 22 years more or less to do something about this problem.\n\nSjors Provoost: 00:27:44\n\nYeah, We didn't wait that long.\n\nAaron van Wirdum: 00:27:46\n\nWhat are we going to do?\nOh, it's solved already?\n\nSjors Provoost: 00:27:48\n\nYes, in 2018, once they realized this problem was solved, and the solution is straightforward. As of block 1,983,702, we simply started checking BIP30 again.\n\n## Averting a Potential Crisis: The Fix and Its Implications\n\nAaron van Wirdum: 00:28:01\n\nOh, so we're back to checking BIP30 with all these inefficiencies?\n\nSjors Provoost: 00:28:05\n\nYes.\nWe won't now, but we will check it from that block onward.\n\nAaron van Wirdum: 00:28:09\n\nOh okay. Yeah, that makes sense.\n\nSjors Provoost: 00:28:11\n\nWhich means we have 30 years to actually solve the problem but if we don't solve the problem we'll just check BIP30.\n\nAaron van Wirdum: 00:28:16\n\nSo, in 20 years, if you haven't upgraded your Bitcoin Core node...\nYour Bitcoin Core node today, if left unupgraded, will still begin checking for BIP30 two decades from now?\n\nSjors Provoost: 00:28:31\n\nThat's right.\n\nAaron van Wirdum: 00:28:32\n\nOh, okay, interesting.\n\nSjors Provoost: 00:28:33\n\nSo, your node will likely do so unless you haven't upgraded since before 2018, right?\n\nAaron van Wirdum: 00:28:38\n\nI'm not sure.\nNo, probably I did.\nYeah, I did upgrade since 2018.\n\nSjors Provoost: 00:28:41\n\nThere are so many security vulnerabilities in old Bitcoin nodes that this is the last of your problems.\n\nAaron van Wirdum: 00:28:47\n\nI might be like three versions behind, but it's not that bad.\n\nSjors Provoost: 00:28:50\n\nThat's probably not too bad.\nBut it gets more exciting than that because 1,983,702 is not the only block where this happens, it was an earlier block where it didn't happen but it could have or it could not have.\n\nAaron van Wirdum: 00:29:06\n\nWait sorry, there was?\n\nSjors Provoost: 00:29:08\n\nThere is block 490,897.\n\nAaron van Wirdum: 00:29:11\n\nAre we talking about the future or the past?\n\nSjors Provoost: 00:29:13\n\nThe past.\n\nAaron van Wirdum: 00:29:14\n\nOkay, what about it?\n\nSjors Provoost: 00:29:15\n\nSo this block was another one of those numbers that if you look at the all the coinbase transactions and you just find what number is in there, there were a couple of numbers in there.\nI think one number was so low like 200,000 it was before BIP34 was activated so it wasn't a problem because it was referring to something in the same era.\nBut the next number was 490,897, which was in October 2017.\nAnd that block, if it wasn't for some lucky circumstances, could have already exposed this bug that we just talked about.\nSo we wouldn't have had 30 years.\nNo, we had two weeks, basically.\nAt least the people who discovered this issue discovered it about two weeks before that block.\n\nAaron van Wirdum: 00:30:01\n\nInteresting.\n\nSjors Provoost: 00:30:01\n\nSo, this is like an asteroid heading toward Earth, and NASA says, \"Oh, we found an asteroid coming toward Earth, but don't worry, it's going to miss us by at least the distance between here and the moon.\"\nIt's fine.\nThe only thing is we found out like two hours ago so if it had not missed us we would be dead and we would not have noticed it.\nSo this is one of those cases where yes, the bug isn't actually harmful, but if it had been harmful, there would have been only two weeks to deal with it.\n\nAaron van Wirdum: 00:30:26\n\nWell, I mean, the bug could have been harmful if someone wants to exploit it.\n\nSjors Provoost: 00:30:31\n\nNo. So basically, by looking at the original transaction, they could see that it was not possible to exploit this.\nAnd the reason is because that coinbase, yes, you could duplicate it, but it was already spent.\nAnd so you then need to reproduce the transactions that spent the coinbase.\nAnd that is impossible because one of those transactions was spending another coinbase.\nAnd that other coinbase had a number in it, it's like 5 billion or some insane number.\nAnd we can never get to block 5 billion, at least not in the current code, right?\nBecause it stops in 2106.\n\nAaron van Wirdum: 00:31:06\n\nI see.\n\nSjors Provoost: 00:31:06\n\nAnd then you have a hard fork.\nSo with a hard fork, you can fix everything basically though.\nAnything after block 6 million or so is you don't have to worry about it.\nSo that was good, but it was a close call.\n\nAaron van Wirdum: 00:31:18\n\nWith a hard fork you can fix anything.\nYou can code shorts on that.\n\nSjors Provoost: 00:31:23\n\nI'm not saying you're not introducing a new problem.\n\nAaron van Wirdum: 00:31:25\n\nAre you pushing for a hard fork?\n\nSjors Provoost: 00:31:27\n\nNo, you can just wait until 2106.\n\nAaron van Wirdum: 00:31:30\n\nAnyways, okay, we had a near miss in 2017.\nThat turned out to not be a real problem.\nNow we got 20 years to either fix this problem or just ignore it because it's kind of already fixed.\nAnything else?\n\nSjors Provoost: 00:31:46\n\nYes, so the fix was shipped in 2018.\nIt just basically says, okay, from this block, gonna check BIP30.\nSo anybody running a modern node doesn't have to worry too much.\nExcept on TestNet.,I think on TestNet, it's already checking BIP30 now.\nBut who cares about TestNet.?\nBecause TestNet had the same kind of problem.\n\nAaron van Wirdum: 00:32:11\n\nYeah.\n\nSjors Provoost: 00:32:12\n\nAnd it was fixed in the same way.\n\nAaron van Wirdum: 00:32:14\n\nOkay.\n\nSjors Provoost: 00:32:14\n\nAnd I think in TestNet there was another block like that in block 2,200,000 or something like that.\n\nAaron van Wirdum: 00:32:21\n\nI don't care about TestNet..\n\nSjors Provoost: 00:32:22\n\nTestnet is already at block 2,500,000.\nSo I think it's already checking BIP30.\n\nAaron van Wirdum: 00:32:26\n\nOkay.\n\nSjors Provoost: 00:32:27\n\nAnd there's a little code comment saying like, \"Oh, I'm sure somebody will fix it before then.\"\n\nAaron van Wirdum: 00:32:32\n\nOh, I was going to ask, are there others?\nSo we got 20 years, are there other solutions?\nLike, is this just it, or do we have other ways out of this conundrum that we find ourselves in?\n\n## Future Proofing Bitcoin Against Similar Issues\n\nSjors Provoost: 00:32:41\n\nSo ideally, you want to have something in every block that we know was not in those blocks before BIP34 activated.\nAnd there's a bunch of candidates that were mentioned back in the day, but one candidate that I saw on Twitter, I think it was Calvin Kim that said it, but I don't know if he came up with it or heard it from somebody else.\nAnd that is to basically make SegWit mandatory.\nAnd why?\nRight now...\n\nAaron van Wirdum: 00:33:14\n\nSegWit for every transaction mandatory?\n\nSjors Provoost: 00:33:16\n\nNo, just say for every block.\n\nAaron van Wirdum: 00:33:18\n\nFor every coinbase transaction?\n\nSjors Provoost: 00:33:21\n\nYes.\nSo every block has to commit to SegWit, has to include the SegWit commitment.\nThe SegWit commitment is an `OP_RETURN` that refers to the tree of SegWit transactions.\n\nAaron van Wirdum: 00:33:30\n\nOh, wait, so are you just, oh.\n\nSjors Provoost: 00:33:33\n\nSo the transactions in the block don't have to be segwit.\n\nAaron van Wirdum: 00:33:36\n\nOh, so what you're saying is there could still be a block mine that has zero segwit transactions.\nBut as soon as there's one segwit transaction in a block, you need the segwit thing in the coinbase and therefore the transaction ID is different.\n\nSjors Provoost: 00:33:48\n\nYeah, and so right now, every time there is a SegWit block, yes, that's happened automatically.\n\nAaron van Wirdum: 00:33:53\n\nOkay, has there been...\n\nSjors Provoost: 00:33:53\n\nBut empty blocks or blocks with no SegWit transactions do not commit to SegWit.\nBut definitely empty blocks don't.\nHowever, they can, they just don't.\nBecause they don't have to.\nSo the change would be to say,\n\nAaron van Wirdum: 00:34:04\n\nLet me ask this question real quick.\nSo, because I was going to ask, has there been any block mined that doesn't include any segwit transactions?\nSince segwit is out and that would be empty blocks.\n\nSjors Provoost: 00:34:16\n\nYes.\n\nAaron van Wirdum: 00:34:16\n\nYeah.\nMakes sense.\nOkay, go on.\n\nSjors Provoost: 00:34:17\n\n\nSo basically, you know, the difficulty then would just be, okay, when you propose an empty block, which you have to do as a miner sometimes, very briefly, just make sure that it's a segwit block.\nSo that would be a fairly simple soft fork.\nBut there are other ideas out there.\n\nAaron van Wirdum: 00:34:35\n\nIt's probably still like, you know, in the sort of Puritan Bitcoin conservative, you know, which is a good philosophy, It's still kind of a cost to miners, which you're imposing on miners, like now they have to do something extra.\nLike it might still be controversial, I don't know.\nWhat do you think?\n\nSjors Provoost: 00:34:54\n\nI don't know if it's a cost to miners because if they use Bitcoin Core to create the block templates, Bitcoin Core would just do it for them.\n\nAaron van Wirdum: 00:35:01\n\nWell, the cost I'm referring to is you have to upgrade your Bitcoin Core node once in a while.\nIt's not backwards compatible is what I'm basically saying.\n\nSjors Provoost: 00:35:10\n\nNot for the miners, no, but that's always true for Soft Forks.\nWell, no, it's not always true for Soft Forks.\nGenerally soft forks are done in such a way that if you only mine standard transactions, then you're going to be fine.\nBut for this case, yes, miners would have to do something, just like they had in the first time it was introduced.\nSo yeah, it's not entirely innocent.\n\nAaron van Wirdum: 00:35:31\n\nIt seems to me like a very plausible or reasonable solution.\nI'm just pointing out that even that might have some pushback.\n\nSjors Provoost: 00:35:37\n\nYeah, and the other solutions have this same, I think, have the same property, is that every miner would have to do it, or they might lose a block if they mine an empty block.\nSo I think another one was, okay, we just add the block height again, but we add it to a different field, like the lock time of the coinbase transaction.\n\nAaron van Wirdum: 00:35:54\n\nBecause lock time wasn't activated back in?\n\nSjors Provoost: 00:35:57\n\nLock time wasn't used.\nAs far as I know, again, you'd have to run a script and check.\n\nAaron van Wirdum: 00:36:01\n\nWell, LockTime was introduced in 2015, right?\n\nSjors Provoost: 00:36:05\n\nIt's possible, but the field might, the field with the numbers were there.\nThey didn't have any meaning, right?\nSo you still have to check that they weren't used.\nBut that's easy.\nI think this SegWit thing is the simplest one.\nThe other option is we can buy ourselves another 20 years or so to block 3,808,179.\n\nAaron van Wirdum: 00:36:27\n\nHow?\n\nSjors Provoost: 00:36:27\n\nWell, we would have to very carefully study block 1,983,702.\nWell not this block, but the original block that created it.\nAnd that coinbase has been spent so it can already be recreated but you have to look at all the descendants.\nSo this thing was spent to like around 10 different addresses and those could spend and those could spend.\nAnd if you can show that for every transaction descending from it, it was also using a coinbase transaction that cannot be duplicated, maybe you can prove that it, you know, you could write a proof that it can never happen, gives you another 20 years.\nI think that's a stupid exercise compared to the simple soft fork.\n\nAaron van Wirdum: 00:37:04\n\nWell, you didn't figure it out for this podcast, if that's the case or not?\n\nSjors Provoost: 00:37:07\n\nI did ask it on Stack Overflow in a comment somewhere, but no, I did not.\n\nAaron van Wirdum: 00:37:11\n\nSure, do you even do?\nWhat do you do for this podcast?\n\n\nSjors Provoost: 00:37:16\n\nNothing.\nMoving on.\nI did actually run a script to check that there are no `OP_RETURN` transactions before BIP324 activated.\n\nAaron van Wirdum: 00:37:26\n\nWait, sorry, can you repeat that just for me?\n\nSjors Provoost: 00:37:28\n\nThere were no `OP_RETURN` transactions in the coinbase before BIP324 activated.\n\nAaron van Wirdum: 00:37:33\n\nYou did actually check that?\n\nSjors Provoost: 00:37:35\n\nYes.\n\nAaron van Wirdum: 00:37:35\n\nOkay.\n\nSjors Provoost: 00:37:35\n\nWhich means that you don't even have to commit to SegWit; you just have to put `OP_RETURN` in a coinbase transaction.\nThat will be the rule.\nBut of course, it's easier to just say SegWit.\n\nAaron van Wirdum: 00:37:46\n\nOkay.\nSo far, I think we agree SegWit is the most reasonable, low effort kind of way of doing this.\nI guess you could do Taproot as well, maybe, or no?\nDoes it make sense?\nNo, just SegWit.\nI'm just thinking out loud.\n\nSjors Provoost: 00:38:00\n\nYou want to keep it simple?\nSo the funny thing is there was in 2019 a proposal...\n\nAaron van Wirdum: 00:38:04\n\nI'm just thinking of soft forks that were introduced after 2015 to make me sound smart.\nBut yeah, SegWit is the obvious thing here.\nGo on.\n\nSjors Provoost: 00:38:12\n\nYeah, so there was a great consensus cleanup proposal back in 2019 by Matt Corallo, BlueMatt, which contained a bunch of these very small fixes, kind of similar to this one, but not actually this one.\n\nAaron van Wirdum: 00:38:27\n\nA fix for this specific problem?\n\nSjors Provoost: 00:38:29\n\nYeah, it was not in there.\n\nAaron van Wirdum: 00:38:31\n\nSo why do you even bring it up?\n\nSjors Provoost: 00:38:33\n\nBecause I was curious whether the great consensus cleanup would clean this up.\n\nAaron van Wirdum: 00:38:36\n\nRight, and it doesn't.\n\nSjors Provoost: 00:38:38\n\nBut it would if you were to revive that proposal you should clean this up too.\n\nAaron van Wirdum: 00:38:42\n\nOkay.\n\nSjors Provoost: 00:38:42\n\nBecause it also fixes the time warp attack and other things that we've discussed in other episodes.\n\nAaron van Wirdum: 00:38:47\n\nSure, yeah.\nOkay.\n\nSjors Provoost: 00:38:51\n\nThat's all I have.\n\nAaron van Wirdum: 00:38:52\n\nYeah, well, I mean, sounds to me like SegWit is the easy way to go, and also...\n\nSjors Provoost: 00:38:57\n\nWe have a few decades to figure this out.\n\nAaron van Wirdum: 00:39:00\n\nWe can think about it a while.\nAll right, thanks, Sjors.\n\nSjors Provoost: 00:39:02\n\nAll right and thank you for listening to Bitcoin.\n\nAaron van Wirdum: 00:39:05\n\nExplained.\n\n",
    "body_type": "markdown",
    "created_at": "2023-12-21T00:00:00.000Z",
    "domain": "https://btctranscripts.com/",
    "url": "https://btctranscripts.com/bitcoin-explained/the-block-1-983-702-problem",
    "categories": [
        "podcast"
    ],
    "tags": [
        "bitcoin-core",
        "security-problems"
    ],
    "media": "https://bitcoinexplainedpodcast.com/@nado/episodes/episode-87-the-block-1-983-702-problem-s7s3j",
    "authors": [
        "Sjors Provoost",
        "Aaron van Wirdum"
    ],
    "indexed_at": "2024-03-21T16:33:36.175Z",
    "transcript_by": "sahil-tgs via review.btctranscripts.com",
    "summary": "In a profound exploration on the \"Bitcoin Explained\" podcast, Sjors Provoost and Aaron van Wirdum tackled the nuanced and complex issue known as the \"1,983,702\" problem within Bitcoin's framework. Their discussion illuminated the intricacies of blockchain technology, unraveling how historical bugs and the potential for consensus failure pose challenges to Bitcoin's robustness and reliability. The dialogue commenced with an examination of a bug originating from Satoshi Nakamoto\u2019s original code, which allowed for the duplication of transaction identifiers under specific circumstances. This revelation shed light on the early vulnerabilities of Bitcoin's protocol and set the stage for a deeper dive into the protocol's evolution and efforts to fortify its security.\n\nProvoost and van Wirdum navigated through the technical landscape of Bitcoin, discussing the implications of such vulnerabilities on the network's integrity. They highlighted how these issues, particularly the duplication of coinbase transactions, underscored the risks inherent in the blockchain's design. The introduction of BIP30 and BIP34 was pivotal in addressing these concerns, showcasing the community's proactive measures to prevent consensus failure and ensure transaction uniqueness. Their conversation elucidated the technical solutions adopted over time to enhance Bitcoin's efficiency and security, reflecting on the continuous evolution of blockchain protocols.\n\nThe discussion took a critical turn when addressing the attempted optimization in 2015, which inadvertently reintroduced potential vulnerabilities by forgoing checks for BIP30 compliance. This oversight highlighted the delicate balance between striving for efficiency and maintaining the network's security. The eventual realization of this vulnerability led to reinstating specific protocol checks, demonstrating the community's agility in responding to unforeseen challenges. This episode served as a testament to the importance of vigilance and the readiness to reassess and adjust past decisions to preserve the network's integrity.\n\nFurther delving into the realm of potential solutions, Provoost and van Wirdum discussed innovative approaches to safeguard Bitcoin against similar vulnerabilities. The suggestion by Calvin Kim to make SegWit mandatory emerged as a compelling solution, leveraging its unique identifier capabilities to prevent transaction duplication. This proposal not only underscored the simplicity and effectiveness of leveraging existing mechanisms but also highlighted the ongoing efforts within the community to anticipate and mitigate risks, ensuring the resilience of Bitcoin's network.\n\nIn conclusion, the dialogue between Provoost and van Wirdum transcended a mere technical discussion, offering insights into the collaborative spirit driving Bitcoin's development. Their exploration into the \"1,983,702\" problem and potential vulnerabilities within Bitcoin's protocol reflected a broader narrative about the iterative path to perfection in decentralized technologies. By highlighting the community's commitment to securing and optimizing the network, their conversation underscored the importance of continuous improvement and the collective effort required to navigate the complexities of blockchain technology."
}