{
    "id": "bitcointranscripts+bitcoin-explained+sync-bitcoin-faster-assume-utxo",
    "title": "Sync Bitcoin Faster! Assume UTXO",
    "body_formatted": "{\"type\":\"heading\",\"text\":\"Introduction\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Sjors, this week we are going to create a carbon copy of the Chaincode Podcast.\\nThey had an episode with James O\u2019Beirne on AssumeUTXO, and we are going to make an episode on AssumeUTXO.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"And we are going to follow roughly the same structure.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"We're just going to create the same podcast, just with our voices this time.\\nWe're gonna do it step by step.\\nFirst step is, Headers First.\\nThat's how they did it, so that's how we're going to do it.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nAnd by first step you mean we're going to go back in time and look at some improvements on how to download the blockchain quickly and safely?\"}, {\"type\":\"heading\",\"text\":\"The Problem of Syncing a Bitcoin Node: Headers First\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nThat's basically the problem that we're solving here.\\nWell, not you and me.\\nWell, maybe you a bit, but definitely not me, but its the problem of syncing.\\nSo when you turn on your Bitcoin Core node, then the first thing your node's got to do is...\\nWell, other than connect to the network which we discussed last week.\\nThen the next thing is it needs to be able to communicate with the network.\\nIt needs to download the blockchain.\\nIt needs to be aware of the state of the network, basically.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So the most naive way to do that would be to say to other peers, just give me everything you've got.\\nAnd then you get gigabytes and gigabytes and gigabytes and terabytes of blocks and headers and random stuff.\\nAnd your hard disk is full and you crash.\\nSo that's not the right way to do it.\\nSo I think the initial version of Bitcoin before it was even called Bitcoin Core, it would just ask nodes for a header and then it got a header and it would ask nodes for a block and it would get that block.\\nAnd it would ask for the next header and it would just sequentially get all the header, sequentially, get all the blocks.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"One header at a time followed by the same block one at a time.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, I think so.\\nI might be wrong on this, but it doesn't really matter for what we're about to explain.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So what the problem with that?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Well, the problem with that is you don't know if you're following a dead end.\\nSo I might be...\\nWe all know there's a lot of blocks out there but I could give you...\\nWhen you start syncing I could give you the first block and then I could just mine the second block and the third block myself at a very low difficulty.\\nSo I could just keep the Bitcoin difficulty at one and just buying a chain with a million blocks in it.\\nAnd I would give them to you one by one by one by one, and you would check it and you'd be happy and you would check it and you'd be happy.\\nAnd I would send you megabyte size blocks or even bigger with all the secret stuff in it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Sure.\\nJust to be clear, even though the difficult is low, that doesn't make it any easier for my nodes to verify the transactions?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"It's still going to cost a lot of computational power?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So it's very cheap for me to generate a fake chain with very low difficulty.\\nAnd I can just keep you busy for a long time.\\nSo one way to get rid of that problem is first ask for headers not the entire block, but just headers.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Just to be clear, this isn't really a problem in itself? Because in the end I would still, as a new node compare blockchains, and then pick the one with the most difficulty.\\nIt's just you need to verify all of the chains first before would make the pick? That's the problem here.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"But I could turn on Amazon and give you a million chains like that.\\nSo it would be very hard for you to find the real one.\\nSo the idea then is you download the headers instead.\\nSo headers are a lot smaller.\\nSo I can give you a bunch of nonsense there, but you can quickly shop between headers and see the total difficulty in it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nSo instead of downloading and verifying all the chains and then picking the one with the most proof of work, I'm first checking out, which chain has got most proof of work.\\nSo I'm basically inverting it, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yes, exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"And then the one with the most proof of work, that's the one I'm actually going to validate.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nBecause so far you just have SPV security.\\nSo you just know which one has the most proof of work, but it could be invalid.\\nSo in that case, you start downloading one block at a time.\\nOr in fact, because you already have all the headers, you can download lots of blocks at the same time, from different nodes in parallel.\\nBut you have to verify them in sequence.\\nAnd then if you run into an invalid block, okay, then you say this header chain might have the most proof of work, but it's not valid.\\nSo I'm going to go to this second most proof of work header chain and ask for the blocks.\\nIt's mostly going to be the same maybe except the last few.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"You mentioned SPV security very briefly.\\nTechnically that would be possible, right? Even though Bitcoin Core doesn't do that right now.\\nIt would be possible to bootstrap your nodes get started with SPV security at first.\\nAnd then only after you're done validating all of the blocks you got full security?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, no, you could, you could.\\nBut I don't think you would know your transaction history because you do need the blocks for that.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"But you would still have SPV security and there was a proposal to implement something like this in Bitcoin Core a while ago.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, I think so this was by Jonas Schnelli, I think four or five years ago, an attempt to at least start up in SPV mode.\\nAnd then I guess if you create a new address from scratch, then you know it's history.\\nSo then when the next block comes in and you see a transaction to that address, then you know that you have a balance.\\nYou can't rescan any old addresses, but you can see anything new that comes in.\\nBecause you're going to download all the real blocks after yeah.\\nStarting at the present basically.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"You're at least sure that more miners think it's a valid transaction or at least they're spending hash power telling you it's a valid transaction.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So even though you don't have full security, it's a little bit better than nothing.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nAnd of course it's definitely enough to receive it.\\nAnd then just to assume that it's fake, but you can just sit on it for a while.\\nBut in the meantime you would be validating all the older blocks.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nBut just to be clear, Bitcoin Core doesn't do this right now.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"No, it doesn't.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Right now it's just a trick to avoid having to download all of these fake chains potentially instead only download the chain that has the most proof of work.\\nThat's that's what Headers First is?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\"}, {\"type\":\"heading\",\"text\":\"Assume Valid\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Now next step.\\nSo there's a thing called Assume Valid.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"That's right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"What is Assume Valid?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So Assume Valid is a block hash that is encoded in the software.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Just to be clear, this is actually in Bitcoin Core today?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nIt's been there for a few years.\\nSo it, it is a hash of a recent block as in recent, before the release.\\nAnd a lot of the different Bitcoin Core developers and anybody else who is on Github can see what that hash is.\\nAnd they can check for themselves whether that hash is real.\\nAnd if you're a new user and you start a Bitcoin Core, it's going to sync all the headers, it's going to get all the blocks.\\nAnd if that particular hash is in the chain, then it will not verify the signatures.\\nSo it's not a checkpoint.\\nThe hash does not have to be out there.\\nBut if it's out there, you don't verify any of the signatures up to that point.\\nSo it's a lot it faster to sync that way.\\nOr a lot less slow, I would say.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Do you still download the signatures?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You download everything.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"You download everything?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"The whole blockchain.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So its just a shortcut for syncing is that you do not verify the signatures up until that point?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So what you are doing is you're still checking the proof of work.\\nYou're still checking that miners actually produce the blocks by expending energy.\\nAnd you're checking that it is the longest chain.\\nAnd you're also checking all of the transactions in order to construct the UTXO set, which is the current state of balances.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nMoney cannot come out of nowhere basically.\\nSo you check all that stuff, but you do not check the signatures.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So you're not checking that the valid owner of each coin in any part of history was actually the correct owner.\\nFor that you're trusting essentially on the miners, as well as on the developers side.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You're fully trusting the developers.\\nWell, you're trusting that the developers, if they were to put in something that's not real, somebody would notice that.\\nBecause you can see this source code and it's just one line.\\nAnd if that has a hash in it that doesn't exist, well, then you should be worried.\\nAnd it would be quite weird even then, because it would have to be a chain with more proof of work.\\nOtherwise you would never see it.\\nSo some evil developer would have to produce a chain with more proof of work than the real thing in order to trick some future user, but risk everybody noticing it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nWell that's why I mentioned also the miners.\\nLike you still got to produce the proof of work, right?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, exactly.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So why Sjors would we trust guys like you?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You don't.\\nI mean the saying is: don't trust, verify.\\nBut you're relying on that, somebody's done that.\\nBecause don't forget that you're still downloading piece of software from the internet.\\nWhich could have a line of code in there that says, just send all the Bitcoins to me.\\nSo you have to check for sneaky things by the developers in general.\\nBut that particular sneaky thing would be extremely easy to see.\\nBecause it's one place in the code base that has a hash in it and everybody can reproduce it.\\nAnd if you don't like this and you don't have to like this, you start Bitcoin from scratch with dash assume valid is zero.\\nAnd then it will validate all the signatures.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\\nThat's just what I was about to ask.\\nIf you don't want to put this trust in developers, you can still do it yourself?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nBut keep in mind, so you're not putting that particular piece of trust in the developers, but you still download the binary file from the internet.\\nSo you are putting trust in the developers.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"I mean, that depends, right.\\nYou could check the source code if you really wanted to, and then...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yes, you should, and then you see this hash.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Compile into binaries if you want to.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You can do that and then you'll see this hash and you trust that part of the source code isn't sneaky.\\nBecause you can look at the source code, but there could be some really sneaky obscure C plus plus code in there that you have no idea what it's doing and it's stealing your coins.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"You're underestimating my ability to check for very sneaky C plus plus source code.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Well, that's great.\\nWe need more people like you to make sure that doesn't happen.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"I wish that was true.\\nSo this is actually in Bitcoin Core and its been in Bitcoin Core for a while.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah, I think a couple years.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"And apparently everyone's comfortable enough with this.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"I don't know.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Looks like it.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"And I don't know if people use the feature.\\nThey might turn it off.\"}, {\"type\":\"heading\",\"text\":\"Assume UTXO\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So now a newer idea, which is based on Assume Valid is James O'Beirne's AssumeUTXO.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So what is the difference? What is AssumeUTXO then?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Well here, the UTXO set, as we've said a couple times is the collection of coins that exist right now.\\nSo every time you send somebody money that creates a UTXO and it destroys the UTXO that you send from.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"It's the current state of balances is how I generally call it.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nAlthough, yeah...\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nI know.\\nTechnically, you object to the term balances.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Well, because balance is something you can add and subtract to, but these UTXOs are destroyed all the time.\\nSo it's like you have a bank account and the bank account is destroyed when you use it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Sure.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"But in general, the idea is that every time...\\nThe only way you can reconstruct the UTXO set.\\nSo the only way and find out which coins exist right now is to replay everything from scratch.\\nSo you have to take the first block, see which coins it creates, which coins it destroys.\\nThen the second block, see which coins it destroys, which coins it creates, et cetera, et cetera, et cetera, et cetera.\\nAnd that takes a long time and you can only do it sequentially.\\nYou have to start at the beginning.\\nYou have to go to the end.\\nYou cannot do it in parallel because you don't know if block 100 hundred thousand.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You don't know if it's valid because you need to know what coins existed at one block before it.\\nSo this is annoying because it takes a long ass time to sync the whole blockchain.\\nSo what AssumeUTXO does, is it takes a snapshot of this UTXO set at a certain height, maybe just before the release or a bit older.\\nAnd then when your node starts, it starts from that point.\\nSo it skips...\\nInitially skips the whole history.\\nIt starts from this snapshot and then it just checks the next block and the next block and the next block and the next block until it reaches the tip, the most recent block.\\nSo then you know exactly your balances and you can start using it.\\nBut in the meantime, in the background, it starts at the Genesis block, goes all the way to the snapshot and make sure that the snapshot is correct.\\nAnd if the snapshot is not correct, it starts screaming.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"I'm assuming it still does the Headers First syncing, right? First it checks out which chain is the longest one.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"In fact it has to, because in order to load the snapshot, it must already have the headers at that point.\\nSo it has to have the headers up until the snapshot before it can even load the snapshot.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nAnd then with Assume Valid, it still did all of the UTXO set constructing.\\nIt still replayed all of the transactions.\\nIt just didn't check for the signatures.\\nIt just skipped its signature validation.\\nAnd now with AssumeUTXO, at least initially it skips all of it.\\nIt skips the transaction replaying as well as obviously, then also the signature checking.\\nSo just takes the UTXO set and from there on out constructs, the blockchain based on the newer blocks that have been found since then.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Exactly.\\nAnd so you're back to where everything started.\\nAs soon as that backlog checking has been done, then you're basically at the same trust as you are now.\\nHowever you could...\\nAnd this gets into trade offs.\\nLike, do you really want to check all the history? Because there are a lot of things you can know without checking history.\\nSo there's no plan right now to not check history because that's still a bit controversial.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"You mean check history after...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Before the snapshot.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nYou basically check the snapshot.\\nThen you check what have happened since the snapshot and once you've constructed the current version of the UTXO set and the current version of the blockchain.\\nThen you go back to block number one and start to check if your assumption of the UTXO set was actually correct.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"That's right.\\nAnd so the question is, could you eventually in the future opt out of doing that? And what are you sacrificing when you do that? And well, some things you're not sacrificing.\\nSo the nice thing is if you start at the snapshot and you create a new address and you receive coins on it and they get into a block, then you kind of know that block is valid.\\nAt least unless there's another chain out there because otherwise like a lot of miners are wasting a lot of proof of work on a chain that's not valid.\\nWhich could be true.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Which could be true.\\nWhich is a trade off.\\nYou're trusting that miners are being honest there, you're trusting that they're not burning resources just to screw with you.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Not screw with you, screw with everyone.\\nBut there could be some conspiracy where the snapshot is fake and the core developers and the miners collude and create a fake snapshot that has a couple of extra coins in it that all the miners agree that they will approve blocks with that coin in it.\\nSo you could sneak in a hard fork.\\nThat's the scary thing about it, which is why, again, you need people to check whether the snapshot is real.\\nYou can either do it yourself with this back validation or you can go in and...\\nOr you can rely on the fact that other people are looking at the source code and see this one particular line, which if it contains something ridiculous, there's a problem.\\nAnd again, the same story with the headers, that still need to match.\\nSo somebody would have to spend a whole lot of proof of work and get sneaked that fake snapshot in.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So this is not included in Bitcoin Core right now?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"No, in fact, all of this is quite new.\\nSo I think the current version of Bitcoin Core has a way to create a snapshot.\\nBut there's nothing you can do with that snapshot.\\nAnd then not the version that's coming out now, but the version that might come out like early next year should have a way to...\\nProbably will have a way to load a snapshot.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"What does load a snapshot mean?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So this UTXO snapshot, the set of coins is a couple gigabytes and the only way you can get it is to download it from someone.\\nIt's not included in the source code and there's no way to serve it over the peer-to-peer network yet.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"The only thing that's included in the source code would be the hash of the UTXO set? Not the UTXO set itself because it's too big.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Right.\\nAnd so initially, maybe that UTXO set is just a torrent that people can host.\\nIt's very easy to check a torrent, because it also has a hash.\\nOr one use case for that could be say, if you're running a BTCPay server, if you're spinning that up for the first time, it's really, really time consuming to have to download the entire blockchain.\\nBut then you probably want to skip validation of the older stuff.\\nBecause if you're running that server you're probably also running a node somewhere else.\\nSo you can still compare that, that you're actually looking at the same chain.\\nSo that could be a good use case for it.\\nAnd then it's nice that the BTCPay server thing just downloads the three gigabyte file and then starts syncing from there, save you like two weeks.\\nBecause all these web servers that are incredibly slow.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"So right now, Bitcoin Core can make snapshot of a UTXO set, but it doesn't actually do anything with it?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yep.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Then in an upcoming release it's going to be able to download UTXO set?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"No it's going to be able to load a UTXO set that you downloaded.\\nSomewhere.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"And then maybe in the future version after that, then it's going to complete the package and you might have something called Assume UTXO in Bitcoin Core.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"One way such a future could look is the nodes.\\nEvery node that wants to would serve this snapshot.\\nProbably not automatically because it's pretty big.\\nIt's like couple gigabytes.\\nBut any node that wants to could serve the snapshot and then there's a peer-to-peer protocol to download the snapshot automatically.\\nAnd so when you start a new node, it would automatically find the snapshot, use the snapshot, sync to the tip, show you some orange blinking thing, probably.\\nAnd then sync from the start to the snapshot and then show you a nice green blinking thing.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Is this controversial at all? The fact that there are some trade offs there, some security trade offs.\\nEven though they're small and temporary, they're there.\\nDo you think this is controversial at all?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"I don't know.\\nI mean, usually with this kind of features, first of all, it's experimental.\\nSo that means you probably need to do something to turn it on.\\nMy guess is, once it's done to the point that I just described, it's probably still going to be off the first time.\\nAnd then if people start objecting to it or not, that's sort of the thing you need to see.\\nI mean, something is controversial when people decide it's controversial.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"But that hasn't been decided yet then?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Not that I know, but there's only a handful of people who actually grasp this feature.\\nSo it might be a bit early.\\nIn the longer run something that's been an ongoing discussion for ages is the idea of committing to the UTXO set inside the blockchain itself, a UTXO commitment.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"I've heard of that.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"That certainly is controversial.\\nI don't think...\\nI don't know if anybody is opposed to it in principle, but it's certainly controversial depending on how you do it.\\nBecause what you want to prevent is sort of the scenarios we discussed before, right? The scenario where the blockchain is too big to check for everybody and then a bunch of miners and developers decide to give themselves some coins and they get away with it.\\nBecause not enough people verify the entire history.\\nSo that's a risky part of it.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"How would that work with embedding? Sorry, it's embedding the UTXO set into the blocks?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"You're not embedding it.\\nYou're embedding a hash into the block.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Sure.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So every block would contain, I guess in the coinbase transaction a hash of the UTXO set or some other derived thing of the UTXO set.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"What's the benefit of that?\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Well then instead of relying on what's in the source code, this hash, you would rely on what's in the blockchain, this hash.\\nThat's I guess, you make it part of consensus and a block is not valid if the hash is not valid.\\nSo you would reject blocks that have an invalid hash rather than reject code that looks fishy.\\nI think it's a different thing, but there are quite...\\nThere are very different ways that you can put stuff in a block.\\nIt could be straightforward as a hash, but it could also be something a little bit more indirect, something that if you know...\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"So if you look at the block and you see this number, you do not know the UTXO set and you can't download the UTXO set using that information.\\nBut instead you have to download...\\nYou have to process the whole blockchain from the Genesis block to make sure that that thing in the blockchain is valid.\\nBut then the question is what is use going to be? There's some tricky trade ups there.\\nYou should ask Peter Todd at some point, because he's thought about that stuff a bit more.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"At some point I will.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"All right.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"We've gone off the rails.\\nBut I think we covered everything.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Yeah.\\nIn general, it's one thing that people complain about when they hear about Bitcoin Core.\\nIts like, \\\"Oh my God, I need to download the whole blockchain.\\\" And then you get this tradeovers do you want people to just put up with that? Do you want to make it slightly less annoying?\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Yes.\\nAt a trade off.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"And then the smallest possible trade off.\\nSo I think this is a very interesting project, so I'm happy to test it.\\nThat's usually what I do.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"Good.\"}, {\"type\":\"paragraph\",\"text\":\"Sjors Provoost:\"}, {\"type\":\"paragraph\",\"text\":\"Test it.\\nTry to break something and then complain or get up.\"}, {\"type\":\"paragraph\",\"text\":\"Aaron van Wirdum:\"}, {\"type\":\"paragraph\",\"text\":\"All right.\"}",
    "body": "## Introduction\n\nAaron van Wirdum:\n\nSjors, this week we are going to create a carbon copy of the Chaincode Podcast.\nThey had an episode with James O\u2019Beirne on AssumeUTXO, and we are going to make an episode on AssumeUTXO.\n\nSjors Provoost:\n\nAnd we are going to follow roughly the same structure.\n\nAaron van Wirdum:\n\nWe're just going to create the same podcast, just with our voices this time.\nWe're gonna do it step by step.\nFirst step is, Headers First.\nThat's how they did it, so that's how we're going to do it.\n\nSjors Provoost:\n\nRight.\nAnd by first step you mean we're going to go back in time and look at some improvements on how to download the blockchain quickly and safely?\n\n## The Problem of Syncing a Bitcoin Node: Headers First\n\nAaron van Wirdum:\n\nYeah.\nThat's basically the problem that we're solving here.\nWell, not you and me.\nWell, maybe you a bit, but definitely not me, but its the problem of syncing.\nSo when you turn on your Bitcoin Core node, then the first thing your node's got to do is...\nWell, other than connect to the network which we discussed last week.\nThen the next thing is it needs to be able to communicate with the network.\nIt needs to download the blockchain.\nIt needs to be aware of the state of the network, basically.\n\nSjors Provoost:\n\nSo the most naive way to do that would be to say to other peers, just give me everything you've got.\nAnd then you get gigabytes and gigabytes and gigabytes and terabytes of blocks and headers and random stuff.\nAnd your hard disk is full and you crash.\nSo that's not the right way to do it.\nSo I think the initial version of Bitcoin before it was even called Bitcoin Core, it would just ask nodes for a header and then it got a header and it would ask nodes for a block and it would get that block.\nAnd it would ask for the next header and it would just sequentially get all the header, sequentially, get all the blocks.\n\nAaron van Wirdum:\n\nOne header at a time followed by the same block one at a time.\n\nSjors Provoost:\n\nYeah, I think so.\nI might be wrong on this, but it doesn't really matter for what we're about to explain.\n\nAaron van Wirdum:\n\nSo what the problem with that?\n\nSjors Provoost:\n\nWell, the problem with that is you don't know if you're following a dead end.\nSo I might be...\nWe all know there's a lot of blocks out there but I could give you...\nWhen you start syncing I could give you the first block and then I could just mine the second block and the third block myself at a very low difficulty.\nSo I could just keep the Bitcoin difficulty at one and just buying a chain with a million blocks in it.\nAnd I would give them to you one by one by one by one, and you would check it and you'd be happy and you would check it and you'd be happy.\nAnd I would send you megabyte size blocks or even bigger with all the secret stuff in it.\n\nAaron van Wirdum:\n\nSure.\nJust to be clear, even though the difficult is low, that doesn't make it any easier for my nodes to verify the transactions?\n\nSjors Provoost:\n\nExactly.\n\nAaron van Wirdum:\n\nIt's still going to cost a lot of computational power?\n\nSjors Provoost:\n\nSo it's very cheap for me to generate a fake chain with very low difficulty.\nAnd I can just keep you busy for a long time.\nSo one way to get rid of that problem is first ask for headers not the entire block, but just headers.\n\nAaron van Wirdum:\n\nJust to be clear, this isn't really a problem in itself? Because in the end I would still, as a new node compare blockchains, and then pick the one with the most difficulty.\nIt's just you need to verify all of the chains first before would make the pick? That's the problem here.\n\nSjors Provoost:\n\nBut I could turn on Amazon and give you a million chains like that.\nSo it would be very hard for you to find the real one.\nSo the idea then is you download the headers instead.\nSo headers are a lot smaller.\nSo I can give you a bunch of nonsense there, but you can quickly shop between headers and see the total difficulty in it.\n\nAaron van Wirdum:\n\nRight.\nSo instead of downloading and verifying all the chains and then picking the one with the most proof of work, I'm first checking out, which chain has got most proof of work.\nSo I'm basically inverting it, right?\n\nSjors Provoost:\n\nYes, exactly.\n\nAaron van Wirdum:\n\nAnd then the one with the most proof of work, that's the one I'm actually going to validate.\n\nSjors Provoost:\n\nRight.\nBecause so far you just have SPV security.\nSo you just know which one has the most proof of work, but it could be invalid.\nSo in that case, you start downloading one block at a time.\nOr in fact, because you already have all the headers, you can download lots of blocks at the same time, from different nodes in parallel.\nBut you have to verify them in sequence.\nAnd then if you run into an invalid block, okay, then you say this header chain might have the most proof of work, but it's not valid.\nSo I'm going to go to this second most proof of work header chain and ask for the blocks.\nIt's mostly going to be the same maybe except the last few.\n\nAaron van Wirdum:\n\nYou mentioned SPV security very briefly.\nTechnically that would be possible, right? Even though Bitcoin Core doesn't do that right now.\nIt would be possible to bootstrap your nodes get started with SPV security at first.\nAnd then only after you're done validating all of the blocks you got full security?\n\nSjors Provoost:\n\nYeah, no, you could, you could.\nBut I don't think you would know your transaction history because you do need the blocks for that.\n\nAaron van Wirdum:\n\nBut you would still have SPV security and there was a proposal to implement something like this in Bitcoin Core a while ago.\n\nSjors Provoost:\n\nYeah, I think so this was by Jonas Schnelli, I think four or five years ago, an attempt to at least start up in SPV mode.\nAnd then I guess if you create a new address from scratch, then you know it's history.\nSo then when the next block comes in and you see a transaction to that address, then you know that you have a balance.\nYou can't rescan any old addresses, but you can see anything new that comes in.\nBecause you're going to download all the real blocks after yeah.\nStarting at the present basically.\n\nAaron van Wirdum:\n\nYou're at least sure that more miners think it's a valid transaction or at least they're spending hash power telling you it's a valid transaction.\n\nSjors Provoost:\n\nYes.\n\nAaron van Wirdum:\n\nSo even though you don't have full security, it's a little bit better than nothing.\n\nSjors Provoost:\n\nRight.\nAnd of course it's definitely enough to receive it.\nAnd then just to assume that it's fake, but you can just sit on it for a while.\nBut in the meantime you would be validating all the older blocks.\n\nAaron van Wirdum:\n\nYeah.\nBut just to be clear, Bitcoin Core doesn't do this right now.\n\nSjors Provoost:\n\nNo, it doesn't.\n\nAaron van Wirdum:\n\nRight now it's just a trick to avoid having to download all of these fake chains potentially instead only download the chain that has the most proof of work.\nThat's that's what Headers First is?\n\nSjors Provoost:\n\nYeah.\n\n## Assume Valid\n\nAaron van Wirdum:\n\nNow next step.\nSo there's a thing called Assume Valid.\n\nSjors Provoost:\n\nThat's right.\n\nAaron van Wirdum:\n\nWhat is Assume Valid?\n\nSjors Provoost:\n\nSo Assume Valid is a block hash that is encoded in the software.\n\nAaron van Wirdum:\n\nJust to be clear, this is actually in Bitcoin Core today?\n\nSjors Provoost:\n\nYes.\nIt's been there for a few years.\nSo it, it is a hash of a recent block as in recent, before the release.\nAnd a lot of the different Bitcoin Core developers and anybody else who is on Github can see what that hash is.\nAnd they can check for themselves whether that hash is real.\nAnd if you're a new user and you start a Bitcoin Core, it's going to sync all the headers, it's going to get all the blocks.\nAnd if that particular hash is in the chain, then it will not verify the signatures.\nSo it's not a checkpoint.\nThe hash does not have to be out there.\nBut if it's out there, you don't verify any of the signatures up to that point.\nSo it's a lot it faster to sync that way.\nOr a lot less slow, I would say.\n\nAaron van Wirdum:\n\nDo you still download the signatures?\n\nSjors Provoost:\n\nYou download everything.\n\nAaron van Wirdum:\n\nYou download everything?\n\nSjors Provoost:\n\nThe whole blockchain.\n\nAaron van Wirdum:\n\nSo its just a shortcut for syncing is that you do not verify the signatures up until that point?\n\nSjors Provoost:\n\nExactly.\n\nAaron van Wirdum:\n\nSo what you are doing is you're still checking the proof of work.\nYou're still checking that miners actually produce the blocks by expending energy.\nAnd you're checking that it is the longest chain.\nAnd you're also checking all of the transactions in order to construct the UTXO set, which is the current state of balances.\n\nSjors Provoost:\n\nRight.\nMoney cannot come out of nowhere basically.\nSo you check all that stuff, but you do not check the signatures.\n\nAaron van Wirdum:\n\nSo you're not checking that the valid owner of each coin in any part of history was actually the correct owner.\nFor that you're trusting essentially on the miners, as well as on the developers side.\n\nSjors Provoost:\n\nYou're fully trusting the developers.\nWell, you're trusting that the developers, if they were to put in something that's not real, somebody would notice that.\nBecause you can see this source code and it's just one line.\nAnd if that has a hash in it that doesn't exist, well, then you should be worried.\nAnd it would be quite weird even then, because it would have to be a chain with more proof of work.\nOtherwise you would never see it.\nSo some evil developer would have to produce a chain with more proof of work than the real thing in order to trick some future user, but risk everybody noticing it.\n\nAaron van Wirdum:\n\nYes.\nWell that's why I mentioned also the miners.\nLike you still got to produce the proof of work, right?\n\nSjors Provoost:\n\nYeah, exactly.\n\nAaron van Wirdum:\n\nSo why Sjors would we trust guys like you?\n\nSjors Provoost:\n\nYou don't.\nI mean the saying is: don't trust, verify.\nBut you're relying on that, somebody's done that.\nBecause don't forget that you're still downloading piece of software from the internet.\nWhich could have a line of code in there that says, just send all the Bitcoins to me.\nSo you have to check for sneaky things by the developers in general.\nBut that particular sneaky thing would be extremely easy to see.\nBecause it's one place in the code base that has a hash in it and everybody can reproduce it.\nAnd if you don't like this and you don't have to like this, you start Bitcoin from scratch with dash assume valid is zero.\nAnd then it will validate all the signatures.\n\nAaron van Wirdum:\n\nExactly.\nThat's just what I was about to ask.\nIf you don't want to put this trust in developers, you can still do it yourself?\n\nSjors Provoost:\n\nYeah.\nBut keep in mind, so you're not putting that particular piece of trust in the developers, but you still download the binary file from the internet.\nSo you are putting trust in the developers.\n\nAaron van Wirdum:\n\nI mean, that depends, right.\nYou could check the source code if you really wanted to, and then...\n\nSjors Provoost:\n\nYes, you should, and then you see this hash.\n\nAaron van Wirdum:\n\nCompile into binaries if you want to.\n\nSjors Provoost:\n\nYou can do that and then you'll see this hash and you trust that part of the source code isn't sneaky.\nBecause you can look at the source code, but there could be some really sneaky obscure C plus plus code in there that you have no idea what it's doing and it's stealing your coins.\n\nAaron van Wirdum:\n\nYou're underestimating my ability to check for very sneaky C plus plus source code.\n\nSjors Provoost:\n\nWell, that's great.\nWe need more people like you to make sure that doesn't happen.\n\nAaron van Wirdum:\n\nI wish that was true.\nSo this is actually in Bitcoin Core and its been in Bitcoin Core for a while.\n\nSjors Provoost:\n\nYeah, I think a couple years.\n\nAaron van Wirdum:\n\nAnd apparently everyone's comfortable enough with this.\n\nSjors Provoost:\n\nI don't know.\n\nAaron van Wirdum:\n\nLooks like it.\n\nSjors Provoost:\n\nAnd I don't know if people use the feature.\nThey might turn it off.\n\n## Assume UTXO\n\nAaron van Wirdum:\n\nSo now a newer idea, which is based on Assume Valid is James O'Beirne's AssumeUTXO.\n\nSjors Provoost:\n\nYes.\n\nAaron van Wirdum:\n\nSo what is the difference? What is AssumeUTXO then?\n\nSjors Provoost:\n\nWell here, the UTXO set, as we've said a couple times is the collection of coins that exist right now.\nSo every time you send somebody money that creates a UTXO and it destroys the UTXO that you send from.\n\nAaron van Wirdum:\n\nIt's the current state of balances is how I generally call it.\n\nSjors Provoost:\n\nYeah.\nAlthough, yeah...\n\nAaron van Wirdum:\n\nYeah.\nI know.\nTechnically, you object to the term balances.\n\nSjors Provoost:\n\nWell, because balance is something you can add and subtract to, but these UTXOs are destroyed all the time.\nSo it's like you have a bank account and the bank account is destroyed when you use it.\n\nAaron van Wirdum:\n\nSure.\n\nSjors Provoost:\n\nBut in general, the idea is that every time...\nThe only way you can reconstruct the UTXO set.\nSo the only way and find out which coins exist right now is to replay everything from scratch.\nSo you have to take the first block, see which coins it creates, which coins it destroys.\nThen the second block, see which coins it destroys, which coins it creates, et cetera, et cetera, et cetera, et cetera.\nAnd that takes a long time and you can only do it sequentially.\nYou have to start at the beginning.\nYou have to go to the end.\nYou cannot do it in parallel because you don't know if block 100 hundred thousand.\n\nSjors Provoost:\n\nYou don't know if it's valid because you need to know what coins existed at one block before it.\nSo this is annoying because it takes a long ass time to sync the whole blockchain.\nSo what AssumeUTXO does, is it takes a snapshot of this UTXO set at a certain height, maybe just before the release or a bit older.\nAnd then when your node starts, it starts from that point.\nSo it skips...\nInitially skips the whole history.\nIt starts from this snapshot and then it just checks the next block and the next block and the next block and the next block until it reaches the tip, the most recent block.\nSo then you know exactly your balances and you can start using it.\nBut in the meantime, in the background, it starts at the Genesis block, goes all the way to the snapshot and make sure that the snapshot is correct.\nAnd if the snapshot is not correct, it starts screaming.\n\nAaron van Wirdum:\n\nI'm assuming it still does the Headers First syncing, right? First it checks out which chain is the longest one.\n\nSjors Provoost:\n\nIn fact it has to, because in order to load the snapshot, it must already have the headers at that point.\nSo it has to have the headers up until the snapshot before it can even load the snapshot.\n\nAaron van Wirdum:\n\nRight.\nAnd then with Assume Valid, it still did all of the UTXO set constructing.\nIt still replayed all of the transactions.\nIt just didn't check for the signatures.\nIt just skipped its signature validation.\nAnd now with AssumeUTXO, at least initially it skips all of it.\nIt skips the transaction replaying as well as obviously, then also the signature checking.\nSo just takes the UTXO set and from there on out constructs, the blockchain based on the newer blocks that have been found since then.\n\nSjors Provoost:\n\nExactly.\nAnd so you're back to where everything started.\nAs soon as that backlog checking has been done, then you're basically at the same trust as you are now.\nHowever you could...\nAnd this gets into trade offs.\nLike, do you really want to check all the history? Because there are a lot of things you can know without checking history.\nSo there's no plan right now to not check history because that's still a bit controversial.\n\nAaron van Wirdum:\n\nYou mean check history after...\n\nSjors Provoost:\n\nBefore the snapshot.\n\nAaron van Wirdum:\n\nYes.\nYou basically check the snapshot.\nThen you check what have happened since the snapshot and once you've constructed the current version of the UTXO set and the current version of the blockchain.\nThen you go back to block number one and start to check if your assumption of the UTXO set was actually correct.\n\nSjors Provoost:\n\nThat's right.\nAnd so the question is, could you eventually in the future opt out of doing that? And what are you sacrificing when you do that? And well, some things you're not sacrificing.\nSo the nice thing is if you start at the snapshot and you create a new address and you receive coins on it and they get into a block, then you kind of know that block is valid.\nAt least unless there's another chain out there because otherwise like a lot of miners are wasting a lot of proof of work on a chain that's not valid.\nWhich could be true.\n\nAaron van Wirdum:\n\nWhich could be true.\nWhich is a trade off.\nYou're trusting that miners are being honest there, you're trusting that they're not burning resources just to screw with you.\n\nSjors Provoost:\n\nNot screw with you, screw with everyone.\nBut there could be some conspiracy where the snapshot is fake and the core developers and the miners collude and create a fake snapshot that has a couple of extra coins in it that all the miners agree that they will approve blocks with that coin in it.\nSo you could sneak in a hard fork.\nThat's the scary thing about it, which is why, again, you need people to check whether the snapshot is real.\nYou can either do it yourself with this back validation or you can go in and...\nOr you can rely on the fact that other people are looking at the source code and see this one particular line, which if it contains something ridiculous, there's a problem.\nAnd again, the same story with the headers, that still need to match.\nSo somebody would have to spend a whole lot of proof of work and get sneaked that fake snapshot in.\n\nAaron van Wirdum:\n\nSo this is not included in Bitcoin Core right now?\n\nSjors Provoost:\n\nNo, in fact, all of this is quite new.\nSo I think the current version of Bitcoin Core has a way to create a snapshot.\nBut there's nothing you can do with that snapshot.\nAnd then not the version that's coming out now, but the version that might come out like early next year should have a way to...\nProbably will have a way to load a snapshot.\n\nAaron van Wirdum:\n\nWhat does load a snapshot mean?\n\nSjors Provoost:\n\nSo this UTXO snapshot, the set of coins is a couple gigabytes and the only way you can get it is to download it from someone.\nIt's not included in the source code and there's no way to serve it over the peer-to-peer network yet.\n\nAaron van Wirdum:\n\nThe only thing that's included in the source code would be the hash of the UTXO set? Not the UTXO set itself because it's too big.\n\nSjors Provoost:\n\nRight.\nAnd so initially, maybe that UTXO set is just a torrent that people can host.\nIt's very easy to check a torrent, because it also has a hash.\nOr one use case for that could be say, if you're running a BTCPay server, if you're spinning that up for the first time, it's really, really time consuming to have to download the entire blockchain.\nBut then you probably want to skip validation of the older stuff.\nBecause if you're running that server you're probably also running a node somewhere else.\nSo you can still compare that, that you're actually looking at the same chain.\nSo that could be a good use case for it.\nAnd then it's nice that the BTCPay server thing just downloads the three gigabyte file and then starts syncing from there, save you like two weeks.\nBecause all these web servers that are incredibly slow.\n\nAaron van Wirdum:\n\nSo right now, Bitcoin Core can make snapshot of a UTXO set, but it doesn't actually do anything with it?\n\nSjors Provoost:\n\nYep.\n\nAaron van Wirdum:\n\nThen in an upcoming release it's going to be able to download UTXO set?\n\nSjors Provoost:\n\nNo it's going to be able to load a UTXO set that you downloaded.\nSomewhere.\n\nAaron van Wirdum:\n\nAnd then maybe in the future version after that, then it's going to complete the package and you might have something called Assume UTXO in Bitcoin Core.\n\nSjors Provoost:\n\nOne way such a future could look is the nodes.\nEvery node that wants to would serve this snapshot.\nProbably not automatically because it's pretty big.\nIt's like couple gigabytes.\nBut any node that wants to could serve the snapshot and then there's a peer-to-peer protocol to download the snapshot automatically.\nAnd so when you start a new node, it would automatically find the snapshot, use the snapshot, sync to the tip, show you some orange blinking thing, probably.\nAnd then sync from the start to the snapshot and then show you a nice green blinking thing.\n\nAaron van Wirdum:\n\nIs this controversial at all? The fact that there are some trade offs there, some security trade offs.\nEven though they're small and temporary, they're there.\nDo you think this is controversial at all?\n\nSjors Provoost:\n\nI don't know.\nI mean, usually with this kind of features, first of all, it's experimental.\nSo that means you probably need to do something to turn it on.\nMy guess is, once it's done to the point that I just described, it's probably still going to be off the first time.\nAnd then if people start objecting to it or not, that's sort of the thing you need to see.\nI mean, something is controversial when people decide it's controversial.\n\nAaron van Wirdum:\n\nBut that hasn't been decided yet then?\n\nSjors Provoost:\n\nNot that I know, but there's only a handful of people who actually grasp this feature.\nSo it might be a bit early.\nIn the longer run something that's been an ongoing discussion for ages is the idea of committing to the UTXO set inside the blockchain itself, a UTXO commitment.\n\nAaron van Wirdum:\n\nI've heard of that.\n\nSjors Provoost:\n\nThat certainly is controversial.\nI don't think...\nI don't know if anybody is opposed to it in principle, but it's certainly controversial depending on how you do it.\nBecause what you want to prevent is sort of the scenarios we discussed before, right? The scenario where the blockchain is too big to check for everybody and then a bunch of miners and developers decide to give themselves some coins and they get away with it.\nBecause not enough people verify the entire history.\nSo that's a risky part of it.\n\nAaron van Wirdum:\n\nHow would that work with embedding? Sorry, it's embedding the UTXO set into the blocks?\n\nSjors Provoost:\n\nYou're not embedding it.\nYou're embedding a hash into the block.\n\nAaron van Wirdum:\n\nSure.\n\nSjors Provoost:\n\nSo every block would contain, I guess in the coinbase transaction a hash of the UTXO set or some other derived thing of the UTXO set.\n\nAaron van Wirdum:\n\nWhat's the benefit of that?\n\nSjors Provoost:\n\nWell then instead of relying on what's in the source code, this hash, you would rely on what's in the blockchain, this hash.\nThat's I guess, you make it part of consensus and a block is not valid if the hash is not valid.\nSo you would reject blocks that have an invalid hash rather than reject code that looks fishy.\nI think it's a different thing, but there are quite...\nThere are very different ways that you can put stuff in a block.\nIt could be straightforward as a hash, but it could also be something a little bit more indirect, something that if you know...\n\nSjors Provoost:\n\nSo if you look at the block and you see this number, you do not know the UTXO set and you can't download the UTXO set using that information.\nBut instead you have to download...\nYou have to process the whole blockchain from the Genesis block to make sure that that thing in the blockchain is valid.\nBut then the question is what is use going to be? There's some tricky trade ups there.\nYou should ask Peter Todd at some point, because he's thought about that stuff a bit more.\n\nAaron van Wirdum:\n\nAt some point I will.\n\nSjors Provoost:\n\nAll right.\n\nAaron van Wirdum:\n\nWe've gone off the rails.\nBut I think we covered everything.\n\nSjors Provoost:\n\nYeah.\nIn general, it's one thing that people complain about when they hear about Bitcoin Core.\nIts like, \"Oh my God, I need to download the whole blockchain.\" And then you get this tradeovers do you want people to just put up with that? Do you want to make it slightly less annoying?\n\nAaron van Wirdum:\n\nYes.\nAt a trade off.\n\nSjors Provoost:\n\nAnd then the smallest possible trade off.\nSo I think this is a very interesting project, so I'm happy to test it.\nThat's usually what I do.\n\nAaron van Wirdum:\n\nGood.\n\nSjors Provoost:\n\nTest it.\nTry to break something and then complain or get up.\n\nAaron van Wirdum:\n\nAll right.\n\n",
    "body_type": "markdown",
    "created_at": "2020-10-23T00:00:00.000Z",
    "domain": "https://btctranscripts.com/",
    "url": "https://btctranscripts.com/bitcoin-explained/sync-bitcoin-faster-assume-utxo",
    "categories": [
        "podcast"
    ],
    "tags": [
        "bitcoin-core",
        "assumeutxo"
    ],
    "media": "https://www.youtube.com/watch?v=S9pk_NqKCBE",
    "authors": [
        "Sjors Provoost",
        "Aaron van Wirdum"
    ],
    "indexed_at": "2024-03-21T16:33:36.164Z",
    "transcript_by": "Sjors, edilmedeiros",
    "summary": "In a recent podcast episode, Sjors Provoost and Aaron van Wirdum delved into the intricate processes behind Bitcoin's synchronization mechanisms, focusing particularly on the \"Headers First\" strategy and the \"Assume Valid\" feature. Their discussion illuminated the evolutionary steps taken to enhance both the efficiency and security of syncing a Bitcoin node, thereby making the blockchain more accessible and trustworthy for users. The conversation began with an exploration of the challenges initially faced when synchronizing a Bitcoin node, emphasizing the inefficiencies and vulnerabilities of sequentially requesting and downloading block headers and their corresponding blocks from peers. This method not only consumed significant resources but also exposed nodes to potential deception by malicious actors.\n\nTo address these challenges, the Bitcoin community implemented the \"Headers First\" strategy, marking a pivotal shift that allowed nodes to first download and scrutinize the block headers. This approach enabled nodes to identify the most work-intensive chain prior to downloading full blocks, significantly streamlining the synchronization process by prioritizing the legitimate blockchain. The evolution continued with the introduction of the \"Assume Valid\" feature into Bitcoin Core, which expedited the sync process by allowing nodes to bypass the computationally intensive task of signature verification for historical transactions up to a specified block. This mechanism relied on a nominal trust in developers, who embed a hash of a known, verified block within the software, thereby offering a substantial reduction in synchronization time without compromising the integrity of the blockchain validation process.\n\nThe open-source nature of Bitcoin Core ensures that any discrepancies or malicious code could be identified through transparent scrutiny by the community. Users skeptical of the \"Assume Valid\" feature have the option to disable it, highlighting the delicate balance between trust and verification within the Bitcoin ecosystem. Provoost and van Wirdum's dialogue further explored the concepts of Assume Valid and AssumeUTXO, the latter introduced by James O'Beirne to accelerate the initial blockchain sync by utilizing a snapshot of the Unspent Transaction Outputs (UTXO) set. This method maintains a verification process in the background to ensure the snapshot's accuracy, representing a significant advancement in making Bitcoin Core more user-friendly without sacrificing security measures.\n\nHowever, this methodology introduces a reliance on the assumption that miners are acting honestly and that the used snapshot is accurate, raising concerns about potential security implications. The conversation also touched on the future of Bitcoin Core development and the concept of UTXO commitments, sparking debate within the community about the best methods to verify the current state without relying solely on external snapshots. This ongoing dialogue underscores the evolving nature of Bitcoin Core, striving to balance enhanced user experience with the robust security principles foundational to Bitcoin.\n\nIn conclusion, the discussion between Sjors Provoost and Aaron van Wirdum provides profound insights into the continuous efforts to refine Bitcoin Core. By navigating the complex interplay between performance improvements and the preservation of security and decentralization, the Bitcoin community plays a crucial role in the cryptocurrency's evolution. Through reviewing, debating, and testing new features, the community ensures the resilience and integrity of the decentralized financial system that Bitcoin represents."
}