{
    "id": "bitcointranscripts+bitcoin-core-dev-tech+2023-09+wallet-legacy-upgrade",
    "title": "Remove the legacy wallet and updating descriptors",
    "body_formatted": "{\"type\":\"heading\",\"text\":\"Wallet migration + legacy wallet removal\"}, {\"type\":\"paragraph\",\"text\":\"The long-term goal targeted for v29 is to delete BDB and drop the legacy\\nwallet. The migration PR for the GUI was just merged recently, so that\\nwill be possible for the next release v26. The \\\"Drop migratewallet\\nexperimental warning\\\" PR (#28037) should also go in before v26.\\nMigrating without BDB should be possible for v27 (PRs \\\"Independent BDB\\\"\\n[#26606](https://github.com/bitcoin/bitcoin/pull/26606) and \\\"Migrate without BDB\\\" [#26596](https://github.com/bitcoin/bitcoin/pull/26596)). Priority PRs for now are:\"}, {\"type\":\"list\"}, {\"type\":\"paragraph\",\"text\":\"PRs for \\\"Stop making legacy\\\" and \\\"Delete BDB, drop legacy\\\" are not\\navailable yet. These will be 2-4 PRs, the goal is to have them in at the\\nstart of 2025.\"}, {\"type\":\"paragraph\",\"text\":\"A: Can't we remove the legacy wallet earlier?\\nB: Okay, let's move everything up one release, so the goal is v28.\"}, {\"type\":\"paragraph\",\"text\":\"Batching DB writes should be done before v27.0, a PR for that will be made available soon.\"}, {\"type\":\"heading\",\"text\":\"Descriptor wallet upgrading\"}, {\"type\":\"paragraph\",\"text\":\"If you made a taproot wallet before taproot activation, it's not\\npossible to add a taproot descriptor until you do it manually. These two\\nPRs solve this issue:\"}, {\"type\":\"list\"}",
    "body": "## Wallet migration + legacy wallet removal\n\nThe long-term goal targeted for v29 is to delete BDB and drop the legacy\nwallet. The migration PR for the GUI was just merged recently, so that\nwill be possible for the next release v26. The \"Drop migratewallet\nexperimental warning\" PR (#28037) should also go in before v26.\nMigrating without BDB should be possible for v27 (PRs \"Independent BDB\"\n[#26606](https://github.com/bitcoin/bitcoin/pull/26606) and \"Migrate without BDB\" [#26596](https://github.com/bitcoin/bitcoin/pull/26596)). Priority PRs for now are:\n\n- [#20892](https://github.com/bitcoin/bitcoin/pull/20892) \"Both wallet types in each test case\"\nThis PR solves the annoying problem of having to run wallet tests twice\nfor both descriptor and legacy wallet individually in the functional\ntest framework.\n\n- [#26008](https://github.com/bitcoin/bitcoin/pull/26008) \"Caching for migrated non-HD\"\nWallet with non-ranged descriptors have a poor performance right now,\nthis PR fixes that.\n\n- [#28037](https://github.com/bitcoin/bitcoin/pull/28037) \"Drop migratewallet experimental warning\" (goal v26)\n- [#28027](https://github.com/bitcoin/bitcoin/pull/28027) \"Backwards compatibility tests\"\n- [#26606](https://github.com/bitcoin/bitcoin/pull/26606) \"Independent BDB\" (goal v27)\n- [#26596](https://github.com/bitcoin/bitcoin/pull/26596) \"Migrate without BDB\" (goal v27)\n\nPRs for \"Stop making legacy\" and \"Delete BDB, drop legacy\" are not\navailable yet. These will be 2-4 PRs, the goal is to have them in at the\nstart of 2025.\n\nA: Can't we remove the legacy wallet earlier?\nB: Okay, let's move everything up one release, so the goal is v28.\n\nBatching DB writes should be done before v27.0, a PR for that will be made available soon.\n\n## Descriptor wallet upgrading\n\nIf you made a taproot wallet before taproot activation, it's not\npossible to add a taproot descriptor until you do it manually. These two\nPRs solve this issue:\n\n- [#26728](https://github.com/bitcoin/bitcoin/pull/26728) \"wallet: Have the wallet store the key for automatically generated descriptors\"\n- [#25907](https://github.com/bitcoin/bitcoin/pull/25907) \"wallet: rpc to add automatically generated descriptors\"\n\n",
    "body_type": "markdown",
    "created_at": "2023-09-21T00:00:00.000Z",
    "domain": "https://btctranscripts.com/",
    "url": "https://btctranscripts.com/bitcoin-core-dev-tech/2023-09/wallet-legacy-upgrade",
    "categories": [
        "core-dev-tech"
    ],
    "tags": [
        "bitcoin-core",
        "wallet"
    ],
    "authors": [
        "Andrew Chow"
    ],
    "indexed_at": "2024-03-21T16:33:36.035Z",
    "summary": "In a recent discussion led by Andrew Chow, significant advancements in Bitcoin wallet technology were outlined, shedding light on the future of wallet management and performance enhancements. A pivotal goal set for version 29 (v29) is the complete deletion of Berkeley DB (BDB) and the removal of the legacy wallet system. This milestone aims to streamline Bitcoin's wallet infrastructure by transitioning entirely to descriptor wallets, which offer more advanced features and improved security.\n\nThe migration process from legacy wallets to descriptor wallets has been facilitated by key developments in the graphical user interface (GUI), with a notable merge that occurred recently, making migration feasible starting with the upcoming release v26. In line with this transition, the implementation of the \"Drop migratewallet experimental warning\" PR (#28037) is expected to occur before v26, marking a significant step towards migrating without the dependency on BDB by v27. This effort is supported by two critical pull requests: \"Independent BDB\" (#26606) and \"Migrate without BDB\" (#26596), highlighting the focused endeavor to enhance the wallet's architecture and operational efficiency.\n\nAdditionally, the integration of both wallet types within each test case, as addressed in PR #20892, resolves the cumbersome necessity of conducting wallet tests twice\u2014once for each wallet type (descriptor and legacy). This improvement not only streamlines the testing process but also underscores the commitment to ensuring robustness and reliability in wallet functionality. Performance optimization for migrated non-High Definition (non-HD) wallets with non-ranged descriptors is another area receiving attention, with PR #26008 aiming to rectify the current suboptimal performance.\n\nLooking ahead, discussions have broached the possibility of accelerating the timeline for the legacy wallet's removal, proposing an advancement to v28 instead of the initially targeted v29. This adjustment underscores the project's agility in response to technological advancements and community feedback. Moreover, the preparation for batch database writes, slated for completion before v27.0, exemplifies the ongoing efforts to enhance efficiency and performance across the board.\n\nA noteworthy challenge addressed concerns descriptor wallets created prior to the activation of Taproot\u2014a significant upgrade to the Bitcoin protocol. Two proposed solutions, encapsulated in PRs #26728 and #25907, aim to seamlessly integrate Taproot descriptors into these wallets, thereby ensuring compatibility and leveraging Taproot's enhancements. This development not only addresses immediate functional needs but also aligns with the broader vision of fostering a more flexible and powerful wallet ecosystem.\n\nIn summary, Andrew Chow's dialogue illuminated the path forward for Bitcoin's wallet infrastructure, characterized by a strategic shift towards descriptor wallets, performance optimizations, and enhanced compatibility features. These efforts collectively signify a substantial leap forward in Bitcoin's evolution, promising users a more secure, efficient, and versatile wallet experience."
}