<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
  <updated>2023-10-25T17:02:29.745868+00:00</updated>
  <author>
    <name>Antoine Riard 2023-10-19 19:33:22+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
    <updated>2023-10-25T17:02:29.745868+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-October/022029.html" rel="alternate"/>
    <summary>Summary:

The email discusses a scenario involving a replacement-cycling attacker and a defender's scorched earth policy. The attacker can afford to pay 100% of the HTLC (Hash Time-Locked Contract) value under this policy and still make an economic gain.

The example given involves three individuals: Alice, Bob, and Caroll, who are all "honest" routing hops targeted by the attacker. Each of them has three independent HTLCs worth 10,000 sats (satoshi) in-flight on their outbound channels.

Under the defender's policy, Alice broadcasts her HTLC-timeout with a committed fee of 10,000 sats at T + 1. However, Mallory, the attacker, replaces it at T+2 with an HTLC-preimage X worth 200,000 sats (+rbf penalty 1 sat / vb rule 4). Alice's HTLC-timeout is now out of network mempools.

Bob then broadcasts his HTLC-timeout of 200,000 sats at T+3, but Mallory replaces it at T+4 with her HTLC-preimage Y worth 200,000 sats (+rbf penalty 1 sat / vb rule 4 * 2). Bob's HTLC-timeout is also out of network mempools.

Mallory's HTLC-preimage Y conflicts with HTLC-preimage X as well, resulting in a multiplied rbf penalty. Caroll subsequently broadcasts her HTLC-timeout of 200,000 sats at T+5, which is replaced by Mallory at T+6 with her HTLC-preimage Z worth 200,000 sats (+rbf penalty 1 sat / vb rule 4 * 3). Caroll's HTLC-timeout is out of network mempools too.

Similar to before, HTLC-preimage Z conflicts with HTLC-preimage X and Y, resulting in a multiplied rbf penalty. If Mallory's HTLC-preimage enters the top mempool feerates group (due to the accumulated rbf penalty), one unconfirmed ancestor can be double-spent to evict the HTLC-preimage.

If Mallory successfully executes the replacement cycling, she may incur a loss of 10,000 sats + the rbf penalty cost for each rebroadcast attempt of the victim. However, she would win each victim's HTLC value of 200,000 sats. Assuming 5 rebroadcasts per block (even on random timers) multiplied by 3 victims, with an HTLC-preimage size of 200 bytes and cltv_delta of 144 blocks, the total attacker cost is 432,000 sats. The realized economic gain is 168,000 sats.

The email concludes by mentioning that it seems correct in terms of fees math and replacement rules, without introducing more favorable assumptions for the attacker, such as mempool spikes where the "honest" HTLC-timeout transactions can float in network mempools.

(Note: The farewell part of the email has been ignored in this summary.)</summary>
    <published>2023-10-19T19:33:22+00:00</published>
  </entry>
</feed>
