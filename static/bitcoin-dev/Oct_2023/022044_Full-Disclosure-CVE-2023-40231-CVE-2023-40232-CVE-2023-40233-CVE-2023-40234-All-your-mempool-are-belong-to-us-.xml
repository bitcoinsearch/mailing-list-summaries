<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
  <updated>2023-10-21T01:51:32.704857+00:00</updated>
  <author>
    <name>Olaoluwa Osuntokun 2023-10-21 00:18:58+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
    <updated>2023-10-21T01:51:32.704896+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-October/022044.html" rel="alternate"/>
    <summary>The email discusses a scenario involving Carol, Bob, Alice, and Mallory in the context of HTLC (Hashed Time-Lock Contract) transactions. It explains that Mallory can only replace an HTLC-timeout transaction if she is directly connected to the target peer via a direct channel. Mallory cannot unilaterally replace any transaction in the mempool solely with knowledge of the preimage.The email emphasizes that all HTLC transactions are two-party contracts, with the public keys of both participants hardcoded into the contract. This means that a third party cannot unilaterally sweep an HTLC given only a preimage. To provide fundamental context, the email explains that once the timelock of an HTLC expires and the receiver has direct knowledge of the preimage, a bidding war begins. If the receiver confirms their success transaction in time, they gain the funds, and the sender can pipeline the preimage backwards in the route, making all parties whole. On the other hand, if the sender wins, it's as if nothing happened, except for the fees paid at the last mile, and all other hops can safely cancel their HTLC back on the chain.The email mentions that most implementations today monitor the mempool for preimages to quickly resolve incoming HTLCs off-chain. The described attack relies on the attacker's ability to execute precise transaction replacement globally across the mempool. However, if any honest party sees the preimage in the mempool, they can settle back off-chain, potentially gaining funds if their timeout confirms first.Furthermore, executing such an attack requires perfect execution over hours or even days. The security parameter within the Lightning Network, called CLTV delta, determines the time nodes have before outgoing and incoming HTLCs expire. Increasing this value makes the attack more difficult, as the attacker must balance low enough fees to avoid being mined but high enough to replace the defender's transaction without being too high that it gets mined and ends the attack. Additionally, with each iteration, the attacker must increase the fees they pay, increasing the likelihood of the transaction being mined.The email mentions that one approach for the attacker is to locate the defender's node to launch the replacement attack directly in their mempool. However, this would reveal the preimage to the defender, who could then settle everything back, completing the payment and stopping the attack prematurely. The distributed nature of the Internet poses challenges to the attacker, as network jitter, propagation delay, and geographic heterogeneity can cause timing issues. The email acknowledges that launching this attack across a real network requires precise execution and instant propagation across the entire network. Regarding anchor channels, the second-level HTLCs allow the defender to attach arbitrary inputs for fee bumping purposes. This means they can incrementally increase their fee via RBF (Replace-By-Fee) as the expiry deadline approaches, further increasing the cost for the attacker. In addition, the attack cannot be indiscriminately launched across the network. It requires per-node setup by the attacker and the consumption of UTXOs to create a chain of transactions for the replacement attack. These transactions also need to be maintained in a state of non-confirming superposition.In summary, the email presents the attack as a fragile one, requiring per-node setup, precise timing and execution, non-confirming superposition of all transactions, and instant propagation across the entire network. The attack can be launched directly with a miner or into their mempool, but that weakens the attack as any broadcast of the preimage replacement transactions by the miner allows the defender to extract the preimage and settle the incoming HTLC.</summary>
    <published>2023-10-21T00:18:58+00:00</published>
  </entry>
</feed>
