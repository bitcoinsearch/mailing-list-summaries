<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
  <updated>2023-10-25T17:00:56.115241+00:00</updated>
  <author>
    <name>Olaoluwa Osuntokun 2023-10-21 00:18:58+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
    <updated>2023-10-25T17:00:56.115241+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-October/022044.html" rel="alternate"/>
    <summary>In the given email, the discussion revolves around an attack scenario in the context of a payment channel network called Lightning Network (LN). The attack is aimed at replacing a specific type of transaction known as HTLC (Hash Time-Locked Contract) using precise timing and execution techniques.

It is clarified that an attacker, Mallory, can only replace an HTLC-timeout transaction if she is directly connected with the targeted peer, Alice, via a direct channel. The attacker cannot unilaterally replace any transaction in the mempool solely with knowledge of the preimage. In the LN, all HTLC transactions are two-party contracts, with the public keys of both participants hard-coded into the contract. Therefore, a third party cannot unilaterally sweep an HTLC given only a preimage.

The email emphasizes the importance of understanding the fundamental context of HTLCs and their expiration process. Once the timelock of an HTLC expires, and the receiver (Alice) has direct knowledge of the preimage, a bidding war begins between the sender (Bob) and the receiver. If the receiver is able to confirm their success transaction in time, they gain the funds, and the sender can pipeline the preimage backwards in the route, ensuring all parties are compensated. On the other hand, if the sender wins the bidding war, it's as if nothing happened, except for the fees paid at the last mile, and all other hops can safely cancel their HTLC back on the chain.

To execute the described attack, the attacker needs to perform precise transaction replacement globally across "the mempool". However, the attack can be thwarted if any honest party sees the preimage in the mempool, allowing them to settle off-chain or potentially gain funds if their timeout confirms first. Additionally, executing such an attack requires maintaining perfect execution for hours or even days. Nodes in the LN set a security parameter called CLTV delta, which determines the time they have before outgoing and incoming HTLCs expire. Increasing this value makes the attack more difficult as the attacker must balance fees to avoid being mined too soon while still replacing the defender's transaction.

The email also mentions that the attacker can attempt to locate the defender's node (Alice) to launch the replacement attack directly in their mempool. However, this approach exposes the preimage to the defender, who can use it to settle everything back and halt the attack. Moreover, executing the replacement attack across a real network with network jitter, propagation delay, and geographic heterogeneity is challenging. Any slight timing discrepancy can lead to confirmation or preimage revelation in the mempool.

In the case of anchor channels, the defender (Alice) has the ability to attach arbitrary inputs for fee bumping purposes, allowing them to iteratively increase their fee via Replace-by-Fee (RBF) as the expiry deadline approaches. This increases the cost and complexity for the attacker. Additionally, the attack cannot be launched indiscriminately across the network; instead, it requires per-node setup by the attacker, involving the consumption of UTXOs to create a chain of transactions for launching the replacement attack. These transactions also need to be maintained in a non-confirming superposition state.

Overall, the email concludes that the described attack is fragile and complex, requiring per-node setup, precise timing and execution, non-confirming superposition of transactions, and instant propagation across the entire network. Launching the attack directly with a miner or "into" their mempool weakens the attack, as any broadcasting of the preimage replacement transactions allows the defender to extract the preimage and settle the incoming HTLC.</summary>
    <published>2023-10-21T00:18:58+00:00</published>
  </entry>
</feed>
