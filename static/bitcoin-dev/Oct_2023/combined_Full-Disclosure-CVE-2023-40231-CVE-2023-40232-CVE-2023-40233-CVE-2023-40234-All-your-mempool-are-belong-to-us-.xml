<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>2</id>
  <title>Combined summary - Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your	mempool are belong to us"</title>
  <updated>2023-10-18T01:56:28.752531+00:00</updated>
  <author>
    <name>ZmnSCPxj 2023-10-17 10:34:04+00:00</name>
  </author>
  <author>
    <name>ziggie1984 2023-10-17 07:21:35+00:00</name>
  </author>
  <link href="bitcoin-dev/Oct_2023/022004_Full-Disclosure-CVE-2023-40231-CVE-2023-40232-CVE-2023-40233-CVE-2023-40234-All-your-mempool-are-belong-to-us-.xml" rel="alternate"/>
  <link href="bitcoin-dev/Oct_2023/022005_Full-Disclosure-CVE-2023-40231-CVE-2023-40232-CVE-2023-40233-CVE-2023-40234-All-your-mempool-are-belong-to-us-.xml" rel="alternate"/>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>2</id>
    <title>Combined summary - Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your	mempool are belong to us"</title>
    <updated>2023-10-18T01:56:28.752588+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-October/022004.html" rel="alternate"/>
    <summary>In the email thread, ZmnSCPxj provides a detailed explanation of a pinning attack on the Lightning Network (LN). The attack involves three nodes, A, B, and C, connected by channels. Node A routes a payment from A to B to C. The attack exploits timelocks and relies on node B having a `cltv_expiry_delta` (time delay before an HTLC can be claimed) of 44 or lower.The attack scenario is as follows: C suddenly goes offline after B forwards the HTLC from B to C. As a result, all the signed transactions, including the commitment transaction and HTLC-timeout transactions, are "stuck" at the feerate at the time. At block height 100, B notices that the HTLC timelock has expired without C claiming it, so B forces the B-C channel onto the blockchain. However, due to the increased onchain feerates, the commitment transaction and HTLC-timeout transaction do not confirm.Meanwhile, node A is still online with B and updates the onchain fees of the A-B channel pre-signed transactions to the latest feerates. At block height 144, B is still unable to claim the A-B HTLC, so A drops the A-B channel onto the blockchain. Since the fees are up-to-date, this confirmation happens immediately, and A is able to recover the HTLC funds.However, the pre-signed transactions for the B-C channel remain at the old, uncompetitive feerates. At this point, C broadcasts an HTLC-success transaction with high feerates that child-pays-for-parents (CPFPs) the commitment transaction. This allows C to obtain the value of the HTLC. Unfortunately, the HTLC-timeout transaction, which is at the old, low feerate, is replaced by the HTLC-success transaction. Consequently, B is no longer able to use the knowledge of the preimage, as its own incoming HTLC has already been confirmed as claimed by A.The email also explains why the HTLC-timeout is pre-signed and why B cannot fee-bump it. In the Poon-Dryja mechanism used in Lightning Network, the HTLCs are "infected" by the Poon-Dryja penalty case to prevent cheating. The commitment transaction held by B includes an additional revocation branch and involves both B and C. This ensures that even if B holds onto an old revoked transaction, it still has to contend with a new output with a relative timelock.The email ends with a request for more details about the observed attack on mainnet and tools that can be used to monitor suspicious behavior on the chain. The sender also suggests introducing a feebumping race between the victim and the attacker on the tail side of the attack to make it more costly. Additionally, they propose aggressively fee-bumping the htlc-output on the htlc-timeout path if the preimage is seen, making it more expensive for the attacker to steal the HTLC. Another mitigation suggested is restricting the amount and number of HTLCs for big channels to unknown peers.Overall, the email provides a comprehensive explanation of the pinning attack on the Lightning Network and discusses possible mitigations and improvements to counter such attacks.</summary>
    <published>2023-10-17T10:34:04+00:00</published>
  </entry>
</feed>
