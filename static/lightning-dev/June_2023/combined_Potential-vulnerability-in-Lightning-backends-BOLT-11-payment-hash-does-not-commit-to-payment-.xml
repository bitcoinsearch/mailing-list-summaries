<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>2</id>
  <title>Combined summary - Potential vulnerability in Lightning backends: BOLT-11 "payment hash" does not commit to payment!</title>
  <updated>2023-07-07T02:56:59.054127+00:00</updated>
  <author>
    <name>callebtc 2023-06-19 15:26:05+00:00</name>
  </author>
  <author>
    <name>Antoine Riard 2023-06-19 20:34:10+00:00</name>
  </author>
  <link href="lightning-dev/June_2023/003983_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.xml" rel="alternate"/>
  <link href="lightning-dev/June_2023/003986_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.xml" rel="alternate"/>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>2</id>
    <title>Combined summary - Potential vulnerability in Lightning backends: BOLT-11 "payment hash" does not commit to payment!</title>
    <updated>2023-07-07T02:56:59.054168+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003983.html" rel="alternate"/>
    <summary>Earlier last month, the team at LNbits discovered an exploit that allowed attackers to create balances out of thin air by taking advantage of a quirk in how invoices are handled internally. This vulnerability has been patched in LNbits version 0.10.5, and users are urged to update as soon as possible. The attack involves inserting a bolt-11 payment hash from one payment into a different payment, creating a malicious invoice that tricks the backend into believing it is a different payment. The attacker can then create a new account and pay the malicious invoice, resulting in the backend settling the payment internally and crediting the attacker with funds that were not actually paid.The critical part of this exploit is that payment hashes do not commit to any payment details, such as the amount, but only to the preimage. This means that the backend mistakenly assumes that the payment hash commits to the payment details. To mitigate this vulnerability, backends should use self-generated unique "checking ids" for looking up internal payments or implement additional checks to ensure that the invoice details have not been tampered with. There are two important lessons to take away from this exploit. Firstly, it highlights the level of sophistication of Lightning Network-savvy attackers, as carrying out this attack requires a fundamental understanding of bolt-11 and custom tooling. Secondly, it emphasizes that the "payment hash" of an invoice is actually a "preimage" hash and does not commit to payment details like the amount or pubkey. Calling it the "preimage hash" instead can help developers avoid implicitly assuming that the hash includes payment details.It is worth noting that if you're using a custodial wallet, payment processor, or account management software based on LDK and following the API recommendations of using "create_inbound_payment," you should not be affected by this exploit, as the amount equivalence checks are handled by the implementation. However, it is always good practice to be aware of potential vulnerabilities and take necessary precautions.In terms of disclosure security practice, it is recommended to inform Lightning implementation maintainers about any known issues on their respective security communication channels. This helps facilitate patch coordination if needed with second-line vendors like wallets and processors.Overall, this exploit serves as a reminder of the importance of robust security measures and constant vigilance in the face of evolving attack techniques.</summary>
    <published>2023-06-19T15:26:05+00:00</published>
  </entry>
</feed>
