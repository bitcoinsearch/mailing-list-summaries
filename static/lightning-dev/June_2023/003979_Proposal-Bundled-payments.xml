<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-10T02:55:40.265766+00:00</updated>
  <author>
    <name>Thomas Voegtlin 2023-06-14 08:09:45+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-10T02:55:40.265810+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003979.html" rel="alternate"/>
    <summary>The context discusses the possibility of distributing a submarine swap client separate from the lightning wallet, enabling competition in the market. Boltz, for example, distributes a Progressive Web App that serves javascript to perform the necessary checks and sweeps the funds. While it is unclear if Boltz's app functions correctly, the key point is that a separate submarine swap client can be distributed. Lightning Loop could benefit from this separation by distributing an app that does not require a local LND instance, thereby expanding its potential user base. However, the missing ingredient is the bundling of fee prepayment and main payment in the same invoice.It is worth noting that there is an ongoing standardization effort for LSP protocols, and Boltz is working to add submarine swaps to it. In a subsequent email, Olaoluwa Osuntokun explains that for a submarine swap client to be non-custodial, it needs to unilaterally sweep or timeout an on-chain HTLC and validate all the swap parameters. While a web-based flow can hide the awareness of the subswap, it still requires dedicated logic on the client side to sweep or timeout the on-chain HTLC. A user may need to manually go to the website to obtain a signed sweep transaction, but this still requires the wallet to sign the HTLC sweep path, necessitating dedicated logic. Although a website can offer a user a signed sweep or refund transaction, it cannot be created until the user goes on-chain. Thus, dedicated logic is always required to verify the swap parameters and perform an on-chain sweep/timeout, which is crucial for trust-minimized swaps. Trusting the service to send funds or pay an invoice does not qualify as a trust-minimized swap.In another email, Thomas Voegtlin proposes an extension to BOLT-11, where an invoice can contain two bundled payments with distinct preimages and amounts. This proposal addresses the issue faced by services that require prepayment of mining fees for non-custodian exchanges, such as submarine swaps and JIT channels. Currently, services like Loop by Lightning Labs can ask for a prepayment because their software handles it. However, competitors like the Boltz exchange, which does not require a dedicated wallet, face difficulties in showing two invoices simultaneously. This vulnerability exposes them to DoS attacks where attackers force them to pay on-chain fees.For JIT channels, providers who want to protect against mining fee attacks may ask for the preimage of the main payment before opening the channel. However, this makes the service custodian and falls under European MICA regulation. Competitors like Electrum, which refuse to offer custodian services, are excluded from this game. Bundling the prepayment and main payment in the same BOLT-11 invoice would solve these issues. The proposal suggests that the receiver should wait for both payments' HTLCs to arrive before fulfilling the pre-payment HTLCs. If the main payment does not arrive, the pre-payment should fail with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment HTLCs and broadcasts the on-chain transaction.The proposed change in BOLT-11 would level the playing field among lightning service providers, allowing competitors without an established user base running a dedicated client to avoid mining fee attacks. ACINQ would also benefit by making its pay-to-open service fully non-custodian. Thomas argues that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages since it does not require the exchange of new messages and can be done non-interactively.Overall, the context discusses the possibility of distributing a separate submarine swap client, the need for bundling prepayment and main payment in the same invoice, ongoing standardization efforts for LSP protocols, and the proposal to extend BOLT-11 to allow bundled payments.</summary>
    <published>2023-06-14T08:09:45+00:00</published>
  </entry>
</feed>
