<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-02T03:12:59.647942+00:00</updated>
  <author>
    <name>Thomas Voegtlin 2023-06-14 08:09:45+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-02T03:12:59.647970+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003979.html" rel="alternate"/>
    <summary>The context discusses the possibility of distributing a submarine swap client separate from the lightning wallet of the user, which would enable competition in the market. The separation between wallet and submarine swap providers could benefit Lightning Loop by increasing their potential user base. However, the bundling of fee prepayment and main payment in the same invoice is currently missing.The context also mentions an ongoing standardization effort for LSP protocols, with Boltz working to add submarine swaps to it. The author proposes an extension to BOLT-11, where an invoice can contain two bundled payments with distinct preimages and amounts. This proposal is aimed at services that require the prepayment of a mining fee for a non-custodian exchange to take place, such as submarine swaps and JIT channels.In the case of submarine swaps, services like Loop by Lightning Labs can ask for a prepayment because their software can handle it. However, competitors like Boltz, who require a dedicated wallet, cannot do the same. This leaves them vulnerable to DoS attacks where the attacker forces them to pay on-chain fees.JIT channel providers also need to protect themselves against mining fee attacks by asking for the preimage of the main payment before opening the channel. However, this makes the service custodian, subject to legal regulations like the European MICA regulation. Competitors like Electrum, who refuse to offer custodian services, are excluded from this game.To solve these issues, the author proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments involve waiting until all HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the pre-payment should be failed with a MPP timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction.The author believes this proposal would level the playing field for competition between lightning service providers and suggests implementing it in BOLT-11 rather than using BOLT-12 or onion messages. The goal is to make the process non-interactive and avoid adding new messages unnecessarily.Overall, the context discusses the need for a separate submarine swap client, the ongoing standardization effort for LSP protocols, the vulnerability of certain service providers to DoS attacks and mining fee attacks, and the proposed solution of bundling prepayment and main payment in the same BOLT-11 invoice to enable trust-minimized swaps and promote competition.</summary>
    <published>2023-06-14T08:09:45+00:00</published>
  </entry>
</feed>
