<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-29T02:55:29.597257+00:00</updated>
  <author>
    <name>Olaoluwa Osuntokun 2023-06-14 02:56:54+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-29T02:55:29.597278+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003978.html" rel="alternate"/>
    <summary>In a proposal to extend BOLT-11, Thomas Voegtlin suggests the inclusion of two bundled payments in an invoice, each with distinct preimages and amounts. This proposal aims to address the need for prepayment of mining fees in non-custodial exchange services like submarine swaps and JIT channels. Currently, services like Loop by Lightning Labs can ask for a prepayment because their dedicated client software can handle it. However, competitors like Boltz Exchange, which require a dedicated wallet that is agnostic about the swap, face practical challenges in showing two invoices simultaneously. This vulnerability exposes them to potential denial-of-service (DoS) attacks where attackers force them to pay on-chain fees.For JIT channels, service providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. However, this approach makes the service provider a custodian, subjecting them to legal regulations such as the European MICA regulation. Competitors like Electrum, who refuse to offer custodian services, are excluded from this game. To solve this issue, bundling the prepayment and main payment in the same BOLT-11 invoice would be beneficial.The proposed semantics of bundled payments involve including two preimages and two amounts in the BOLT-11 invoice. The receiver should wait until all the HTLCs (Hash Time Locked Contracts) of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should be failed with a MPP (Multi-Path Payment) timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It's worth noting that the main payment can still fail if the sender never reveals the preimage of the main payment.While this proposal does not prevent service providers from stealing the prepayment, it aims to level the competition field between lightning service providers. Currently, using Loop requires a dedicated client, leaving competitors without an established user base running a dedicated client vulnerable to mining fee attacks. ACINQ stands to benefit from this proposal as it would allow them to make their pay-to-open service fully non-custodial while avoiding potential regulatory issues under the European MICA regulation.Thomas Voegtlin suggests implementing this change in BOLT-11 rather than introducing new messages through BOLT-12 or onion messages. He argues against unnecessary complications and emphasizes the importance of non-interactive solutions.Overall, this proposal aims to address the challenges faced by non-custodial exchange services regarding prepayment of mining fees and create a more competitive landscape among lightning service providers.</summary>
    <published>2023-06-14T02:56:54+00:00</published>
  </entry>
</feed>
