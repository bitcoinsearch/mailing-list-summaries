<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-07T02:51:42.725046+00:00</updated>
  <author>
    <name>Olaoluwa Osuntokun 2023-06-14 02:56:54+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-07T02:51:42.725074+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003978.html" rel="alternate"/>
    <summary>The proposal put forward by Thomas Voegtlin suggests an extension to BOLT-11, where an invoice can contain two bundled payments with distinct preimages and amounts. This proposal aims to address the use case for services that require a prepayment of a mining fee in order for a non-custodian exchange to take place, such as submarine swaps and JIT channels. In these cases, the service provider receives a Hash Time-Locked Contract (HTLC) for which they do not have the preimage, and they have to send funds on-chain and wait for the client to reveal the preimage when they claim the payment.The issue arises when service providers need to ask for a prepayment of mining fees. For example, competitors who require a dedicated wallet, unlike Loop by Lightning Labs, cannot ask for a prepayment because their software cannot handle it. It would be unpractical for them to show two invoices to be paid simultaneously. This vulnerability exposes them to DoS attacks, where attackers force them to pay on-chain fees.Similarly, for JIT channels, providers who want to protect themselves against this mining fee attack need to ask for the preimage of the main payment before they open the channel. However, asking for the preimage first makes the service custodian, which may have legal implications. Competitors who refuse to offer custodian services are excluded from the game.To solve these issues, Thomas Voegtlin proposes bundling the prepayment and the main payment in the same BOLT-11 invoice. The semantics of bundled payments would involve the receiver waiting for all the HTLCs of both payments to arrive before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the pre-payment is failed with a Multi-Path Payment (MPP) timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction.Thomas acknowledges that this proposal does not prevent service providers from stealing the pre-payment, but this is already a risk in the current system. He believes that implementing this change in BOLT-11 would level the field in terms of competition between lightning service providers. It would allow competitors without an established user base running a dedicated client to be protected against the mining fee attack. Additionally, he suggests that ACINQ could benefit from this change by making their pay-to-open service fully non-custodian, avoiding potential legal issues under the European MICA regulation.Thomas emphasizes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues that adding new messages would unnecessarily complicate the system, and the proposed change can be achieved in a non-interactive way.Overall, this proposal aims to address the challenges faced by service providers in requiring prepayments for mining fees in non-custodial exchanges. By bundling the prepayment and main payment in the same invoice, it seeks to provide a more secure and competitive environment for lightning service providers.</summary>
    <published>2023-06-14T02:56:54+00:00</published>
  </entry>
</feed>
