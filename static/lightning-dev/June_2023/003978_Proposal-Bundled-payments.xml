<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-30T02:56:09.430770+00:00</updated>
  <author>
    <name>Olaoluwa Osuntokun 2023-06-14 02:56:54+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-30T02:56:09.430796+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003978.html" rel="alternate"/>
    <summary>In a proposal to extend BOLT-11, Thomas Voegtlin suggests the inclusion of two bundled payments with distinct preimages and amounts in an invoice. This proposal aims to address the use case of services that require prepayment of a mining fee for non-custodial exchanges such as submarine swaps and JIT channels. Currently, some services can ask for prepayment using dedicated client software, while others, like Boltz exchange, cannot because their website shows an invoice to users whose wallet is agnostic about the swap. This limitation makes Boltz vulnerable to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees.Similarly, in the case of JIT channels, providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. However, this requirement makes the service custodial, which may have legal implications under European MICA regulation. Competitors who refuse to offer custodian services, such as Electrum, are excluded from this game.To solve these issues, bundling the prepayment and main payment in the same BOLT-11 invoice is proposed. The semantics of bundled payments involve including two preimages and two amounts in the invoice. The receiver should wait until all the HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, they should fail the prepayment with a MPP timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It is important to note that the main payment can still fail if the sender never reveals the preimage.While this proposal does not prevent service providers from stealing the prepayment, it aims to level the playing field in terms of competition between lightning service providers. Currently, using Loop requires a dedicated client, leaving competitors without an established user base vulnerable to mining fee attacks. ACINQ would also benefit from this proposal as it would allow them to make their pay-to-open service fully non-custodial, potentially avoiding compliance issues with European MICA regulation.Thomas Voegtlin believes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues that the proposal does not require the exchange of new messages and can be achieved in a non-interactive way without unnecessary complications.</summary>
    <published>2023-06-14T02:56:54+00:00</published>
  </entry>
</feed>
