<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-29T02:54:51.242628+00:00</updated>
  <author>
    <name>SomberNight 2023-06-20 16:49:05+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-29T02:54:51.242651+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003990.html" rel="alternate"/>
    <summary>One point that is stressed in this message is the presence of potentially three different entities involved in payments, particularly in the context of submarine swaps. The sender, receiver, and swap service provider are the three entities mentioned.The proposal being discussed requires senders to be aware that the payment will lead to a channel creation or splice on the receiver's end. This necessitates updates to existing software used by senders.In the example provided, Alice generates an invoice to receive money onchain, while Bob wants to pay that invoice via Lightning. In this scenario, there are three entities: Alice, the swap service provider, and Bob. Alice is the only one who knows about the swap server. Alice needs client-side logic for doing a swap, while Bob needs to implement a proposal for parsing an invoice that conveys two payment hashes and corresponding amounts.The process involves Alice contacting the swap server with a preimage and its hash for the desired amount. The server then generates another preimage and its hash for a small prepayment amount. A lightning invoice is created with both sets of payment hashes and amounts, which Alice checks before giving it to Bob. Bob, unaware that the nodeid signing the lightning invoice does not belong to Alice, sends HTLCs to cover both payments.The swap server holds the HTLCs until it receives enough offered money for both the prepayment and the main payment. Once the server has the preimage for the prepayment, it fulfills the HTLCs. At this point, a swap funding transaction is created onchain, paying to a locking script redeemable by the preimage of the main payment. Alice waits for the transaction to be mined before broadcasting a claim transaction using the preimage. The server fulfills any remaining pending HTLCs for the main payment using this preimage.It is noted that Bob, as a simple lightning wallet, does not need to know the details of the swap process and expects the payment to go through quickly. However, Bob will end up waiting for onchain transactions to be mined without being aware of it.Additionally, it is mentioned that instead of a special bolt11 invoice, Alice could create a bip21 URI containing both an onchain address and the lightning invoice. This would give Bob the choice of paying onchain or via lightning.The message also briefly discusses the use case of JIT (Just-In-Time) channels. Similar to the swap example, Alice could negotiate with the service provider to have a JIT channel opened, and the HTLC forwarded using that channel. Bob remains unaware of the specifics and only experiences a delay in the fulfillment of the HTLC.In a recent discussion on the lightning-dev mailing list, ThomasV proposed a solution to address vulnerability to denial-of-service (DoS) attacks faced by Boltz, a lightning service provider. The vulnerability arises when attackers force Boltz to pay on-chain fees for multiple invoices simultaneously.To protect against this attack, ThomasV suggests implementing Just-In-Time (JIT) channels, which require providers to obtain the preimage of the main payment before opening the channel. This approach, however, makes the service provider a custodian, subjecting them to European MICA regulations.To overcome this issue, ThomasV proposes bundling the prepayment and main payment into a single BOLT-11 invoice. Under this proposal, the invoice would contain two preimages and two amounts: the prepayment and the main payment. The receiver would wait for the arrival of all HTLCs (Hash Time Locked Contracts) for both payments before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the pre-payment would be failed with a MPP (Multi-Path Payments) timeout.Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. However, it is important to note that the main payment can still fail if the sender never reveals the preimage of the main payment.While ThomasV acknowledges that this proposal does not prevent the service provider from stealing the pre-payment, he believes it would create a level playing field among lightning service providers. Currently, competitors who do not have an established user base running a dedicated client are exposed to the mining fee attack.Implementing the proposed changes would also benefit ACINQ, enabling them to make their pay-to-open service fully non-custodian, thereby avoiding falling within the European MICA regulation's scope.ThomasV suggests that these changes should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. This is because the proposal does not require the exchange of new messages, and adding new messages would unnecessarily complicate the process.By making these changes, ThomasV believes that competition between lightning service providers can be improved, and the vulnerabilities faced by Boltz and other providers can be addressed effectively.Overall, ThomasV's proposal aims to enhance the security and competitiveness of lightning service providers</summary>
    <published>2023-06-20T16:49:05+00:00</published>
  </entry>
</feed>
