<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-08T02:44:13.219340+00:00</updated>
  <author>
    <name>Thomas Voegtlin 2023-06-13 08:10:29+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-08T02:44:13.219362+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003977.html" rel="alternate"/>
    <summary>Proposal for an Extension to BOLT-11 for Bundled PaymentsThomasV is proposing an extension to BOLT-11, the specification for Lightning Network invoices. The proposed extension would allow invoices to contain two bundled payments with distinct preimages and amounts. This extension is aimed at addressing the use case of services that require prepayment of a mining fee for non-custodian exchanges, such as submarine swaps and JIT channels.In both cases, service providers receive HTLCs (Hashed Time-Locked Contracts) for which they do not have the preimage. They must send funds on-chain and wait for the client to reveal the preimage when claiming the payment. To mitigate the risk of clients not claiming the payment, service providers ask for prepayment of mining fees.However, there are limitations in the current system. For example, competitors like Boltz exchange cannot ask for prepayment because their software does not handle it. As a result, they are vulnerable to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees. Similarly, providers of JIT channels need to ask for the preimage of the main payment before opening the channel to protect against mining fee attacks. However, this makes them custodians, which may have legal implications under regulations like European MICA.To address these limitations, ThomasV proposes bundling the prepayment and the main payment in the same BOLT-11 invoice. The semantics of bundled payments are outlined as follows: 1. The invoice contains two preimages and two amounts: prepayment and main payment.2. The receiver waits for all HTLCs of both payments to arrive before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment is failed with a MPP (Multi-Path Payment) timeout.3. Once both payments' HTLCs have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. However, the main payment can still fail if the sender never reveals the preimage.ThomasV acknowledges that this proposal does not prevent service providers from stealing the prepayment, but argues that it would level the playing field in terms of competition between lightning service providers. Currently, competitors without a dedicated client are exposed to mining fee attacks. Additionally, ACINQ would benefit from this extension as it would allow them to make their pay-to-open service fully non-custodian, potentially avoiding regulatory issues like European MICA.ThomasV suggests implementing this change in BOLT-11 rather than using BOLT-12 or onion messages, as the proposal does not require the exchange of new messages. He believes that adding unnecessary complexity through new message exchanges should be avoided when possible.Overall, ThomasV's proposal aims to address limitations in the current system by allowing invoices to contain two bundled payments, which could benefit lightning service providers, promote fair competition, and potentially offer more non-custodian options for certain services.</summary>
    <published>2023-06-13T08:10:29+00:00</published>
  </entry>
</feed>
