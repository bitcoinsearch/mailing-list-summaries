<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-29T02:52:25.662069+00:00</updated>
  <author>
    <name>Thomas Voegtlin 2023-06-13 08:10:29+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-29T02:52:25.662091+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003977.html" rel="alternate"/>
    <summary>Proposal for an Extension to BOLT-11 to Allow Bundled PaymentsThomasV proposes an extension to BOLT-11, the Lightning Network invoice specification, that would allow an invoice to contain two bundled payments with distinct preimages and amounts. The use case for this extension is services that require prepayment of a mining fee for non-custodian exchanges, such as submarine swaps and JIT (Just-In-Time) channels.In both cases, service providers receive HTLCs (Hashed Time-Locked Contracts) for which they do not have the preimage. They must send funds on-chain and wait for the client to reveal the preimage when claiming the payment. However, there is no guarantee that clients will actually claim the payment, so service providers need to ask for prepayment of mining fees.Currently, some services like Loop by Lightning Labs can handle prepayments because they use dedicated client software. However, competitors like Boltz Exchange, which do not require dedicated wallets, are vulnerable to DoS attacks where attackers force them to pay on-chain fees.For JIT channels, providers who want to protect themselves against mining fee attacks ask for the preimage of the main payment before opening the channel. This makes them custodians, which may have legal implications under European MICA regulation. Competitors like Electrum, who refuse to offer custodian services, are excluded from this game.To address these issues, ThomasV suggests bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments are as follows: the invoice includes two preimages and two amounts, and the receiver should wait until all HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should fail with a MPP (Multi-Path Payments) timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It is important to note that the main payment can still fail if the sender never reveals the preimage.ThomasV acknowledges that this proposal does not prevent service providers from stealing the prepayment, but argues that it levels the playing field in terms of competition between lightning service providers. Currently, Loop requires a dedicated client, leaving competitors without an established user base vulnerable to mining fee attacks. ACINQ would also benefit from this extension, as it would make their pay-to-open service fully non-custodian. Currently, Phoenix's pay-to-open service may fall under European MICA regulation, which poses a serious issue.The proposed change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. ThomasV believes that adding new messages unnecessarily complicates things and that non-interactive methods should be used when possible.Overall, ThomasV's proposal aims to enhance the Lightning Network invoice specification by allowing bundled payments, addressing vulnerabilities and improving competition among lightning service providers.</summary>
    <published>2023-06-13T08:10:29+00:00</published>
  </entry>
</feed>
