<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-07T02:49:39.209590+00:00</updated>
  <author>
    <name>Thomas Voegtlin 2023-06-13 08:10:29+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-07T02:49:39.209617+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003977.html" rel="alternate"/>
    <summary>In a proposal to extend BOLT-11, ThomasV suggests the inclusion of two bundled payments within an invoice. This idea aims to address the need for prepayment of mining fees in certain service scenarios such as submarine swaps and JIT channels. In these cases, service providers receive HTLCs for which they lack the preimage, requiring them to send funds on-chain and wait for clients to reveal the preimage upon claiming payment. Due to uncertainty regarding whether clients will actually claim payment, service providers must request prepayment of mining fees.While dedicated client software like Loop by Lightning Labs can handle this prepayment process, competitors such as Boltz exchange, which do not require a dedicated wallet, face difficulties. Boltz's agnostic wallet presents a single invoice to the user, making it impractical to display two simultaneous invoices. Consequently, Boltz becomes vulnerable to denial-of-service (DoS) attacks where attackers force on-chain fee payments. Similarly, in the case of JIT channels, providers seeking protection against mining fee attacks must request the main payment's preimage before opening the channel. However, this approach makes the service custodial from a legal perspective, falling under European MICA regulation. Competing services like Electrum, which refuse to offer custodian services, are excluded from this market. To address these challenges, ThomasV proposes bundling the prepayment and main payment within the same BOLT-11 invoice.The proposed semantics of bundled payments involve including two preimages and amounts within the BOLT-11 invoice: one for prepayment and one for the main payment. The receiver should wait until all HTLCs for both payments have arrived before fulfilling the prepayment HTLCs. If the main payment does not arrive, the receiver should fail the prepayment with a MPP timeout. Once the HTLCs for both payments have arrived, the receiver fulfills the prepayment HTLCs and broadcasts their on-chain transaction. However, it is still possible for the main payment to fail if the sender never reveals the preimage.While the proposal does not prevent service providers from stealing the prepayment, ThomasV argues that this risk already exists in the current system. The suggested change aims to level the playing field among lightning service providers by eliminating the need for a dedicated client like Loop. This would benefit ACINQ as well, allowing them to make their pay-to-open service fully non-custodial. In its present form, the 'pay-to-open' service used by Phoenix may fall under the scope of European MICA regulation, posing a significant issue.ThomasV believes that implementing this change within BOLT-11 is preferable to using BOLT-12 or onion messages. The proposed solution does not require the exchange of new messages and can be achieved in a non-interactive manner. Although initial feedback suggested that BOLT-12 or OM would be more suitable for this use case, ThomasV argues against adding unnecessary complexity by introducing new messages.Overall, ThomasV's proposal seeks to enhance BOLT-11 by allowing invoices to contain two bundled payments, providing a practical solution for service providers facing challenges related to prepayment of mining fees.</summary>
    <published>2023-06-13T08:10:29+00:00</published>
  </entry>
</feed>
