<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-01T03:15:00.913717+00:00</updated>
  <author>
    <name>Matt Corallo 2023-06-14 17:28:04+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-01T03:15:00.913748+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html" rel="alternate"/>
    <summary>The author, Thomas Voegtlin, proposes an extension to BOLT-11, which is a Lightning Network specification. The extension would allow invoices to contain two bundled payments with distinct preimages and amounts. This proposal addresses the use case for services that require prepayment of mining fees for non-custodian exchanges such as submarine swaps and JIT channels.In both cases, the service provider receives a Hashed Time-Locked Contract (HTLC) for which they do not have the preimage. They need to send funds on-chain and wait for the client to reveal the preimage when they claim the payment. To mitigate the risk of clients not claiming the payment, service providers ask for prepayment of mining fees.However, some competitors who do not require a dedicated wallet cannot ask for prepayment, which makes them vulnerable to DoS attacks where attackers force them to pay on-chain fees. Similarly, providers of JIT channels may need to ask for the preimage of the main payment before opening the channel to protect against mining fee attacks. However, this makes them custodians, which can have legal implications.To address these issues, Thomas proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments are as follows: the invoice contains two preimages and two amounts, and the receiver should wait until all HTLCs of both payments have arrived before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the pre-payment should fail with a MPP timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction.Thomas acknowledges that this change does not prevent service providers from stealing the pre-payment, but argues that this is already possible. He believes that this proposal would level the playing field among lightning service providers and benefit ACINQ by enabling their pay-to-open service to be fully non-custodian.Thomas emphasizes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He believes that adding new messages would unnecessarily complicate things and that the proposed change can be achieved in a non-interactive way.In summary, Thomas Voegtlin proposes an extension to BOLT-11 to allow invoices with two bundled payments, addressing the need for prepayment of mining fees in services like submarine swaps and JIT channels. This change aims to level the competition among lightning service providers and make pay-to-open services non-custodian while avoiding unnecessary complexity by implementing it in BOLT-11.</summary>
    <published>2023-06-14T17:28:04+00:00</published>
  </entry>
</feed>
