<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-07-03T03:04:30.064346+00:00</updated>
  <author>
    <name>Matt Corallo 2023-06-14 17:28:04+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-07-03T03:04:30.064372+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html" rel="alternate"/>
    <summary>In a recent discussion on the Lightning-dev mailing list, Thomas Voegtlin proposed an extension to BOLT-11, which would allow invoices to contain two bundled payments with distinct preimages and amounts. This proposal is aimed at addressing the needs of services such as submarine swaps and JIT channels, which require prepayment of mining fees.Thomas explains that in the case of submarine swaps, services like Loop by Lightning Labs can ask for a prepayment because their software can handle it. However, competitors who do not require a dedicated wallet, like the Boltz exchange, cannot do the same. This creates a vulnerability for Boltz, as attackers could force them to pay on-chain fees, resulting in a denial-of-service (DoS) attack.Similarly, in the case of JIT channels, providers need to ask for the preimage of the main payment before they open the channel to protect themselves against mining fee attacks. However, this makes them custodians of the funds, which has legal implications under European regulations. Competitors who refuse to offer custodian services are excluded from participating in this game.To address these issues, Thomas suggests bundling the prepayment and the main payment in the same BOLT-11 invoice. The semantics of bundled payments would involve waiting for both payments' HTLCs to arrive before fulfilling the pre-payment's HTLCs. If the main payment does not arrive, the pre-payment would be failed with a MPP timeout. Once both sets of HTLCs have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It should be noted that the main payment can still fail if the sender never reveals the preimage.While Thomas acknowledges that this proposal does not prevent service providers from stealing the pre-payment, he believes it would level the playing field for competition between lightning service providers. Currently, using Loop requires a dedicated client, leaving competitors without an established user base exposed to mining fee attacks. Additionally, Thomas suggests that ACINQ would benefit from this change as it would allow them to make their pay-to-open service fully non-custodian.Thomas concludes by expressing his belief that this change should be implemented in BOLT-11, rather than using BOLT-12 or onion messages. He argues that there is no need for new messages when the desired functionality can be achieved in a non-interactive way.Overall, Thomas Voegtlin's proposal aims to address the challenges faced by services requiring prepayment of mining fees through the inclusion of bundled payments in BOLT-11 invoices.</summary>
    <published>2023-06-14T17:28:04+00:00</published>
  </entry>
</feed>
