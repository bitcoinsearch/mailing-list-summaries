<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-30T02:53:29.309309+00:00</updated>
  <author>
    <name>Matt Corallo 2023-06-14 17:28:04+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-30T02:53:29.309331+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html" rel="alternate"/>
    <summary>The possibility of introducing a new interoperable change in BOLT-11 seems unlikely, as even the implementation of amount-less BOLT-11 invoices has faced challenges in achieving broad support. Therefore, expecting the entire ecosystem to adopt yet another incompatible version of BOLT-11 is not feasible. In proposing an extension to BOLT-11, Thomas Voegtlin suggests the inclusion of two bundled payments with distinct preimages and amounts. This extension addresses the need for prepayment of mining fees in services like submarine swaps and JIT channels. Currently, service providers receive HTLCs without having the preimage and must send funds on-chain while waiting for clients to reveal the preimage upon claiming the payment. To mitigate the risk of non-claiming, service providers require prepayment of mining fees.However, certain limitations arise in implementing this extension. For example, competitors who do not have dedicated client software, such as the Boltz exchange, cannot ask for prepayment like Loop by Lightning Labs. This vulnerability exposes them to potential DoS attacks where attackers force them to pay on-chain fees. Similarly, in the case of JIT channels, providers aiming to protect themselves against mining fee attacks would need to become custodians by asking for the preimage before opening the channel. This legal distinction raises concerns related to regulations like the European MICA regulation.To address these issues, Thomas proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments involve the inclusion of two preimages and two amounts in the invoice. The receiver should wait until all HTLCs of both payments arrive before fulfilling the HTLCs of the prepayment. If the main payment fails to arrive, the prepayment should be failed with a MPP timeout. Once the HTLCs of both payments are received, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It should be noted that the main payment can still fail if the sender never reveals the preimage.While this proposal does not prevent service providers from stealing the prepayment, Thomas believes it would level the competition field between lightning service providers. Currently, using dedicated clients like Loop is necessary to avoid mining fee attacks, leaving competitors without an established user base at risk. Additionally, ACINQ could benefit from this change by making their pay-to-open service fully non-custodian, potentially avoiding issues with the European MICA regulation.Thomas suggests implementing this change in BOLT-11 rather than introducing new messages through BOLT-12 or onion messages. He argues that the proposed extension does not require additional message exchanges and can be achieved in a non-interactive manner, making the process less complicated.Overall, the proposed extension to BOLT-11 aims to address the need for prepayment of mining fees in certain lightning network services, providing a more standardized and competitive environment for lightning service providers.</summary>
    <published>2023-06-14T17:28:04+00:00</published>
  </entry>
</feed>
