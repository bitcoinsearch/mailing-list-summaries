<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Proposal: Bundled payments</title>
  <updated>2023-06-29T02:56:19.578015+00:00</updated>
  <author>
    <name>Bastien TEINTURIER 2023-06-20 16:44:17+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Proposal: Bundled payments</title>
    <updated>2023-06-29T02:56:19.578038+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003989.html" rel="alternate"/>
    <summary>In a recent conversation between Thomas and Bastien, the topic of pre-payment of mining fees and the use of 0-conf transactions in Lightning Network was discussed. Bastien suggested that pre-payment and 0-conf transactions could be combined, but Thomas expressed uncertainty about the feasibility of this idea. He mentioned that if 0-conf transactions were no longer used, the solution described by Bastien would not work and prepayment would be necessary.Thomas also raised the question of whether bundled payments would work with the current specification or require changes to BOLT-12. Bastien explained that adding a TLV field to BOLT-12 invoices or onion messages would be necessary for bundled payments. He further emphasized that the design space for a prepayment solution based on BOLT-12 is larger than with BOLT-11, allowing for a more satisfying protocol.The conversation then shifted to the potential adoption timeline of BOLT-12 as the dominant payment method on Lightning Network. Bastien believed that it would take years after its merge before BOLT-12 becomes dominant, while Thomas argued that if the proposed feature was adopted in BOLT-11, it could be deployed faster. However, Bastien pointed out that implementing the feature in BOLT-12 would provide a cleaner solution due to the on-the-fly and short-lived nature of invoices.Bastien's proposal aimed to level the field of competition between Lightning service providers, acknowledging the need for a more satisfactory solution. Thomas agreed that a better solution was desirable but cautioned against rushing its implementation. He suggested building upon BOLT-12, where a cleaner protocol could potentially be developed.In a separate email exchange between Thomas and David, the concept of bundled payments was discussed. Thomas explained the semantics of bundled payments, which involve including two preimages and two amounts (prepayment and main payment) in a BOLT-11 invoice. The receiver should wait until all HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should be failed with a MPP timeout. Once all the HTLCs have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts the on-chain transaction.David proposed using a keysend payment for the prepayment and associating it with a payment hash via the onion message payload. This would eliminate the need for a payment hash in the BOLT11 invoice, reducing its size. Thomas agreed that this approach could work and suggested extending BOLT11 invoices with an extra_fee_via_keysend field. This field could be encoded in existing BOLT11 fields like description or metadata, allowing for immediate implementation until an updated version of BOLT11 becomes widely deployed.Overall, the discussions revolved around the feasibility and implementation details of combining pre-payment and 0-conf transactions, introducing bundled payments, and the potential adoption of BOLT-12 as the dominant payment method in Lightning Network.</summary>
    <published>2023-06-20T16:44:17+00:00</published>
  </entry>
</feed>
