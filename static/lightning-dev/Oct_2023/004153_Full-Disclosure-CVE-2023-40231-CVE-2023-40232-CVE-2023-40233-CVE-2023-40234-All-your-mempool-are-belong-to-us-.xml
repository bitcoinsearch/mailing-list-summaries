<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>1</id>
  <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
  <updated>2023-10-25T17:54:28.338226+00:00</updated>
  <author>
    <name>Antoine Riard 2023-10-19 19:33:22+00:00</name>
  </author>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <entry>
    <id>1</id>
    <title>Full Disclosure: CVE-2023-40231 / CVE-2023-40232 / CVE-2023-40233 / CVE-2023-40234 "All your mempool are belong to us"</title>
    <updated>2023-10-25T17:54:28.338226+00:00</updated>
    <link href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-October/004153.html" rel="alternate"/>
    <summary>In the email, Antoine discusses the concept of a replacement-cycling attacker in the context of Bitcoin's Lightning Network. The attacker can afford to pay 100% of the HTLC (Hashed Time-Locked Contract) value under the defender scorched earth policy and still realize an economic gain.

To illustrate this, Antoine presents a scenario involving three individuals: Alice, Bob, and Caroll, who are all "honest" routing hops targeted by the attacker. Each of them has three independent 10,000 sats (Satoshis) HTLC in-flight on their outbound channels.

Under the defensive fee scorched earth policy, Alice broadcasts her HTLC-timeout at T + 1 with a committed absolute fee of 10,000 sats. However, Mallory, the attacker, replaces it at T+2 with a HTLC-preimage X of 200,000 sats (+rbf penalty 1 sat/vb rule 4). Alice's HTLC-timeout is then out of network mempools.

Similarly, Bob broadcasts his HTLC-timeout of 200,000 sats at T+3, which is replaced by Mallory at T+4 with her HTLC-preimage Y of 200,000 sats (+rbf penalty 1 sat/vb rule 4 * 2). Bob's HTLC-timeout is also out of network mempools. It is worth noting that HTLC-preimage Y conflicts with HTLC-preimage X as well.

Caroll follows the same pattern and broadcasts her HTLC-timeout of 200,000 sats at T+5, which is replaced by Mallory at T+6 with her HTLC-preimage Z of 200,000 sats (+rbf penalty 1 sat/vb rule 4 * 3). Caroll's HTLC-timeout is out of network mempools, and HTLC-preimage Z conflicts with HTLC-preimage Y.

At any time, if Mallory's HTLC-preimage enters into the top mempool feerates group (due to the accumulated rbf penalty), one unconfirmed ancestor can be double-spent to evict the HTLC-preimage. If Mallory successfully executes the replacement cycling, she may incur a loss of 10,000 sats + rbf penalty cost for each rebroadcast attempt of the victim. However, she wins the HTLC value of 200,000 sats from Alice, Bob, and Caroll.

Assuming 5 rebroadcasts per block (even on random timers) multiplied by 3 victims, 200 bytes of HTLC-preimage, and cltv_delta of 144 blocks, the total attacker cost is 432,000 sats. The economic gain realized by the attacker is 168,000 sats. This implies that each additional victim has a cost of 144,000 sats, regardless of the HTLC value targeted.

Antoine expresses gratitude for checking the fees math and replacement rules, as it seems correct to him. He concludes by mentioning potential scenarios where more favorable assumptions for the attacker, such as mempool spikes, could allow the "honest" HTLC-timeout transactions to float in network mempools.

Overall, the email highlights the vulnerabilities and potential economic gains for a replacement-cycling attacker targeting HTLC values in Bitcoin's Lightning Network.</summary>
    <published>2023-10-19T19:33:22+00:00</published>
  </entry>
</feed>
